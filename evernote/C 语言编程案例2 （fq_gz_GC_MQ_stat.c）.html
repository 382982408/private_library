<html>
<head>
  <title>C 语言编程案例2 （fq_gz_GC_MQ_stat.c）</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/600753 (zh-CN, DDL); Windows/10.0.0 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="415"/>
<h1>C 语言编程案例2 （fq_gz_GC_MQ_stat.c）</h1>

<div>
<span><div><span style="font-size: 12pt; color: rgb(227, 0, 0);">C 语言编程案例2 （fq_gz_GC_MQ_stat.c）</span></div><div><font style="font-size: 10pt;"><br/></font></div><div>#include &lt;stdio.h&gt;        /* 定义输入输出函数*/</div><div>#include &lt;string.h&gt;        /* 定义字符串操作函数*/</div><div>#include &lt;math.h&gt;        /* 定义sin、cos等数学函数*/</div><div>#include &lt;malloc.h&gt;</div><div>#include &lt;stdlib.h&gt;</div><div>#include &lt;zlib.h&gt;               ////gcc -lz gz_GC_MQ_stat.c                     编译方法不同</div><div><br/></div><div>#define _LEN 150</div><div>#define _A 1</div><div>#define _T 2</div><div>#define _C 3</div><div>#define _G 4</div><div>#define _N 5</div><div><br/></div><div>struct RES</div><div>{</div><div>    long GC[2*_LEN][6];</div><div>    long QUA[2*_LEN][42];</div><div>    char head1[_LEN];</div><div>    char seq1[_LEN];</div><div>    char no1[_LEN];</div><div>    char qua1[_LEN];</div><div>    char head2[_LEN];</div><div>    char seq2[_LEN];</div><div>    char no2[_LEN];</div><div>    char qua2[_LEN];</div><div>    int read1_len;</div><div>    int read2_len;</div><div>    long pair_number;</div><div>    float read1base_number;</div><div>    float read2base_number;</div><div>    float base_number;</div><div>    float GC_number;</div><div>    float Q_tot;</div><div>    float Q20_number;</div><div>    float Q30_number;</div><div>    char oriout1[10];</div><div>    char oriout2[10];</div><div>    char oriout3[10];</div><div>}res;    //={&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,0,0,0,0,0,0,0,0,0,0};</div><div>struct RES *p1=&amp;res;</div><div><br/></div><div>int main (int argc, char *argv[])</div><div>{</div><div>    struct RES;</div><div>    void help(char name[100]);</div><div>    int stat (char x[200],char y[200]);</div><div>    long i=0,j=0;</div><div>    if (argc%2==0)        //int stat (char x,char y)</div><div>    {</div><div>        for (i=1;i&lt;argc-2;i+=2)</div><div>        {</div><div>            stat(argv[i],argv[i+1]);</div><div>        };</div><div>    }else</div><div>    {</div><div>        help(argv[0]);</div><div>        return (0);    //终止程序</div><div>    };</div><div>    //#################################</div><div>    FILE *OUT1,*OUT2,*OUT3;</div><div>    char *outpointer;        //输出至文件</div><div>    sprintf(p1-&gt;oriout1,&quot;%s&quot;,argv[argc-1]);</div><div>    outpointer=p1-&gt;oriout1;</div><div>    strcat(outpointer,&quot;.quality&quot;);</div><div>    OUT1=fopen(outpointer,&quot;w&quot;);//打开fastaq文件</div><div>    fputs(&quot;MQ&quot;,OUT1);</div><div>    for (i=0;i&lt;41 ;i++ )</div><div>    {</div><div>        char col[5];</div><div>        sprintf(col,&quot;\t%d&quot;,i);</div><div>        fputs(col,OUT1);                                    //fputs 函数只能输出char类型的字符串，不能输出整型变量，所以需要先转换</div><div>    };</div><div>    fputs(&quot;\n&quot;,OUT1);</div><div>    ////////</div><div>    for (i=0;i&lt;_LEN*2; i++)</div><div>    {</div><div>        for (j=0;j&lt;41;j++)</div><div>        {</div><div>            p1-&gt;QUA[i][41]+=p1-&gt;QUA[i][j];</div><div>        };</div><div>    };</div><div>    ////////</div><div>    char string[10];</div><div><br/></div><div>    for (i=0;i&lt;_LEN*2; i++)</div><div>    {</div><div>        char raw[5];</div><div>        sprintf(raw,&quot;%d&quot;,i+1);</div><div>        fputs(raw,OUT1);</div><div>        for (j=0;j&lt;41 ;j++)</div><div>        {</div><div>            //itoa(QUA[i][j],string,10);        linux 下无定义的itoa</div><div>            //char string[5]=itoa(QUA[i][j]);</div><div>            float value,tot,tag;</div><div>            value=p1-&gt;QUA[i][j];</div><div>            tot=p1-&gt;QUA[i][41];                                ///////here</div><div>            tag=value/tot;</div><div>            sprintf(string,&quot;\t%.4f&quot;,tag);</div><div>            fputs(string,OUT1);</div><div>            if (j&gt;=20)</div><div>            {</div><div>                p1-&gt;Q20_number+=p1-&gt;QUA[i][j];</div><div>            };</div><div>            if (j&gt;=30)</div><div>            {</div><div>                p1-&gt;Q30_number+=p1-&gt;QUA[i][j];</div><div>            };</div><div>            p1-&gt;Q_tot+=p1-&gt;QUA[i][j];</div><div>        };</div><div>        fputs(&quot;\n&quot; ,OUT1);</div><div>    };</div><div>    fclose(OUT1);</div><div>    //#################################</div><div>    sprintf(p1-&gt;oriout2,&quot;%s&quot;,argv[argc-1]);</div><div>    outpointer=p1-&gt;oriout2;</div><div>    strcat(outpointer,&quot;.GC_content&quot;);</div><div>    OUT2=fopen(outpointer,&quot;w&quot;);</div><div>    fputs(&quot;GC\tA\tT\tC\tG\tN\n&quot;,OUT2);</div><div>    ////</div><div>    for (i=0;i&lt;_LEN*2; i++)</div><div>    {</div><div>        for (j=1;j&lt;=5;j++)</div><div>        {</div><div>            p1-&gt;GC[i][0]+=p1-&gt;GC[i][j];</div><div>        };</div><div>    };</div><div>    ////</div><div>    for (i=0;i&lt;_LEN*2; i++)</div><div>    {</div><div>        sprintf(string,&quot;%d&quot;,i+1);</div><div>        fputs(string,OUT2);</div><div>        for (j=1;j&lt;=5 ;j++)</div><div>        {</div><div>            if (i&lt;_LEN)</div><div>            {</div><div>                p1-&gt;read1base_number+=p1-&gt;GC[i][j];</div><div>            }else if(i&gt;=_LEN)</div><div>            {</div><div>                p1-&gt;read2base_number+=p1-&gt;GC[i][j];</div><div>            };</div><div>            float value,tot,tag;</div><div>            //itoa(QUA[i][j],string,10);        linux 下无定义的itoa</div><div>            value=p1-&gt;GC[i][j];</div><div>            tot=p1-&gt;GC[i][0];</div><div>            tag=value/tot;</div><div>            sprintf(string,&quot;\t%.4f&quot;,tag);</div><div>            fputs(string,OUT2);</div><div>            switch(j)</div><div>            {</div><div>                case 3:</div><div>                    p1-&gt;GC_number+=p1-&gt;GC[i][j];</div><div>                    break;</div><div>                case 4:</div><div>                    p1-&gt;GC_number+=p1-&gt;GC[i][j];</div><div>                    break;</div><div>                default:</div><div>                    break;</div><div>            };</div><div>        };</div><div>        fputs(&quot;\n&quot; ,OUT2);</div><div>        if (i&lt;_LEN)</div><div>        {</div><div>            if (p1-&gt;GC[i][0]&gt;0)</div><div>            {</div><div>                ++p1-&gt;read1_len;</div><div>            };</div><div>        }else if (i&gt;=_LEN)</div><div>        {</div><div>            if (p1-&gt;GC[i][0]&gt;0)</div><div>            {</div><div>                ++p1-&gt;read2_len;</div><div>            };</div><div>        };</div><div>    };</div><div>    fclose(OUT2);</div><div>    //#################################</div><div>    sprintf(p1-&gt;oriout3,&quot;%s&quot;,argv[argc-1]);</div><div>    outpointer=p1-&gt;oriout3;</div><div>    strcat(outpointer,&quot;.totstat&quot;);</div><div>    OUT3=fopen(outpointer,&quot;w&quot;);</div><div>    float mem=p1-&gt;Q_tot;</div><div>    p1-&gt;base_number=p1-&gt;read1base_number+p1-&gt;read2base_number;</div><div>    float men=p1-&gt;base_number;</div><div>    /////printf(&quot;%d\n%d\n&quot;,p1-&gt;base_number,men);        浮点型数据不能用\d 输出，以后一定要注意</div><div>    char report[200];</div><div>    sprintf(report,&quot;read1_len\t%d\nread2_len\t%d\n&quot;,p1-&gt;read1_len,p1-&gt;read2_len);</div><div>    fputs(report,OUT3);</div><div>    sprintf(report,&quot;pair_number\t%d\nread1base_number\t%.f\nread2base_number\t%.f\n&quot;,p1-&gt;pair_number,p1-&gt;read1base_number,p1-&gt;read2base_number);</div><div>    fputs(report,OUT3);</div><div>    sprintf(report,&quot;base_number\t%.f\nGC_number\t%.f\nGC_content\t%f\n&quot;,p1-&gt;base_number,p1-&gt;GC_number,p1-&gt;GC_number/men);</div><div>    fputs(report,OUT3);</div><div>    sprintf(report,&quot;Q_20\t%f\nQ_30\t%f\nQ_tot\t%.f\n&quot;,p1-&gt;Q20_number/mem,p1-&gt;Q30_number/mem,p1-&gt;Q_tot);</div><div>    fputs(report,OUT3);</div><div>    fclose(OUT3);</div><div>    return (0);</div><div>};</div><div><br/></div><div>void help(char name[100])</div><div>{</div><div>    printf(&quot;Usage:\n&quot;);</div><div>    printf(&quot;\t%s\tfq_1 fq_2 fq_1 fq_2...\tout\n&quot;,name);</div><div>    printf(&quot;\t1&gt; please put in fqs 1\n&quot;);</div><div>    printf(&quot;\t2&gt; please put in fqs 2\n&quot;);</div><div>    printf(&quot;\t3&gt; please put in fqs 1\n&quot;);</div><div>    printf(&quot;\t4&gt; please put in fqs 2\n&quot;);</div><div>    printf(&quot;\t......\n&quot;);</div><div>    printf(&quot;\tn&gt; please put in out_file_name\n&quot;);</div><div>};</div><div>int stat (char x[200],char y[200])</div><div>{</div><div>//    FILE *file1,*file2;</div><div>//    file1=fopen(x,&quot;r&quot;);//打开fastaq文件</div><div>//    file2=fopen(y,&quot;r&quot;);//打开fastaq文件</div><div>    gzFile file1=gzopen(x,&quot;rb&quot;);//打开fastaq文件</div><div>    gzFile file2=gzopen(y,&quot;rb&quot;);//打开fastaq文件</div><div>    if (file1==NULL || file2==NULL)</div><div>    {</div><div>        printf(&quot;File open error!\n&quot;);</div><div>        return(0);</div><div>    };</div><div>    long i=0,j=0;</div><div>    while(gzgets(file1,p1-&gt;head1,_LEN))            //此处按行读取与perl甚为相似，</div><div>    {</div><div>        gzgets(file1,p1-&gt;seq1,_LEN);</div><div>        gzgets(file1,p1-&gt;no1,_LEN);</div><div>        gzgets(file1,p1-&gt;qua1,_LEN);</div><div>        gzgets(file2,p1-&gt;head2,_LEN);</div><div>        gzgets(file2,p1-&gt;seq2,_LEN);</div><div>        gzgets(file2,p1-&gt;no2,_LEN);</div><div>        gzgets(file2,p1-&gt;qua2,_LEN);</div><div>        p1-&gt;pair_number+=2;</div><div>        //#####################################</div><div>        for (i=0;i&lt;_LEN ;i++)</div><div>        {</div><div>            int mark=1;</div><div>            switch(p1-&gt;seq1[i])</div><div>            {</div><div>                case 'A':</div><div>                    ++p1-&gt;GC[i][_A];</div><div>                    break;</div><div>                case 'T':</div><div>                    ++p1-&gt;GC[i][_T];</div><div>                    break;</div><div>                case 'C':</div><div>                    ++p1-&gt;GC[i][_C];</div><div>                    break;</div><div>                case 'G':</div><div>                    ++p1-&gt;GC[i][_G];</div><div>                    break;</div><div>                case 'N':</div><div>                    ++p1-&gt;GC[i][_N];</div><div>                    break;</div><div>                default:</div><div>                    mark=0;</div><div>                    break;</div><div>            };</div><div>            if (mark==0){break;}</div><div>            int tmpqua=p1-&gt;qua1[i]-33;</div><div>            if (tmpqua&lt;0)</div><div>            {</div><div>                printf(&quot;MQ error !\t:%d\n&quot;,tmpqua);</div><div>                exit (0);</div><div>            }else if (tmpqua&lt;=39)</div><div>            {</div><div>                ++p1-&gt;QUA[i][tmpqua];</div><div>            }else</div><div>            {</div><div>                ++p1-&gt;QUA[i][40];</div><div>            };</div><div>        };</div><div>        //#################################</div><div>        int k;</div><div>        for (i=0;i&lt;_LEN ;i++)</div><div>        {</div><div>            k=i+_LEN;</div><div>            int mark=1;</div><div>            switch(p1-&gt;seq2[i])</div><div>            {</div><div>                case 'A':</div><div>                    ++p1-&gt;GC[k][_A];</div><div>                    break;</div><div>                case 'T':</div><div>                    ++p1-&gt;GC[k][_T];</div><div>                    break;</div><div>                case 'C':</div><div>                    ++p1-&gt;GC[k][_C];</div><div>                    break;</div><div>                case 'G':</div><div>                    ++p1-&gt;GC[k][_G];</div><div>                    break;</div><div>                case 'N':</div><div>                    ++p1-&gt;GC[k][_N];</div><div>                    break;</div><div>                default:</div><div>                    mark=0;</div><div>                    break;</div><div>            };</div><div>            if (mark==0){break;}</div><div>            int tmpqua=p1-&gt;qua2[i]-33;</div><div>            if (tmpqua&lt;0)</div><div>            {</div><div>                printf(&quot;MQ error !\t:%d\n&quot;,tmpqua);</div><div>                exit (0);</div><div>            }else if (tmpqua&lt;=39)</div><div>            {</div><div>                ++p1-&gt;QUA[k][tmpqua];</div><div>            }else</div><div>            {</div><div>                ++p1-&gt;QUA[k][40];</div><div>            };</div><div>        };</div><div>    };</div><div>    gzclose(file1);</div><div>    gzclose(file2);</div><div>    return(0);</div><div>};</div><div><br/></div></span>
</div></body></html> 