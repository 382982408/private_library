<html>
<head>
  <title>perl 编程案例4 （annotool 小工具）</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/600753 (zh-CN, DDL); Windows/10.0.0 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="416"/>
<h1>perl 编程案例4 （annotool 小工具）</h1>

<div>
<span><div><span style="font-size: 14pt; color: rgb(255, 0, 0);">perl 编程案例4 （annotool 小工具）</span></div><div><br/></div><div>#!/usr/bin/perl -w</div><div>use strict;</div><div>use Cwd;</div><div>use Getopt::Long;</div><div>use Data::Dumper;</div><div>use FindBin qw($Bin $Script);</div><div>use File::Basename qw(basename dirname);</div><div>my $idx=&quot;500000&quot;;</div><div>###############################################Start_Time</div><div><br/></div><div>my %parameter;</div><div>$parameter{t}=$ARGV[0];</div><div>GetOptions(\%parameter,&quot;i=s{,}&quot;=&gt;\@{$parameter{i}},&quot;o=s&quot;=&gt;\$parameter{o},&quot;d=s&quot;=&gt;\$parameter{d},&quot;r=s&quot;=&gt;\$parameter{r},&quot;chromosome=s&quot;=&gt;\$parameter{chr},&quot;head=s{,}&quot;=&gt;\@{$parameter{head}});</div><div>if(!defined $parameter{r})</div><div>{</div><div>    $parameter{r}=&quot;0:1:2:3:4&quot;;</div><div>};</div><div>if(!defined $parameter{chr})</div><div>{</div><div>    $parameter{chr}=&quot;undef&quot;;</div><div>};</div><div>#print Dumper \%parameter;</div><div><br/></div><div>&amp;help(\%parameter);</div><div>#################################################</div><div><br/></div><div>sub NC2chr</div><div>{</div><div>    my $chr=(split /0{4,5}|\./,$_[0])[1];</div><div>    if ($chr eq '23') {$chr='X'}</div><div>    elsif($chr eq '24'){$chr='Y'};</div><div>    return &quot;chr$chr&quot;;</div><div>};</div><div>################################################</div><div>sub help</div><div>{</div><div>    my %chr2NC=</div><div>    (</div><div>        &quot;chr1&quot;=&gt;&quot;NC_000001.10&quot;,&quot;chr2&quot;=&gt;&quot;NC_000002.11&quot;,&quot;chr3&quot;=&gt;&quot;NC_000003.11&quot;,&quot;chr4&quot;=&gt;&quot;NC_000004.11&quot;,&quot;chr5&quot;=&gt; &quot;NC_000005.9&quot;,&quot;chr6&quot;=&gt;&quot;NC_000006.11&quot;,</div><div>        &quot;chr7&quot;=&gt;&quot;NC_000007.13&quot;,&quot;chr8&quot;=&gt;&quot;NC_000008.10&quot;,&quot;chr9&quot;=&gt;&quot;NC_000009.11&quot;,&quot;chr10&quot;=&gt;&quot;NC_000010.10&quot;,&quot;chr11&quot;=&gt; &quot;NC_000011.9&quot;,&quot;chr12&quot;=&gt;&quot;NC_000012.11&quot;,</div><div>        &quot;chr13&quot;=&gt;&quot;NC_000013.10&quot;,&quot;chr14&quot;=&gt; &quot;NC_000014.8&quot;,&quot;chr15&quot;=&gt; &quot;NC_000015.9&quot;,&quot;chr16&quot;=&gt; &quot;NC_000016.9&quot;,&quot;chr17&quot;=&gt;&quot;NC_000017.10&quot;,&quot;chr18&quot;=&gt; &quot;NC_000018.9&quot;,</div><div>        &quot;chr19&quot; =&gt;&quot;NC_000019.9&quot;,&quot;chr20&quot; =&gt;&quot;NC_000020.10&quot;,&quot;chr21&quot; =&gt;&quot;NC_000021.8&quot;,&quot;chr22&quot; =&gt;&quot;NC_000022.10&quot;,&quot;chrX&quot;  =&gt;&quot;NC_000023.10&quot;,&quot;chrY&quot;  =&gt;&quot;NC_000024.9&quot;,</div><div>    );</div><div>    my ($opt)=@_;</div><div>    if(defined $opt-&gt;{t} &amp;&amp; ($opt-&gt;{t} eq &quot;format-convert&quot;))</div><div>    {</div><div>        if(exists $opt-&gt;{i} &amp;&amp; exists $opt-&gt;{o} &amp;&amp; @{$opt-&gt;{i}}==1)</div><div>        {</div><div>            &amp;annotools_convert(${$opt-&gt;{i}}[0],$opt-&gt;{o},$opt-&gt;{r},$parameter{chr},\%chr2NC);</div><div>        }else</div><div>        {</div><div>            print STDERR</div><div>&quot;</div><div>Usage:  annotools format-convert -i [bed] -o [outfile] -r [optional] -chromosome [optional]</div><div><br/></div><div>    -i        Compatible with the following format:</div><div>            chr1    69270    69270    A    G</div><div>            chr1    69270    69270    A    G,C</div><div>            chr1    69270    69270    A    -</div><div>            chr1    69270    69271    -    G</div><div>    -o        The standard output format:</div><div>            chr1    69270   69270   A       G</div><div>            chr1    69270   69270   D       A</div><div>            chr1    69270   69271   I       G</div><div>    -r        The standard 5 columns,Default(0:1:2:3:4)</div><div>    -chromosome    NC2chr:        NC_000001.10 &gt; chr1</div><div>            chr2NC:        chr1 &gt; NC_000001.10</div><div>            num2chr:    1 &gt; chr1</div><div>            chr2num:    chr1 &gt; 1</div><div>            num2NC:        1 &gt; NC_000001.10</div><div>            NC2num:        NC_000001.10 &gt; 1</div><div>&quot;;</div><div>exit;</div><div>        }</div><div>    }elsif(defined $opt-&gt;{t} &amp;&amp; ($opt-&gt;{t} eq &quot;sort&quot;))</div><div>    {</div><div>        if(exists $opt-&gt;{i} &amp;&amp; exists $opt-&gt;{o} &amp;&amp; @{$opt-&gt;{i}}==1)</div><div>        {</div><div>            &amp;annotools_sort(${$opt-&gt;{i}}[0],$opt-&gt;{o});</div><div>        }else</div><div>        {</div><div>            print STDERR</div><div>&quot;</div><div>Usage:  annotools sort -i [bed] -o [outfile]</div><div><br/></div><div>&quot;;</div><div>exit;</div><div>        };</div><div>    }elsif(defined $opt-&gt;{t} &amp;&amp; ($opt-&gt;{t} eq &quot;index&quot;))</div><div>    {</div><div>        if(exists $opt-&gt;{i} &amp;&amp; @{$opt-&gt;{i}}==1)</div><div>        {</div><div>            &amp;annotools_index(${$opt-&gt;{i}}[0]);</div><div>        }else</div><div>        {</div><div>            print STDERR</div><div>&quot;</div><div>Usage:  annotools index -i [bed]</div><div><br/></div><div>&quot;;</div><div>exit;</div><div>        };</div><div>    }elsif(defined $opt-&gt;{t} &amp;&amp; ($opt-&gt;{t} eq &quot;anno&quot;))</div><div>    {</div><div>        if(exists $opt-&gt;{i} &amp;&amp; exists $opt-&gt;{o} &amp;&amp; exists $opt-&gt;{d} &amp;&amp; @{$opt-&gt;{i}}==1)</div><div>        {</div><div>            &amp;annotools_anno(${$opt-&gt;{i}}[0],$opt-&gt;{d},$opt-&gt;{o});</div><div>        }else</div><div>        {</div><div>            print STDERR</div><div>&quot;</div><div>Usage:  annotools anno -i [bed] -d [database] -o [outfile]</div><div>    </div><div>    -i    Only with the following format:</div><div>        chr1    69270   69270   A       G</div><div>        chr1    69270   69270   D       A</div><div>        chr1    69270   69271   I       G</div><div>    -d    Need annotation databases,file format refer to [-i]</div><div>    -o    Out file</div><div><br/></div><div>&quot;;</div><div>exit;</div><div>        };</div><div>    }elsif(defined $opt-&gt;{t} &amp;&amp; ($opt-&gt;{t} eq &quot;combine&quot;))</div><div>    {</div><div>        if(exists $opt-&gt;{i} &amp;&amp; @{$opt-&gt;{i}}&gt;=1)</div><div>        {</div><div>        }else</div><div>        {</div><div>            print STDERR</div><div>&quot;</div><div>Usage:  annotools combine -i [result_1] [result_2] ... -o [outfile]</div><div>    </div><div>    -i    Must be the format of the annotools_anno result</div><div><br/></div><div>    -o    Out file</div><div><br/></div><div>&quot;;</div><div>exit;</div><div>        };</div><div>    }elsif(defined $opt-&gt;{t} &amp;&amp; ($opt-&gt;{t} eq &quot;addhead&quot;))</div><div>    {</div><div>        if(exists $opt-&gt;{i} &amp;&amp; @{$opt-&gt;{i}}&gt;=1 &amp;&amp; exists $parameter{head})</div><div>        {</div><div>            &amp;annotools_addhead(${$opt-&gt;{i}}[0],$parameter{head});</div><div>        }else</div><div>        {</div><div>            print STDERR</div><div>&quot;</div><div>Usage:  annotools addhead -i [bed] -head [standard input or head file]</div><div>    </div><div>    -i    Must be the format of the annotools_anno result</div><div><br/></div><div>    -head    header added</div><div>        1) chr start end ref alt......</div><div>        2) head file</div><div><br/></div><div>&quot;;</div><div>exit;</div><div>        };</div><div>    }elsif(defined $opt-&gt;{t} &amp;&amp; ($opt-&gt;{t} eq &quot;chr-convert&quot;))</div><div>    {</div><div>        if(exists $opt-&gt;{i} &amp;&amp; @{$opt-&gt;{i}}&gt;=1 &amp;&amp; exists $opt-&gt;{o})</div><div>        {</div><div>            &amp;annotools_chrconvert(${$opt-&gt;{i}}[0],$opt-&gt;{o},$parameter{chr},\%chr2NC);</div><div>        }else</div><div>        {</div><div>            print STDERR</div><div>&quot;</div><div>Usage:  annotools chr-convert -i [bed] -o [outfile] -chromosome [optional]</div><div>    </div><div>    -i        Must be the format of the annotools_anno result</div><div>    -o        Out file</div><div>    -chromosome    NC2chr:        NC_000001.10 &gt; chr1</div><div>            chr2NC:        chr1 &gt; NC_000001.10</div><div>            num2chr:    1 &gt; chr1</div><div>            chr2num:    chr1 &gt; 1</div><div>            num2NC:        1 &gt; NC_000001.10</div><div>            NC2num:        NC_000001.10 &gt; 1</div><div><br/></div><div>&quot;;</div><div>exit;</div><div>        };</div><div>    }else</div><div>    {</div><div>        print STDERR</div><div>&quot;</div><div>Usage:  annotools &lt;subcommand&gt; [options]</div><div><br/></div><div>    The annotools sub-commands include:</div><div><br/></div><div>    [format-convert]</div><div>    [sort]</div><div>    [index]</div><div>    [anno]</div><div>    [combine]</div><div>    [addhead]</div><div>    [chr-convert]</div><div><br/></div><div>&quot;;</div><div>exit;</div><div>    };</div><div>};</div><div><br/></div><div>sub chr_convert</div><div>{</div><div><br/></div><div>    #####################################</div><div>    my($chr,$replace,$chromosome,$chr2NC)=@_;</div><div>    my $newchr=$chr;</div><div>    if ($chromosome=~/NC2chr/ &amp;&amp; $chr=~/^NC/)</div><div>    {</div><div>        $newchr=&amp;NC2chr($chr);</div><div>        $replace=~s/$chr/$newchr/g;</div><div>    }elsif($chromosome=~/chr2NC/ &amp;&amp; $chr=~/^chr/ &amp;&amp; exists $chr2NC-&gt;{$chr})</div><div>    {</div><div>        $newchr=$chr2NC-&gt;{$chr};</div><div>        $replace=~s/$chr/$newchr/g;</div><div>    }elsif($chromosome=~/num2chr/ &amp;&amp; $chr=~/^\d+|^X|^Y|^23|^24/)</div><div>    {</div><div>                if($chr=~/^23/)</div><div>                {</div><div>                        $newchr=&quot;chrX&quot;;</div><div>                }elsif($chr=~/^24/)</div><div>                {</div><div>                        $newchr=&quot;chrY&quot;;</div><div>                }else</div><div>                {</div><div>                        $newchr=&quot;chr$chr&quot;;</div><div>                }</div><div>                $replace=~s/$chr/$newchr/;</div><div>    }elsif($chromosome=~/chr2num/ &amp;&amp; $chr=~/^chr/)</div><div>    {</div><div>        $newchr=~s/chr//;</div><div>        $replace=~s/$chr/$newchr/g;</div><div>    }elsif($chromosome=~/num2NC/ &amp;&amp; $chr=~/^\d+|^X|^Y|^23|^24/)</div><div>    {</div><div>                if($chr=~/^23/)</div><div>                {</div><div>                        $newchr=$chr2NC-&gt;{&quot;chrX&quot;};</div><div>                        $replace=~s/$chr/$newchr/;</div><div>                }elsif($chr=~/^24/)</div><div>                {</div><div>                        $newchr=$chr2NC-&gt;{&quot;chrY&quot;};</div><div>                        $replace=~s/$chr/$newchr/;</div><div>                }else</div><div>                {</div><div>                        $newchr=$chr2NC-&gt;{&quot;chr$chr&quot;};</div><div>                        $replace=~s/$chr/$newchr/;</div><div>                };</div><div>    }elsif($chromosome=~/NC2num/ &amp;&amp; $chr=~/^NC/)</div><div>    {</div><div>        $newchr=&amp;NC2chr($chr);</div><div>        $newchr=~s/chr//;</div><div>        $replace=~s/$chr/$newchr/g;</div><div>    };</div><div>    return $replace;</div><div>};</div><div><br/></div><div>sub annotools_chrconvert</div><div>{</div><div>    my ($in,$out,$chromosome,$chr2NC)=@_;</div><div>    open L,&quot;$in&quot; or die;</div><div>    open O,&quot;&gt;$out&quot; or die;</div><div>    while (&lt;L&gt;)</div><div>    {</div><div>        chomp;</div><div>        next if(/^$/);</div><div>        my @arr=split /\t/,$_;</div><div>        my $return=&amp;chr_convert($arr[0],$_,$chromosome,$chr2NC);</div><div>        print O &quot;$return\n&quot;;</div><div>    };</div><div>    close L;</div><div>    close O;</div><div>};</div><div><br/></div><div>sub annotools_convert</div><div>{</div><div>    my($file,$out,$region,$chromosome,$chr2NC)=@_;</div><div>    my @region=split /[:-]/,$region;</div><div>    open L,&quot;$file&quot; or die;</div><div>    open O,&quot;&gt;$out&quot; or die;</div><div>    while (&lt;L&gt;)</div><div>    {</div><div>        chomp;</div><div>        next if(/^$/);</div><div>        if (/^\#/)</div><div>        {</div><div>            print O &quot;$_\n&quot;;</div><div>            next;</div><div>        };</div><div>        my @arr=split /\t/,$_,($region[4]+2);</div><div>        my @MUT=split /[,;]/,$arr[$region[4]];</div><div>        my $chr=$arr[$region[0]];</div><div>        $chr=&amp;chr_convert($chr,$chr,$chromosome,$chr2NC);</div><div>        foreach my $mut (@MUT)</div><div>        {</div><div>            my $start=(split /-/,$arr[$region[1]])[0];</div><div>            my $end=(split /-/,$arr[$region[2]])[-1];</div><div>            my $ref=$arr[$region[3]];</div><div>            ##################</div><div>            if($ref=~/^[ATCG]$/ &amp;&amp; $mut=~/^[ATCG]$/)</div><div>            {</div><div>            }elsif($ref=~/I|\-/)</div><div>            {</div><div>                $ref=&quot;-&quot;;</div><div>                $end=$start+1;    </div><div>            }elsif($mut=~/\-/)</div><div>            {</div><div>                $end=$start+length($ref)-1;</div><div>            }elsif($ref=~/D/)</div><div>            {</div><div>                $ref=$mut;</div><div>                $mut=&quot;-&quot;;</div><div>                $end=$start+length($mut)-1;</div><div>            }else</div><div>            {            </div><div>                my @REF=split //,$ref;</div><div>                my @ALT=split //,$mut;</div><div>                while (1)</div><div>                {</div><div>                    if (@REF&lt;1 || @ALT&lt;1)</div><div>                    {</div><div>                         last;</div><div>                    }elsif ($REF[0] eq $ALT[0])</div><div>                    {</div><div>                        $start+=1;</div><div>                        shift @REF;</div><div>                        shift @ALT;</div><div>                    }else</div><div>                    {</div><div>                        last;</div><div>                    };</div><div>                };</div><div><br/></div><div>                                while (1)</div><div>                                {</div><div>                                        if (@REF&lt;1 || @ALT&lt;1)</div><div>                                        {</div><div>                                                 last;</div><div>                                        }elsif($REF[-1] eq $ALT[-1])</div><div>                                        {</div><div>                                                pop @REF;</div><div>                                                pop @ALT;</div><div>                                        }else</div><div>                                        {</div><div>                                                last;</div><div>                                        };</div><div>                                };</div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div>                if(@REF==1 &amp;&amp; @ALT==1)</div><div>                {    </div><div>                    $end=$start;</div><div>                    $ref=$REF[0];</div><div>                    $mut=$ALT[0];</div><div>                }elsif(@REF&lt;1 &amp;&amp; @ALT&gt;=1)</div><div>                {</div><div>                    $ref=&quot;-&quot;;</div><div>                    $mut=join &quot;&quot;,@ALT;</div><div>                    $start-=1;</div><div>                    $end=$start+1;</div><div>                }elsif(@REF&gt;=1 &amp;&amp; @ALT&lt;1)</div><div>                {</div><div>                    $mut=&quot;-&quot;;</div><div>                    $ref=join &quot;&quot;,@REF;</div><div>                    $end=$start+length($ref)-1;</div><div>                }else</div><div>                {</div><div>                    $ref=join &quot;&quot;,@REF;</div><div>                    $mut=join &quot;&quot;,@ALT;</div><div>                    $end=$start+@REF-1;</div><div>                };</div><div>            };</div><div>            if(defined $arr[-1] &amp;&amp; ($arr[-1] ne $arr[$region[4]]))</div><div>            {</div><div>                print O &quot;$chr\t$start\t$end\t$ref\t$mut\t$arr[-1]\n&quot;;</div><div>            }else</div><div>            {</div><div>                print O &quot;$chr\t$start\t$end\t$ref\t$mut\n&quot;;</div><div>            };</div><div>        };</div><div>    };</div><div>    close L;</div><div>    close O;</div><div>};</div><div>sub annotools_sort</div><div>{</div><div>    my($file,$out)=@_;</div><div>    my %hash;</div><div>    open L,&quot;$file&quot; or die;</div><div>    my $head=&lt;L&gt;;</div><div>    while (&lt;L&gt;)</div><div>    {</div><div>        chomp;</div><div>        next if(/^$|^\#/);</div><div>        my @arr=split /\t/,$_;</div><div>        $hash{$arr[0]}{$arr[1]}{$arr[2]}{&quot;$arr[3]-$arr[4]&quot;}{$_}=1;</div><div>    };</div><div>    close L;</div><div>    ################################    </div><div>    open O,&quot;&gt;$out&quot; or die;</div><div>    print O &quot;$head&quot;;</div><div>    foreach my $chr(sort keys %hash)</div><div>    {</div><div>        foreach my $start(sort {$a &lt;=&gt; $b} keys %{$hash{$chr}})</div><div>        {</div><div>            foreach my $end(sort {$a &lt;=&gt; $b} keys %{$hash{$chr}{$start}})</div><div>            {</div><div>                foreach my $mut(sort keys %{$hash{$chr}{$start}{$end}})</div><div>                {</div><div>                    foreach my $value(sort keys %{$hash{$chr}{$start}{$end}{$mut}} )</div><div>                    {</div><div>                        print O &quot;$value\n&quot;;</div><div>                        delete $hash{$chr}{$start}{$end}{$mut}{$value};</div><div>                    };</div><div>                };</div><div>            };</div><div>        };</div><div>    };</div><div>    close O;</div><div>};</div><div>sub annotools_index</div><div>{</div><div>    my($file)=@_;</div><div>    my $out=&quot;$file\.idx&quot;;</div><div>    open L,&quot;$file&quot; or die;</div><div>    open O,&quot;&gt;$out&quot; or die;</div><div>    my $buff_chr;</div><div>    my $buff_start;</div><div>    my $seek=0;</div><div>    while (&lt;L&gt;)</div><div>    {</div><div>        chomp;</div><div>        next if(/^$|^\#/);</div><div>        my @arr=split /\t/,$_;</div><div>        if(!defined $buff_chr)</div><div>        {</div><div>            $seek=tell(L);</div><div>            print O &quot;$arr[0]\t$arr[1]\t$seek\n&quot;;</div><div>            $buff_chr=$arr[0];</div><div>            $buff_start=$arr[1];</div><div>        }else</div><div>        {</div><div>            if($arr[0] eq $buff_chr)</div><div>            {</div><div>                if(($arr[1]-$buff_start) &gt;= $idx)</div><div>                {</div><div>                    $seek=tell(L);</div><div>                    print O &quot;$arr[0]\t$arr[1]\t$seek\n&quot;;</div><div>                    $buff_start=$arr[1];</div><div>                };</div><div>            }elsif($arr[0] lt $buff_chr)</div><div>            {</div><div>                print STDERR &quot;\n\t the database file is error !!!\n\n&quot;;</div><div>                exit;</div><div>            }elsif($arr[0] gt $buff_chr)</div><div>            {</div><div>                $seek=tell(L);</div><div>                print O &quot;$arr[0]\t$arr[1]\t$seek\n&quot;;</div><div>                $buff_chr=$arr[0];</div><div>                $buff_start=$arr[1];</div><div>            };</div><div>        };</div><div>    };</div><div>    close L;</div><div>    close O;</div><div>};</div><div><br/></div><div>sub annotools_anno</div><div>{</div><div>    my($file,$database,$out)=@_;</div><div>    open IDX,&quot;$database\.idx&quot; or die &quot;\n\tplease check the database index file !!!\n\n&quot;;</div><div>    open L,&quot;$file&quot; or die;</div><div>    open D,&quot;$database&quot; or die;</div><div>    open O,&quot;&gt;$out&quot; or die;</div><div>    my %buff;</div><div>    my @idx=split /\t/,&lt;IDX&gt;;</div><div>    my $idx_tag=1;</div><div>    my $seek_down=0;</div><div><br/></div><div>CASE_A:while (&lt;L&gt;)</div><div>    {</div><div>        chomp;</div><div>        next if(/^$/);</div><div>        if (/^\#|^Chr|^CHR/)</div><div>        {</div><div>            print O &quot;$_\n&quot;;</div><div>            goto CASE_A;</div><div>        };</div><div>        my @arr=split /\t/,$_;</div><div>        while($idx_tag==1 &amp;&amp; (($arr[0] gt $idx[0]) || (($arr[0] eq $idx[0]) &amp;&amp; $arr[1]&gt;$idx[1])))</div><div>        {</div><div>            if($idx[2] &gt; $seek_down)</div><div>            {</div><div>                $seek_down=$idx[2];</div><div>                seek(D,$seek_down,0);</div><div>            };</div><div>            my $idx_content=&lt;IDX&gt;;</div><div>            if (defined $idx_content)</div><div>            {</div><div>                @idx=split /\t/,$idx_content;</div><div>            }else</div><div>            {</div><div>                $idx_tag=0;</div><div>                last;</div><div>            };</div><div>        };</div><div><br/></div><div>        my $report_tag=0;</div><div>        if (exists $buff{chr})</div><div>        {</div><div>            if($arr[0] lt $buff{chr})</div><div>            {</div><div>                print O &quot;&gt;$_\n\tunknown\n&quot;;</div><div>                goto CASE_A;</div><div>            }elsif($arr[0] gt $buff{chr})</div><div>            {</div><div>                goto CASE_B;</div><div>            }else</div><div>            {</div><div>                if($arr[1] &lt; $buff{start})</div><div>                {</div><div>                    print O &quot;&gt;$_\n\tunknown\n&quot;;</div><div>                    goto CASE_A;</div><div>                }elsif($arr[1] &gt; $buff{start})</div><div>                {</div><div>                    goto CASE_B;</div><div>                }else</div><div>                {</div><div>                    if($arr[2] &lt; $buff{end})</div><div>                    {</div><div>                        print O &quot;&gt;$_\n\tunknown\n&quot;;</div><div>                        goto CASE_A;</div><div>                    }elsif($arr[2] &gt; $buff{end})</div><div>                    {</div><div>                        goto CASE_B;</div><div>                    }else</div><div>                    {</div><div>                        if(&quot;$arr[3]-$arr[4]&quot; lt $buff{mut})</div><div>                        {</div><div>                            print O &quot;&gt;$_\n\tunknown\n&quot;;</div><div>                            goto CASE_A;</div><div>                        }elsif(&quot;$arr[3]-$arr[4]&quot; gt $buff{mut})</div><div>                        {</div><div>                            goto CASE_B;</div><div>                        }else</div><div>                        {</div><div>                            print O &quot;&gt;$_\n\t$buff{res}\n&quot;;</div><div>                            $report_tag=1;</div><div>                            goto CASE_B;</div><div>                        };</div><div>                    };</div><div>                };</div><div>            };</div><div>        };</div><div>    CASE_B:while (my $data=&lt;D&gt;)</div><div>        {</div><div>            chomp $data;</div><div>            next if($data=~/^$|^\#/);</div><div>            my @data=split /\t/,$data;</div><div>            $buff{chr}=$data[0];</div><div>            $buff{start}=$data[1];</div><div>            $buff{end}=$data[2];</div><div>            $buff{mut}=&quot;$data[3]-$data[4]&quot;;</div><div>            $buff{res}=$data;</div><div>            ###################################################</div><div>            if($arr[0] lt $buff{chr})</div><div>            {</div><div>                print O &quot;&gt;$_\n\tunknown\n&quot; if($report_tag==0);</div><div>                goto CASE_A;</div><div>            }elsif($arr[0] gt $buff{chr})</div><div>            {</div><div>                goto CASE_B;</div><div>            }else</div><div>            {</div><div>                if($arr[1] &lt; $buff{start})</div><div>                {</div><div>                    print O &quot;&gt;$_\n\tunknown\n&quot; if($report_tag==0);</div><div>                    goto CASE_A;</div><div>                }elsif($arr[1] &gt; $buff{start})</div><div>                {</div><div>                    goto CASE_B;</div><div>                }else</div><div>                {</div><div>                    if($arr[2] &lt; $buff{end})</div><div>                    {</div><div>                        print O &quot;&gt;$_\n\tunknown\n&quot; if($report_tag==0);</div><div>                        goto CASE_A;</div><div>                    }elsif($arr[2] &gt; $buff{end})</div><div>                    {</div><div>                        goto CASE_B;</div><div>                    }else</div><div>                    {</div><div>                        if(&quot;$arr[3]-$arr[4]&quot; lt $buff{mut})</div><div>                        {</div><div>                            print O &quot;&gt;$_\n\tunknown\n&quot; if($report_tag==0);</div><div>                            goto CASE_A;</div><div>                        }elsif(&quot;$arr[3]-$arr[4]&quot; gt $buff{mut})</div><div>                        {</div><div>                            goto CASE_B;</div><div>                        }else</div><div>                        {</div><div>                            if($report_tag==0)</div><div>                            {</div><div>                                print O &quot;&gt;$_\n\t$buff{res}\n&quot;;</div><div>                                $report_tag=1;</div><div>                            }else</div><div>                            {</div><div>                                print O &quot;\t$buff{res}\n&quot;;</div><div>                            };</div><div>                            goto CASE_B;</div><div>                        };</div><div>                    };</div><div>                };</div><div>            };</div><div>        };</div><div>    };</div><div>    close L;</div><div>    close D;</div><div>    close IDX;</div><div>    close O;</div><div>};</div><div><br/></div><div>sub annotools_addhead</div><div>{</div><div>    my($file,$HEAD)=@_;</div><div>    if (-f &quot;${$HEAD}[0]&quot;)</div><div>    {</div><div>        `cp ${$HEAD}[0] $file\.head`;</div><div>    }else</div><div>    {</div><div>        my $head=join &quot;\t&quot;,@{$HEAD};</div><div>        open L,&quot;&gt;$file\.head&quot; or die;</div><div>        print L&quot;#$head\n&quot;;</div><div>        close L;</div><div>    };</div><div>    `mv $file $file.bak`;</div><div>    `cat $file\.head $file.bak &gt;$file`;</div><div>    `rm $file\.head $file.bak`;</div><div>};</div><div>##############END</div><div><br/></div><div><br/></div></span>
</div></body></html> 