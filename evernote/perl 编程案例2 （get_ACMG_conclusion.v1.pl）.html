<html>
<head>
  <title>perl 编程案例2 （get_ACMG_conclusion.v1.pl）</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/600753 (zh-CN, DDL); Windows/10.0.0 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="421"/>
<h1>perl 编程案例2 （get_ACMG_conclusion.v1.pl）</h1>

<div>
<span><div><span style="color: rgb(255, 0, 0);">perl 编程案例2 （get_ACMG_conclusion.v1.pl）</span></div><div>#!/usr/bin/perl -w</div><div><br/></div><div>=head1 Usage</div><div><br/></div><div>    perl get_ACMG.v1.pl &lt;PM1+PM2+...&gt;</div><div><br/></div><div>=cut</div><div><br/></div><div>use strict;</div><div>use Cwd;</div><div>use Getopt::Long;</div><div>use Data::Dumper;</div><div>use FindBin qw($Bin $Script);</div><div>use File::Basename qw(basename dirname);</div><div>#######################################</div><div>my $acmg_evidence=shift;</div><div><br/></div><div>die `pod2text $0` if (!defined $acmg_evidence);</div><div><br/></div><div><br/></div><div>my @ACMG=split /\+/,$acmg_evidence;</div><div>@ACMG=&amp;get_uniq(@ACMG);</div><div><br/></div><div>my ($result,$result_real,$path_yj,$path_detail,$beni_yj,$beni_detail,$sub_tag)=&amp;get_acmg_result(@ACMG);</div><div><br/></div><div>print STDOUT &quot;$result\t$result_real\n&quot;;</div><div><br/></div><div>#########</div><div>sub get_uniq</div><div>{</div><div>    my @TMP=@_;</div><div>    my (%uniq,@tmp);</div><div>    foreach my $A (@TMP)</div><div>    {</div><div>        next if(!defined $A || $A=~/^$/);</div><div>        if (not exists $uniq{$A})</div><div>        {</div><div>            push @tmp,$A;</div><div>            $uniq{$A}=1;</div><div>        };</div><div>    };</div><div>    return @tmp;</div><div>};</div><div>#################</div><div>sub get_acmg_result</div><div>{</div><div>    my @arr=@_;</div><div>    my $tmp_tot=join &quot;\t&quot;,@arr;</div><div>    if ($tmp_tot=~/PS5/)</div><div>    {</div><div>        @arr=grep $_!~/^PM7|^PP1/,@arr;</div><div>    }elsif($tmp_tot=~/PM7/)</div><div>    {</div><div>        @arr=grep $_!~/^PP1/,@arr;</div><div>    };</div><div>    if ($tmp_tot=~/PM8/)</div><div>    {</div><div>        @arr=grep $_!~/^PP3/,@arr;</div><div>    };</div><div>    if ($tmp_tot=~/PS1/)    #PP5和PS1不要共存了,20180419_by_lzw</div><div>    {</div><div>        @arr=grep $_!~/^PP5/,@arr;</div><div>        @arr=grep $_!~/^BP4|^BP7/,@arr;    ######如果有致病性的PS1则不再获得预测无害的标签（BP4+BP7）,20180428_by_lzw</div><div>    };</div><div><br/></div><div>    my($result,$result_real,$path_yj,$path_detail,$beni_yj,$beni_detail,$sub_tag);</div><div>    #############################################################</div><div>    ###########################################################</div><div>    my %hash;</div><div>    my $other=&quot; &quot;;</div><div>    foreach my $tmp_a (@arr)</div><div>    {</div><div>        $tmp_a=&quot;$tmp_a($tmp_a)|$tmp_a&quot;;</div><div>        if ($tmp_a=~m/([a-zA-Z\d+]+)\((.*?)\)\|(.*)/)</div><div>        {</div><div>            my $zimu=$1;</div><div>            my $ms=$2;</div><div>            my $tag=$3;</div><div>            $ms=&quot;$zimu：$ms&quot;;</div><div>            if ($zimu=~/^PA/)</div><div>            {</div><div>                push @{$hash{PA}{zm}},$zimu;</div><div>                push @{$hash{PA}{ms}},&quot;PA&quot;.$ms;</div><div>                push @{$hash{PA}{tag}},$tag;</div><div>            }elsif ($zimu=~/^PVS/)</div><div>            {</div><div>                push @{$hash{PVS}{zm}},$zimu;</div><div>                push @{$hash{PVS}{ms}},&quot;PVS&quot;.$ms;</div><div>                push @{$hash{PVS}{tag}},$tag;</div><div>            }elsif ($zimu=~/^PS/)</div><div>            {</div><div>                push @{$hash{PS}{zm}},$zimu;</div><div>                push @{$hash{PS}{ms}},&quot;PS&quot;.$ms;</div><div>                push @{$hash{PS}{tag}},$tag;</div><div>            }elsif ($zimu=~/^PM/)</div><div>            {</div><div>                push @{$hash{PM}{zm}},$zimu;</div><div>                push @{$hash{PM}{ms}},&quot;PM&quot;.$ms;</div><div>                push @{$hash{PM}{tag}},$tag;</div><div>            }elsif ($zimu=~/^PP/)</div><div>            {</div><div>                push @{$hash{PP}{zm}},$zimu;</div><div>                push @{$hash{PP}{ms}},&quot;PP&quot;.$ms;</div><div>                push @{$hash{PP}{tag}},$tag;</div><div>            }elsif($zimu=~/^BA/)</div><div>            {</div><div>                push @{$hash{BA}{zm}},$zimu;</div><div>                push @{$hash{BA}{ms}},&quot;BA&quot;.$ms;</div><div>                push @{$hash{BA}{tag}},$tag;</div><div>            }elsif($zimu=~/^BS/)</div><div>            {</div><div>                push @{$hash{BS}{zm}},$zimu;</div><div>                push @{$hash{BS}{ms}},&quot;BS&quot;.$ms;</div><div>                push @{$hash{BS}{tag}},$tag;</div><div>            }elsif($zimu=~/^BP/)</div><div>            {</div><div>                push @{$hash{BP}{zm}},$zimu;</div><div>                push @{$hash{BP}{ms}},&quot;BP&quot;.$ms;</div><div>                push @{$hash{BP}{tag}},$tag;</div><div>            }else</div><div>            {</div><div>                $other.=&quot;$tmp_a;&quot;;</div><div>            };</div><div>        };</div><div>    };</div><div>    ####################</div><div>    my(@path_zm,@path_hz,@beni_zm,@beni_hz,@sub_tag);</div><div>    my @PATH=(&quot;PA|PA&quot;,&quot;PVS|PVS&quot;,&quot;PS|PS&quot;,&quot;PM|PM&quot;,&quot;PP|PP&quot;);</div><div>    for my $i(0..@PATH-1)</div><div>    {</div><div>        my ($key,$tmp)=split /\|/,$PATH[$i];</div><div>        if (exists $hash{$key})</div><div>        {</div><div>            push @path_zm,@{$hash{$key}{zm}};</div><div>            push @path_hz,@{$hash{$key}{ms}};</div><div>            push @sub_tag,@{$hash{$key}{tag}};</div><div>        };</div><div>    };</div><div>    my @BENIGN=(&quot;BA|BA&quot;,&quot;BS|BS&quot;,&quot;BP|BP&quot;);</div><div>    for my $i(0..@BENIGN-1)</div><div>    {</div><div>        my ($key,$tmp)=split /\|/,$BENIGN[$i];</div><div>        if (exists $hash{$key})</div><div>        {</div><div>            push @beni_zm,@{$hash{$key}{zm}};</div><div>            push @beni_hz,@{$hash{$key}{ms}};</div><div>            push @sub_tag,@{$hash{$key}{tag}};</div><div>        };</div><div>    };</div><div>    #############################################################</div><div>    ###########################################################</div><div>    if (@path_zm==0 || @beni_zm==0)</div><div>    {</div><div>        ##########用于智因无矛盾算法</div><div>        $result=&amp;get_acmg_value_1(\@arr);</div><div>    }else</div><div>    {</div><div>        ###################用于智因矛盾算法</div><div>        $result=&amp;get_acmg_value_2(\@arr);</div><div>    };</div><div><br/></div><div>    ##########用于标准ACMG算法</div><div>    $result_real=&amp;get_acmg_value_3(\@arr);</div><div>    ($result_real)=split /\(/,$result_real;</div><div><br/></div><div>    unshift (@sub_tag,$result);</div><div>    ($result)=split /\(/,$result;</div><div><br/></div><div>    ##########################################</div><div>    #############################################</div><div>    if (@path_zm&gt;0)</div><div>    {</div><div>        $path_yj=join &quot;+&quot;,@path_zm;</div><div>    }else</div><div>    {</div><div>        $path_yj=&quot;NA&quot;;</div><div>    };</div><div>    if (@path_hz&gt;0)</div><div>    {</div><div>        $path_detail=join &quot;+&quot;,@path_hz;</div><div>    }else</div><div>    {</div><div>        $path_detail=&quot;NA&quot;;</div><div>    };</div><div>    if (@beni_zm&gt;0)</div><div>    {</div><div>        $beni_yj=join &quot;+&quot;,@beni_zm;</div><div>    }else</div><div>    {</div><div>        $beni_yj=&quot;NA&quot;;</div><div>    };</div><div>    if (@beni_hz&gt;0)</div><div>    {</div><div>        $beni_detail=join &quot;+&quot;,@beni_hz;</div><div>    }else</div><div>    {</div><div>        $beni_detail=&quot;NA&quot;;</div><div>    };</div><div>    if (@sub_tag&gt;0)</div><div>    {</div><div>        $sub_tag=join &quot;+&quot;,@sub_tag;</div><div>    }else</div><div>    {</div><div>        $sub_tag=&quot;NA&quot;;</div><div>    };</div><div>    if ($other=~/ClinvarPath/)</div><div>    {</div><div>        $result=~s/Benign|Likely benign/Uncertain significance/g;</div><div>        $result_real=~s/Benign|Likely benign/Uncertain significance/g;</div><div>        if($sub_tag=~/Benign/)</div><div>        {</div><div>            $sub_tag=~s/Benign/Uncertain significance(Benign)/g;        </div><div>        }elsif($sub_tag=~/Likely benign/)</div><div>        {</div><div>            $sub_tag=~s/Likely benign/Uncertain significance(Likely benign)/g;        </div><div>        };</div><div>    };</div><div>    #############################################################</div><div>    ###########################################################</div><div>    my @RESULT=($result,$result_real,$path_yj,$path_detail,$beni_yj,$beni_detail,$sub_tag);</div><div>    return @RESULT;</div><div>};</div><div>############################</div><div>sub get_acmg_value_1        ##########用于智因无矛盾算法</div><div>{</div><div>    my ($acmg)=@_;</div><div>    my $result;</div><div>    my ($pa,$pvs,$ps,$pm,$pp,$ba,$bs,$bp,$sig_path,$sig_beni,$class)=(0,0,0,0,0,0,0,0,0,0,0,0);</div><div>    my $ba1=0;</div><div>    for (my $i=0;$i&lt;@{$acmg};$i++)</div><div>    {</div><div>        if ($$acmg[$i]=~/^PA/)</div><div>        {</div><div>            $pa++;</div><div>        }elsif ($$acmg[$i]=~/^PVS/)</div><div>        {</div><div>            $pvs++;</div><div>        }elsif ($$acmg[$i]=~/^PS/)</div><div>        {</div><div>            $ps++;</div><div>        }elsif ($$acmg[$i]=~/^PM/)</div><div>        {</div><div>            $pm++;</div><div>        }elsif ($$acmg[$i]=~/^PP/)</div><div>        {</div><div>            $pp++;</div><div>        }elsif ($$acmg[$i]=~/^BA/)</div><div>        {</div><div>            $ba++;</div><div>            $ba1++ if($$acmg[$i]=~/^BA1/);</div><div>        }elsif ($$acmg[$i]=~/^BS/)</div><div>        {</div><div>            $bs++;</div><div>        }elsif ($$acmg[$i]=~/^BP/)</div><div>        {</div><div>            $bp++;</div><div>        };</div><div>    };</div><div>    if ($pvs&gt;=1)</div><div>    {</div><div>        $sig_path=1;</div><div>        if ($ps&gt;=1)</div><div>        {</div><div>            $result=&quot;Pathogenic(I)(a)&quot;;</div><div>        }elsif($pm&gt;=2)</div><div>        {</div><div>            $result=&quot;Pathogenic(I)(b)&quot;;</div><div>        }elsif($pm==1 and $pp==1)</div><div>        {</div><div>            $result=&quot;Pathogenic(I)(c)&quot;;</div><div>        }elsif($pp&gt;=2)</div><div>        {</div><div>            $result=&quot;Pathogenic(I)(d)&quot;;</div><div>        }else</div><div>        {</div><div>            $sig_path=0;</div><div>        };</div><div>    }elsif ($ps&gt;=2)</div><div>    {</div><div>        $sig_path=1;</div><div>        $result=&quot;Pathogenic(II)&quot;;</div><div>    }elsif ($ps==1)</div><div>    {</div><div>        $sig_path=1;</div><div>        if ($pm&gt;=3)</div><div>        {</div><div>            $result=&quot;Pathogenic(III)(a)&quot;;</div><div>        }elsif($pm==2 and $pp&gt;=2)</div><div>        {</div><div>            $result=&quot;Pathogenic(III)(b)&quot;;</div><div>        }elsif($pm==1 and $pp&gt;=4)</div><div>        {</div><div>            $result=&quot;Pathogenic(III)(c)&quot;;</div><div>        }else</div><div>        {</div><div>            $sig_path=0;</div><div>        };</div><div>    };</div><div>    if ($ba&gt;=1)</div><div>    {</div><div>        $sig_beni=1;</div><div>        $result=&quot;Benign(I)&quot;;</div><div>    }elsif($bs&gt;=2)</div><div>    {</div><div>        $sig_beni=1;</div><div>        $result=&quot;Benign(II)&quot;;</div><div>    };</div><div><br/></div><div>    if ($ba1&gt;=1)</div><div>    {</div><div>        $result=&quot;Benign(I)&quot;;</div><div>    }elsif ($pa&gt;=1)</div><div>    {</div><div>        $result=&quot;Pathogenic(I)&quot;;</div><div>    }elsif($sig_path&gt;=1 &amp;&amp; $sig_beni&gt;=1)</div><div>    {</div><div>        $result=&quot;Uncertain significance(II)&quot;;</div><div>    }elsif ($sig_path==0 &amp;&amp; $sig_beni==0)</div><div>    {</div><div>        if ($pvs==1 and $pm==1)</div><div>        {</div><div>            $result=&quot;Likely pathogenic(I)&quot;;</div><div>        }elsif($ps==1 and ($pm==1 or $pm==2))</div><div>        {</div><div>            $result=&quot;Likely pathogenic(II)&quot;;</div><div>        }elsif($ps==1 and $pp&gt;=2)</div><div>        {</div><div>            $result=&quot;Likely pathogenic(III)&quot;;</div><div>        }elsif($pm&gt;=3)</div><div>        {</div><div>            $result=&quot;Likely pathogenic(IV)&quot;;</div><div>        }elsif($pm==2 and $pp&gt;=2)</div><div>        {</div><div>            $result=&quot;Likely pathogenic(V)&quot;;</div><div>        }elsif($pm==1 and $pp&gt;=4)</div><div>        {</div><div>            $result=&quot;Likely pathogenic(VI)&quot;;</div><div>        }elsif ($bs==1 and $bp==1)</div><div>        {</div><div>            $result=&quot;Likely benign(I)&quot;;</div><div>        }elsif($bp&gt;=2)</div><div>        {</div><div>            $result=&quot;Likely benign(II)&quot;;</div><div>        }else</div><div>        {</div><div>            $result=&quot;Uncertain significance(I)&quot;;</div><div>        };</div><div>    };</div><div>    return $result;</div><div>};</div><div>#####################################################################################</div><div>sub get_acmg_value_2        ###################用于智因矛盾算法</div><div>{</div><div>    my ($acmg)=@_;</div><div>    my $result;</div><div>    my $tot_score=0;</div><div>    for (my $i=0;$i&lt;@{$acmg};$i++)</div><div>    {</div><div>        if ($$acmg[$i]=~/^PA/)</div><div>        {</div><div>            $tot_score+=35;</div><div>        }elsif ($$acmg[$i]=~/^PVS/)</div><div>        {</div><div>            $tot_score+=12;</div><div>        }elsif ($$acmg[$i]=~/^PS/)</div><div>        {</div><div>            $tot_score+=10;</div><div>        }elsif ($$acmg[$i]=~/^PM/)</div><div>        {</div><div>            $tot_score+=4;</div><div>        }elsif ($$acmg[$i]=~/^PP/)</div><div>        {</div><div>            $tot_score+=3;</div><div>        }elsif ($$acmg[$i]=~/^BA/)</div><div>        {</div><div>            $tot_score-=32;</div><div>        }elsif ($$acmg[$i]=~/^BS/)</div><div>        {</div><div>            if ($$acmg[$i]=~/^BS4/)        ########20180322 BS4不减分，仅展示结果</div><div>            {</div><div>                $tot_score-=0;</div><div>            }else</div><div>            {</div><div>                $tot_score-=15;</div><div>            };</div><div>        }elsif ($$acmg[$i]=~/^BP/)</div><div>        {</div><div>            $tot_score-=3;</div><div>        };</div><div>    };</div><div>    ###############</div><div>    if ($tot_score&gt;15)</div><div>    {</div><div>        $result=&quot;Pathogenic($tot_score)&quot;;</div><div>    }elsif($tot_score&gt;=9)</div><div>    {</div><div>        $result=&quot;Likely pathogenic($tot_score)&quot;;</div><div>    }elsif($tot_score&gt;-3)</div><div>    {</div><div>        $result=&quot;Uncertain significance($tot_score)&quot;;</div><div>    }elsif($tot_score&gt;=-27)</div><div>    {</div><div>        $result=&quot;Likely benign($tot_score)&quot;;</div><div>    }else</div><div>    {</div><div>        $result=&quot;Benign($tot_score)&quot;;</div><div>    };</div><div>    ######################</div><div>    return $result;</div><div>};</div><div>############################</div><div>sub get_acmg_value_3        ##########用于标准ACMG算法</div><div>{</div><div>    my ($acmg)=@_;</div><div>    my $result;</div><div>    my ($pa,$pvs,$ps,$pm,$pp,$ba,$bs,$bp)=(0,0,0,0,0,0,0,0);</div><div>    for (my $i=0;$i&lt;@{$acmg};$i++)</div><div>    {</div><div>        if ($$acmg[$i]=~/^PA/)</div><div>        {</div><div>            $pa++;</div><div>        }elsif ($$acmg[$i]=~/^PVS/)</div><div>        {</div><div>            $pvs++;</div><div>        }elsif ($$acmg[$i]=~/^PS/)</div><div>        {</div><div>            $ps++;</div><div>        }elsif ($$acmg[$i]=~/^PM/)</div><div>        {</div><div>            $pm++;</div><div>        }elsif ($$acmg[$i]=~/^PP/)</div><div>        {</div><div>            $pp++;</div><div>        }elsif ($$acmg[$i]=~/^BA/)</div><div>        {</div><div>            $ba++;</div><div>        }elsif ($$acmg[$i]=~/^BS/)</div><div>        {</div><div>            $bs++;</div><div>        }elsif ($$acmg[$i]=~/^BP/)</div><div>        {</div><div>            $bp++;</div><div>        };</div><div>    };</div><div>    #############################################</div><div>    if ($pvs&gt;=1)</div><div>    {</div><div>        if ($ps&gt;=1)</div><div>        {</div><div>            $result.=&quot;Pathogenic(I)(a)&quot;;</div><div>        }elsif($pm&gt;=2)</div><div>        {</div><div>            $result.=&quot;Pathogenic(I)(b)&quot;;</div><div>        }elsif($pm==1 and $pp==1)</div><div>        {</div><div>            $result.=&quot;Pathogenic(I)(c)&quot;;</div><div>        }elsif($pp&gt;=2)</div><div>        {</div><div>            $result.=&quot;Pathogenic(I)(d)&quot;;</div><div>        };</div><div>    }elsif ($ps&gt;=2)</div><div>    {</div><div>        $result.=&quot;Pathogenic(II)&quot;;</div><div>    }elsif ($ps==1)</div><div>    {</div><div>        if ($pm&gt;=3)</div><div>        {</div><div>            $result.=&quot;Pathogenic(III)(a)&quot;;</div><div>        }elsif($pm==2 and $pp&gt;=2)</div><div>        {</div><div>            $result.=&quot;Pathogenic(III)(b)&quot;;</div><div>        }elsif($pm==1 and $pp&gt;=4)</div><div>        {</div><div>            $result.=&quot;Pathogenic(III)(c)&quot;;</div><div>        };</div><div>    };</div><div>    #############################################</div><div>    if ($ba&gt;=1)</div><div>    {</div><div>        $result.=&quot;Benign(I)&quot;;</div><div>    }elsif($bs&gt;=2)</div><div>    {</div><div>        $result.=&quot;Benign(II)&quot;;</div><div>    };</div><div>    #############################################</div><div>    if ($pvs==1 and $pm==1)</div><div>    {</div><div>        $result.=&quot;Likely pathogenic(I)&quot;;</div><div>    }elsif($ps==1 and ($pm==1 or $pm==2))</div><div>    {</div><div>        $result.=&quot;Likely pathogenic(II)&quot;;</div><div>    }elsif($ps==1 and $pp&gt;=2)</div><div>    {</div><div>        $result.=&quot;Likely pathogenic(III)&quot;;</div><div>    }elsif($pm&gt;=3)</div><div>    {</div><div>        $result.=&quot;Likely pathogenic(IV)&quot;;</div><div>    }elsif($pm==2 and $pp&gt;=2)</div><div>    {</div><div>        $result.=&quot;Likely pathogenic(V)&quot;;</div><div>    }elsif($pm==1 and $pp&gt;=4)</div><div>    {</div><div>        $result.=&quot;Likely pathogenic(VI)&quot;;</div><div>    };</div><div>    #############################################</div><div>    if ($bs&gt;=1 and $bp&gt;=1)</div><div>    {</div><div>        $result.=&quot;Likely benign(I)&quot;;</div><div>    }elsif($bp&gt;=2)</div><div>    {</div><div>        $result.=&quot;Likely benign(II)&quot;;</div><div>    };</div><div>    #########################</div><div><br/></div><div>    if (!defined $result)</div><div>    {</div><div>        $result=&quot;Uncertain significance&quot;;</div><div>    }elsif ($result=~/pathogenic/i &amp;&amp; $result=~/benign/i)</div><div>    {</div><div>        $result=&quot;Uncertain significance&quot;;</div><div>    }elsif($result=~/Pathogenic/)</div><div>    {</div><div>        $result=&quot;Pathogenic&quot;;</div><div>    }elsif($result=~/pathogenic/)</div><div>    {</div><div>        $result=&quot;Likely pathogenic&quot;;</div><div>    }elsif($result=~/Benign/)</div><div>    {</div><div>        $result=&quot;Benign&quot;;</div><div>    }elsif($result=~/benign/)</div><div>    {</div><div>        $result=&quot;Likely benign&quot;;</div><div>    }else</div><div>    {</div><div>        $result=&quot;Uncertain significance&quot;;</div><div>    };</div><div>    return $result;</div><div>};</div><div><br/></div></span>
</div></body></html> 