<html>
<head>
  <title>perl 编程案例3 (SVG作图-碱基质量错误率)</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/600753 (zh-CN, DDL); Windows/10.0.0 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="417"/>
<h1>perl 编程案例3 (SVG作图-碱基质量错误率)</h1>

<div>
<span><div><span style="font-size: 12pt; color: rgb(255, 0, 0);">perl 编程案例3  (SVG作图-碱基质量错误率)</span></div><div><br/></div><div>#!/usr/bin/perl</div><div>use strict;</div><div>use warnings;</div><div>use Cwd;</div><div>use Getopt::Long;</div><div>use Data::Dumper;</div><div>use FindBin qw($Bin $Script);</div><div>use File::Basename qw(basename dirname);</div><div><br/></div><div>my $file;</div><div>my $out;</div><div>my $X;</div><div>my $Y;</div><div>GetOptions</div><div>(</div><div>        &quot;i=s&quot;         =&gt; \$file,</div><div>        &quot;l=i&quot;    =&gt; \$X,</div><div>        &quot;w=i&quot;    =&gt; \$Y,</div><div>        &quot;od=s&quot;          =&gt; \$out</div><div>);</div><div><br/></div><div>my $usage=&quot;</div><div>        perl $0 -i &lt;input.file&gt; -od ./output.dir\n</div><div>        -i              map_stat</div><div>        -l              page Length</div><div>        -w              page width</div><div>        -od             output directory</div><div>&quot;;</div><div><br/></div><div>if(!defined $file or !defined $out)</div><div>{</div><div>    die &quot;$usage&quot;；</div><div>};</div><div>mkdir($out)if(!-d $out);</div><div><br/></div><div>if(!defined $X){$X=1200};</div><div>if(!defined $Y){$Y=1000};</div><div><br/></div><div>open L, &quot;$file&quot; or die &quot;$!&quot;;</div><div>my @array1;</div><div>my %hash;</div><div>while (&lt;L&gt;)</div><div>{    </div><div>    next if(/^$/);</div><div>    if($_=~/^MQ/)</div><div>    {</div><div>        @array1=split /\s+/,$_;</div><div>    }else</div><div>    {</div><div>        chomp;</div><div>        my @array2=split /\s+/,$_;</div><div>        my $len=@array2;</div><div>        my $sum=0;</div><div>        for (my $i=1;$i&lt;$len ;$i++)</div><div>            {</div><div>            $sum+=$array2[$i]*$array1[$i]*100;</div><div>            };</div><div>        $sum=$sum/100;</div><div>        my $error=10**(-$sum/10);</div><div>        $hash{$array2[0]}=$error;</div><div>    };</div><div>};</div><div>close L;</div><div><br/></div><div>sub get_min            </div><div>{</div><div>    my $min_value=pop @_;</div><div>    foreach (@_){</div><div>        if ($_ &lt;=$min_value )</div><div>            {$min_value=$_}</div><div>        };</div><div>    chomp $min_value;</div><div>    $min_value;</div><div>};</div><div><br/></div><div>###my $temp1=&amp;get_min(@array1);</div><div>###my $temp2=$hash{$temp1};</div><div><br/></div><div>open K,&quot;&gt;$out/Error_Rate.svg&quot; or die &quot;$!\n&quot;;</div><div><br/></div><div>my $svg.=&amp;svg_paper(-1/5*$X,-1/5*$Y,$X*7/5,$Y*7/5,&quot;gray&quot;);##########insert black_box</div><div>$svg.=&amp;svg_line(0,0,$X,0,&quot;black&quot;,4);</div><div>$svg.=&amp;svg_line(0,0,0,$Y,&quot;black&quot;,4);</div><div>$svg.=&amp;svg_line($X,$Y,0,$Y,&quot;black&quot;,4);</div><div>$svg.=&amp;svg_line($X,$Y,$X,0,&quot;black&quot;,4);</div><div><br/></div><div>my $X_scale=3.8;</div><div>my $Y_scale=1500000;</div><div><br/></div><div>my $interval=$X/10;##########insert X _interval</div><div>for (my $i=0;$i&lt;=10;$i++)</div><div>{</div><div>    $svg.=&amp;svg_line($i*$interval,12,$i*$interval,0,&quot;black&quot;,4);</div><div>    $svg.=&amp;svg_line($i*$interval,($Y-12),$i*$interval,$Y,&quot;black&quot;,4);</div><div>    if ($i&gt;1)</div><div>        {</div><div>        my $temp1=($i-1)*$interval/$X_scale;</div><div>        my $temp2=sprintf &quot;%.0f&quot;,$temp1;</div><div>        $svg.=&amp;svg_mid_txt(($i-1)*$interval,(105/100*$Y),30,&quot;black&quot;,$temp2);</div><div>        };</div><div>};</div><div><br/></div><div>my $interval2=$Y/8;##########insert Y _interval</div><div>#my $temp=$interval2*100000/$sum;</div><div>#my $interval3=sprintf &quot;%.2f&quot;,$temp;</div><div><br/></div><div>for (my $j=0;$j&lt;=8;$j++)</div><div>{</div><div>    $svg.=&amp;svg_line(0,$j*$interval2,12,$j*$interval2,&quot;black&quot;,4);</div><div>    $svg.=&amp;svg_line($X,$j*$interval2,($X-12),$j*$interval2,&quot;black&quot;,4);</div><div>    if ($j&gt;1)</div><div>    {</div><div>        my $temp1=(9-$j)*$interval2/$Y_scale*100;</div><div>        my $temp2=sprintf &quot;%.2f&quot;,$temp1;</div><div>        $svg.=&amp;svg_mid_txt((-5/100*$X),($j-1)*$interval2,30,&quot;black&quot;,$temp2);</div><div>    };</div><div>};</div><div><br/></div><div>$svg.=&amp;svg_mid_txt($X/2,-$Y/20,50,&quot;black&quot;,&quot;% Error Rate&quot;);</div><div>$svg.=&amp;svg_mid_txt($X/2,(11/10*$Y),40,&quot;black&quot;,&quot;Position along reads&quot;);</div><div>$svg.=&amp;svg_mid_txt((-1/10*$X),$Y/2,40,&quot;black&quot;,&quot;% Error-Rate&quot;,3);</div><div><br/></div><div>foreach my $key1(sort {$a &lt;=&gt; $b} keys %hash)##########insert line</div><div>{</div><div>    ###$svg.=&amp;svg_circle($key1,(0-$hash{$key1})/200+$Y,4,&quot;red&quot;);    </div><div>    $svg.=&amp;svg_line($X_scale*$key1,$Y,$X_scale*$key1,($Y-$Y_scale*$hash{$key1}),&quot;red&quot;,1);</div><div>}</div><div>$svg.=&amp;svg_end;</div><div><br/></div><div>print K $svg;</div><div>close K;</div><div><br/></div><div>#####sub svg_mid_txt{ #&amp;svg_mid_txt(x,y,size,color,text,[vertical,0/1/2/3]);</div><div>####$svg.=&amp;svg_rect(0,0,200,200,&quot;blue&quot;,&quot;yellow&quot;,200);</div><div>#$svg.=&amp;svg_txt(500,0,10,&quot;red&quot;,&quot;Hello world&quot;);</div><div>####################Subs</div><div>sub svg_paper (){#&amp;svg_paper(x,y,width,height,[color])</div><div>    my $svg_drawer = getlogin().&quot;@&quot;.(`hostname`);</div><div>    chomp $svg_drawer;</div><div>    my @svg_x=@_;</div><div>    my $line=&quot;&quot;;</div><div>    $line.=&quot;&lt;?xml version=\&quot;1.0\&quot; encoding=\&quot;iso-8859-1\&quot;?&gt;\n&quot;;</div><div>    $line.=&quot;&lt;!DOCTYPE svg PUBLIC \&quot;-//W3C//DTD SVG 20001102//EN\&quot; \&quot;<a href="http://www.w3.org/TR/2000/CR-SVG-20001102/DTD/svg-20001102.dtd">http://www.w3.org/TR/2000/CR-SVG-20001102/DTD/svg-20001102.dtd</a>\&quot;&gt;\n\n&quot;;</div><div>    $line.=&quot;&lt;svg width=\&quot;$svg_x[2]\&quot; height=\&quot;$svg_x[3]\&quot; viewBox=\&quot;$svg_x[0] $svg_x[1] $svg_x[2] $svg_x[3]\&quot;&gt;\n&quot;;</div><div>    $line.=&quot;&lt;Drawer&gt;$svg_drawer&lt;/Drawer&gt;\n&quot;;</div><div>    $line.=&quot;&lt;Date&gt;&quot;.(localtime()).&quot;&lt;/Date&gt;\n&quot;;</div><div>    if (defined $svg_x[4]) {</div><div>        $line.=&quot;&lt;rect x=\&quot;$svg_x[0]\&quot; y=\&quot;$svg_x[1]\&quot; width=\&quot;$svg_x[2]\&quot; height=\&quot;$svg_x[3]\&quot; fill=\&quot;$svg_x[4]\&quot;/&gt;\n&quot;;</div><div>    }</div><div>    return $line;</div><div>}</div><div>sub svg_circle  #&amp;svg_circle(x,y,r,color,[info])</div><div>{</div><div>    my @svg_x=@_;</div><div>    my $line=&quot;&lt;circle r=\&quot;$svg_x[2]\&quot; cx=\&quot;$svg_x[0]\&quot; cy=\&quot;$svg_x[1]\&quot; fill=\&quot;$svg_x[3]\&quot; /&gt;\n&quot;;</div><div>    if (defined $svg_x[4]) {</div><div>        $line=&quot;&lt;circle r=\&quot;$svg_x[2]\&quot; cx=\&quot;$svg_x[0]\&quot; cy=\&quot;$svg_x[1]\&quot; fill=\&quot;$svg_x[3]\&quot; onclick=\&quot;alert('$svg_x[4]')\&quot; onmousemove=\&quot;window.status='$svg_x[4]'\&quot; /&gt;\n&quot;;</div><div>    }</div><div>    return $line;</div><div>}</div><div>sub svg_line{  #&amp;svg_line(x1,y1,x2,y2,color,[width])</div><div>    my @svg_x=@_;</div><div>    my $line=&quot;&lt;line fill=\&quot;$svg_x[4]\&quot; stroke=\&quot;$svg_x[4]\&quot; x1=\&quot;$svg_x[0]\&quot; y1=\&quot;$svg_x[1]\&quot; x2=\&quot;$svg_x[2]\&quot; y2=\&quot;$svg_x[3]\&quot;/&gt;\n&quot;;</div><div>    if (defined $svg_x[5]) {</div><div>        $line=&quot;&lt;line fill=\&quot;$svg_x[4]\&quot; stroke=\&quot;$svg_x[4]\&quot; stroke-width=\&quot;$svg_x[5]\&quot; x1=\&quot;$svg_x[0]\&quot; y1=\&quot;$svg_x[1]\&quot; x2=\&quot;$svg_x[2]\&quot; y2=\&quot;$svg_x[3]\&quot;/&gt;\n&quot;;</div><div>    }</div><div>    return $line;</div><div>}</div><div><br/></div><div>sub svg_txt { #&amp;svg_txt(x,y,size,color,text,[vertical,0/1/2/3]);</div><div><br/></div><div>    my @svg_x=@_;</div><div>    if (!defined $svg_x[5]) {</div><div>        $svg_x[5]=0;</div><div>    }</div><div>    my $svg_matrix='';</div><div>    if ($svg_x[5]==0) {</div><div>        $svg_matrix=&quot;1 0 0 1&quot;;</div><div>    }</div><div>    if ($svg_x[5]==1) {</div><div>        $svg_matrix=&quot;0 1 -1 0&quot;;</div><div>    }</div><div>    if ($svg_x[5]==2) {</div><div>        $svg_matrix=&quot;-1 0 0 -1&quot;;</div><div>    }</div><div>    if ($svg_x[5]==3) {</div><div>        $svg_matrix=&quot;0 -1 1 0&quot;;</div><div>    }</div><div>    my $line=&quot;&lt;text fill=\&quot;$svg_x[3]\&quot; transform=\&quot;matrix($svg_matrix $svg_x[0] $svg_x[1])\&quot; font-family=\&quot;ArialNarrow-Bold\&quot; font-size=\&quot;$svg_x[2]\&quot;&gt;$svg_x[4]&lt;/text&gt;\n&quot;;</div><div>    return $line;</div><div>}</div><div><br/></div><div>sub svg_mid_txt{ #&amp;svg_mid_txt(x,y,size,color,text,[vertical,0/1/2/3]);</div><div>    my @svg_x=@_;</div><div>    if (!defined $svg_x[5]) {</div><div>        $svg_x[5]=0;</div><div>    }</div><div>    my $svg_matrix='';</div><div>    if ($svg_x[5]==0) {</div><div>        $svg_matrix=&quot;1 0 0 1&quot;;</div><div>    }</div><div>    if ($svg_x[5]==1) {</div><div>        $svg_matrix=&quot;0 1 -1 0&quot;;</div><div>    }</div><div>    if ($svg_x[5]==2) {</div><div>        $svg_matrix=&quot;-1 0 0 -1&quot;;</div><div>    }</div><div>    if ($svg_x[5]==3) {</div><div>        $svg_matrix=&quot;0 -1 1 0&quot;;</div><div>    }</div><div>    my $line=&quot;&lt;text fill=\&quot;$svg_x[3]\&quot; transform=\&quot;matrix($svg_matrix $svg_x[0] $svg_x[1])\&quot; text-anchor=\&quot;middle\&quot; font-family=\&quot;ArialNarrow-Bold\&quot; font-size=\&quot;$svg_x[2]\&quot;&gt;$svg_x[4]&lt;/text&gt;\n&quot;;</div><div>    return $line;</div><div>}</div><div><br/></div><div>sub svg_rect () {#&amp;svg_rect(x,y,width,height,fill_color,stroke_color,strock_width,[opacity],postion,r2)</div><div>    my @svg_x=@_;</div><div>    my $line;</div><div>    if (!defined $svg_x[7]) {</div><div>        $svg_x[7]=1;</div><div>    }</div><div>    if (defined $svg_x[8] &amp;&amp; defined $svg_x[9] ) {</div><div>        $line=&quot;&lt;rect x=\&quot;$svg_x[0]\&quot; y=\&quot;$svg_x[1]\&quot; width=\&quot;$svg_x[2]\&quot; height=\&quot;$svg_x[3]\&quot; style=\&quot;fill:$svg_x[4];stroke:$svg_x[5];stroke-width:$svg_x[6];fill-opacity:$svg_x[7]\&quot; onmousemove=\&quot;window.status='postion:$svg_x[8]\\tr2 apart 10 Kb:$svg_x[9]'\&quot; onclick=\&quot;alert('postion:$svg_x[8]\\nr2 apart 10 Kb:$svg_x[9]')\&quot; /&gt;\n&quot;;</div><div>    }</div><div>    else {</div><div>        $line=&quot;&lt;rect x=\&quot;$svg_x[0]\&quot; y=\&quot;$svg_x[1]\&quot; width=\&quot;$svg_x[2]\&quot; height=\&quot;$svg_x[3]\&quot; style=\&quot;fill:$svg_x[4];stroke:$svg_x[5];stroke-width:$svg_x[6];fill-opacity:$svg_x[7]\&quot; /&gt;\n&quot;;</div><div>    }</div><div>    return $line;</div><div>}</div><div><br/></div><div>sub svg_end (){#</div><div>    return &quot;&lt;/svg&gt;\n&quot;;</div><div>}</div><div><br/></div></span>
</div></body></html> 