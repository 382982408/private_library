<html>
<head>
  <title>perl 编程案例6 （gene注释）</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/600753 (zh-CN, DDL); Windows/10.0.0 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="412"/>
<h1>perl 编程案例6 （gene注释）</h1>

<div>
<span><div><span style="font-size: 18.6667px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(255, 0, 0); font-family: 微软雅黑; font-variant-caps: normal; font-variant-ligatures: normal;">perl 编程案例6 （gene注释）</span></div><div><span style="font-size: 18.6667px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><br/></span></div><div>#!/usr/bin/perl -w</div><div>#</div><div># Copyright (c) BLD 2015-2017</div><div># Writer:         heh &lt;<a href="mailto:hehua0226@163.com">hehua0226@163.com</a>&gt;</div><div># Program Date:   2016/03/28</div><div># Modifier:       heh &lt;<a href="mailto:hehua@zhuanhuayixue.org">hehua@zhuanhuayixue.org</a>&gt;</div><div># Last Modified:  2016/12/5</div><div>my $ver=&quot;1.0&quot;;</div><div>use strict;</div><div>use Cwd;</div><div>use Getopt::Long;</div><div>use Data::Dumper;</div><div>use FindBin qw($Bin $Script);</div><div>use File::Basename qw(basename dirname);</div><div>my ($varfile,$out,$help,$conf,$file,$trans_fa,$refSeq_INDEL);</div><div>my $format=&quot;vcf&quot;;</div><div><br/></div><div>my $par_conf=&quot;$Bin/../db/Z_lzw_database/CONFIG_ALL.txt&quot;;</div><div>my %parameters;</div><div>&amp;initialize($par_conf,\%parameters);</div><div>$file=$parameters{D36};</div><div>$trans_fa=$parameters{D37};</div><div>$refSeq_INDEL=$parameters{D38};</div><div>########################################</div><div><br/></div><div>my $edge=0;</div><div>my $ncRNA_anno;</div><div><br/></div><div>GetOptions(&quot;i=s&quot;=&gt;\$varfile,&quot;f=s&quot;=&gt;\$format,&quot;r=s&quot;=&gt;\$file,&quot;seq=s&quot;=&gt;\$trans_fa,</div><div>        &quot;m=s&quot;=&gt;\$refSeq_INDEL,&quot;e=s&quot;=&gt;\$edge,&quot;nc&quot;=&gt;\$ncRNA_anno,</div><div>        &quot;conf=s&quot;=&gt;\$conf,&quot;o=s&quot;=&gt;\$out,&quot;h&quot;=&gt;\$help</div><div>        );</div><div>&amp;help if(!$conf || !$varfile || !$out || $help );</div><div>sub help{</div><div>    print &lt;&lt;&quot;    usage End.&quot;;</div><div>    </div><div>    Version  : $ver  17/6/14</div><div><br/></div><div>    Author   : heh (hehua\@<a href="http://zhuanhuayixue.org/">zhuanhuayixue.org</a>)</div><div>    Function : Variant to annotation:gene,gene\'s strand,nucleic acid changes,amino acid</div><div>    changes,etc.</div><div><br/></div><div>    usage:</div><div>        perl $0 -i inputvar.txt -o output.txt [-r refGene.txt -seq refGeneMrna.fa]</div><div>        </div><div>        -i       input variant vcf or table file</div><div>        -f       input variant file format: vcf , table [$format]</div><div>        -r       input databse file[$file]</div><div>        -m       input refSeq Alignment INDEL file[$refSeq_INDEL]</div><div>        -seq     input mRNA fasta file[$trans_fa]</div><div>        -e       annotation distance to gene/transcript[$edge]</div><div>        -nc      annotation ncRNA[null]</div><div>        -o       output file(eg: output.txt and output.txt.not_on_gene);</div><div>        -conf    input configure file for mRNA files[$par_conf]</div><div>        -h       help</div><div>        </div><div>        Table format: chr  start end  reference  alt</div><div>          chr11  1642188  1642188  G   A</div><div>          chr11  1642189  1642189  G   -</div><div>          chr11  1642188  1642189  -   AGA</div><div><br/></div><div>        Output Infomations:</div><div>        1. p-splicing     : edge 3bp of exon</div><div>        2. splicing       : 2-bp of a splicing junction</div><div>        3. stop           : Mutation on stop codon,but no effect,eg p.X123Xfs*1</div><div>        4. stopgain       : Mutation causing early termination,or insert stop</div><div>        5. stoploss       : Mutation on stop codon,and change to other</div><div>        6. initiation     : Mutation on initiation codon</div><div>        7. no_correct_orf : not correct ORF of mRNA sequence, cds postion maybe wrong</div><div>        8. no_correct_cds : not 3 integer multiple of cds(mRNA) length, cds postion maybe wrong</div><div>        9. NM_183416#chr1#10270764 : NM_183416 is mRNA ID ,chr1#10270764 is start postion of NM_183416.</div><div>        10. n.1129        : the mRNA(or gene) is non-coding</div><div>        11. error file    : output not correct of reference or mutation base</div><div>        12. not_on_gene file : output  not on gene mutation</div><div><br/></div><div>    usage End.</div><div>    exit;</div><div>}</div><div>#        1. gene infoamtion: HES4:57801:608060 is name(HES4),GeneID(57801),MIM(608060),update version later</div><div>###############Time</div><div>my $Time_Start;</div><div>$Time_Start = sub_format_datetime(localtime(time()));</div><div>print &quot;\nStart Time :[$Time_Start]\n\n&quot;;</div><div>##############</div><div>my %codon = ( &quot;TTT&quot;=&gt;&quot;F&quot;,&quot;TTC&quot;=&gt;&quot;F&quot;,&quot;TCT&quot;=&gt;&quot;S&quot;, &quot;TCC&quot;=&gt;&quot;S&quot;, &quot;TAT&quot;=&gt;&quot;Y&quot;, &quot;TAC&quot;=&gt;&quot;Y&quot;, &quot;TGT&quot;=&gt;&quot;C&quot;, &quot;TGC&quot;=&gt;&quot;C&quot;, &quot;TTA&quot;=&gt;&quot;L&quot;,</div><div>              &quot;TCA&quot;=&gt;&quot;S&quot;, &quot;TAA&quot;=&gt;&quot;X&quot;, &quot;TGA&quot;=&gt;&quot;X&quot;, &quot;TTG&quot;=&gt;&quot;L&quot;, &quot;TCG&quot;=&gt;&quot;S&quot;, &quot;TAG&quot;=&gt;&quot;X&quot;, &quot;TGG&quot;=&gt;&quot;W&quot;, &quot;CTT&quot;=&gt;&quot;L&quot;, &quot;CTC&quot;=&gt;&quot;L&quot;,</div><div>              &quot;CCT&quot;=&gt;&quot;P&quot;, &quot;CCC&quot;=&gt;&quot;P&quot;, &quot;CAT&quot;=&gt;&quot;H&quot;, &quot;CAC&quot;=&gt;&quot;H&quot;, &quot;CGT&quot;=&gt;&quot;R&quot;, &quot;CGC&quot;=&gt;&quot;R&quot;, &quot;CTA&quot;=&gt;&quot;L&quot;, &quot;CTG&quot;=&gt;&quot;L&quot;, &quot;CCA&quot;=&gt;&quot;P&quot;,</div><div>              &quot;CCG&quot;=&gt;&quot;P&quot;, &quot;CAA&quot;=&gt;&quot;Q&quot;, &quot;CAG&quot;=&gt;&quot;Q&quot;, &quot;CGA&quot;=&gt;&quot;R&quot;, &quot;CGG&quot;=&gt;&quot;R&quot;, &quot;ATT&quot;=&gt;&quot;I&quot;, &quot;ATC&quot;=&gt;&quot;I&quot;, &quot;ACT&quot;=&gt;&quot;T&quot;, &quot;ACC&quot;=&gt;&quot;T&quot;,</div><div>              &quot;AAT&quot;=&gt;&quot;N&quot;, &quot;AAC&quot;=&gt;&quot;N&quot;, &quot;AGT&quot;=&gt;&quot;S&quot;, &quot;AGC&quot;=&gt;&quot;S&quot;, &quot;ATA&quot;=&gt;&quot;I&quot;, &quot;ACA&quot;=&gt;&quot;T&quot;, &quot;AAA&quot;=&gt;&quot;K&quot;, &quot;AGA&quot;=&gt;&quot;R&quot;, &quot;ATG&quot;=&gt;&quot;M&quot;,</div><div>              &quot;ACG&quot;=&gt;&quot;T&quot;, &quot;AAG&quot;=&gt;&quot;K&quot;, &quot;AGG&quot;=&gt;&quot;R&quot;, &quot;GTT&quot;=&gt;&quot;V&quot;, &quot;GTC&quot;=&gt;&quot;V&quot;, &quot;GCT&quot;=&gt;&quot;A&quot;, &quot;GCC&quot;=&gt;&quot;A&quot;, &quot;GAT&quot;=&gt;&quot;D&quot;, &quot;GAC&quot;=&gt;&quot;D&quot;,</div><div>              &quot;GGT&quot;=&gt;&quot;G&quot;, &quot;GGC&quot;=&gt;&quot;G&quot;, &quot;GTA&quot;=&gt;&quot;V&quot;, &quot;GTG&quot;=&gt;&quot;V&quot;, &quot;GCA&quot;=&gt;&quot;A&quot;, &quot;GCG&quot;=&gt;&quot;A&quot;, &quot;GAA&quot;=&gt;&quot;E&quot;, &quot;GAG&quot;=&gt;&quot;E&quot;, &quot;GGA&quot;=&gt;&quot;G&quot;,</div><div>              &quot;GGG&quot;=&gt;&quot;G&quot;</div><div>              );</div><div><br/></div><div>print &quot;NOTICE: Reading gene annotation from $file ...\n&quot;;</div><div>my ($TotalRNA,$ncRNA,%exonpos,%mRNA)=(0,0);</div><div><br/></div><div>&amp;initialize($conf,\%parameters);</div><div><br/></div><div>open IN,$file || die &quot;can\'t open $file\n&quot;;</div><div>while (&lt;IN&gt;) {</div><div>    chomp;</div><div>    next if(/^$/);</div><div>    my ($tag,$mRNA,$chr,$strand,$gstart,$gend,$cdsstart,$cdsend,$exonnum,$exonstart,$exonend,$id,$gene,$GeneID,$MIM)=split/\s+/,$_;</div><div>    $TotalRNA++;</div><div>    $mRNA=~s/\.\d+$//;</div><div>    if ($cdsend-$cdsstart&lt;3 || $tag!~/protein_coding/i) {##only coding mRNA and have mRNA id.</div><div>        $ncRNA++;</div><div>        $tag=&quot;ncRNA&quot; if($cdsend-$cdsstart&lt;3);</div><div>        next if(!defined $ncRNA_anno);</div><div>    }</div><div>    if ($chr=~m/NC_000/) {</div><div>        $chr=~s/NC_00*(\d+)\.\d+/chr$1/;</div><div>        $chr=&quot;chrX&quot; if($chr=~m/23/);</div><div>        $chr=&quot;chrY&quot; if($chr=~m/24/);</div><div>    }</div><div><br/></div><div>    #next if(!exists $var{$chr});</div><div>    $gstart++;#start 0</div><div>    $GeneID=~s/GeneID://;</div><div>    $MIM=~s/MIM://;</div><div>    push @{$mRNA{$chr}{$gstart}{$gend}},$mRNA,$gene;#&quot;$gene:$GeneID:$MIM&quot;</div><div>    $exonstart=~s/,$//;</div><div>    $exonend=~s/,$//;</div><div>    #map {$_++;push @{$exonpos{&quot;$mRNA#$chr#$gstart&quot;}{start}},$_;}(split/\,/,$exonstart);#start 0</div><div>    my @exonstart=split/\,/,$exonstart;</div><div>        map{$_++}@exonstart;</div><div>        @{$exonpos{&quot;$mRNA#$chr#$gstart&quot;}{start}}=@exonstart;</div><div>    @{$exonpos{&quot;$mRNA#$chr#$gstart&quot;}{end}}=split/\,/,$exonend;</div><div>    $exonpos{&quot;$mRNA#$chr#$gstart&quot;}{cdsstart}=$cdsstart+1;#start 0</div><div>    $exonpos{&quot;$mRNA#$chr#$gstart&quot;}{cdsend}=$cdsend;</div><div>    $exonpos{&quot;$mRNA#$chr#$gstart&quot;}{strand}=$strand;</div><div>    $exonpos{&quot;$mRNA#$chr#$gstart&quot;}{type}=$tag;</div><div>}</div><div>close IN;</div><div><br/></div><div>print &quot;NOTICE: done with $TotalRNA transcript, (including $ncRNA without coding sequence annotation)\n&quot;;</div><div><br/></div><div>#$trans_fa=&quot;$Bin/GRCh37_p10_top_level.SameChange.fa&quot; if (!-f $trans_fa);</div><div><br/></div><div>print &quot;NOTICE: Reading FASTA sequences from $trans_fa ...\n&quot;;</div><div><br/></div><div>$/=&quot;&gt;&quot;;</div><div>my ($orfwarning,$wrong_num,$orf,$numuse,%badorf,%orf)=(0,0,0,0);</div><div>open FA,$trans_fa || die &quot;can\'t open $file\n&quot;;</div><div>print STDOUT &quot;$trans_fa\n&quot;;</div><div>while (&lt;FA&gt;) {</div><div>    chomp;</div><div>    next if(/^$/);</div><div>    my ($info,$seq)=split/\n+/,$_,2;</div><div>    my $seqid=(split/\s+/,$info)[0];</div><div>    $seqid=~s/\.\d+$//;</div><div>    if ($info=~m/start\s*(chr\S+)\)/) {</div><div>        my $tmp=$1;$tmp=~s/:/#/;</div><div>        $seqid=&quot;$seqid#$tmp&quot;;</div><div>    }</div><div>    $info=~m/total (\d+) AA\(wrong:(\d+)/;</div><div>    my ($totalAA,$wrong)=($1,$2);</div><div>    $orf++;</div><div>    $orfwarning++ if($wrong&gt;10);</div><div>    next if(!exists $exonpos{$seqid});</div><div>    $seq=~s/\s+//g;</div><div>    $orf{$seqid}=$seq;</div><div>    if($wrong&gt;10){</div><div>        $badorf{$seqid}++;</div><div>        $wrong_num++;</div><div>    }</div><div>    $numuse++;</div><div>}</div><div>close FA;</div><div>$/=&quot;\n&quot;;</div><div><br/></div><div>my %refSeq;</div><div>$refSeq_INDEL=&quot;$Bin/GRCh37_p10_top_level.INDEL.txt&quot; if(!-f $refSeq_INDEL);</div><div>if (-f $refSeq_INDEL) {</div><div>    print &quot;NOTICE: Load some correct mRNA information...\n&quot;;</div><div>    open IN,$refSeq_INDEL || die &quot;can\'t open $file\n&quot;;</div><div>    while (&lt;IN&gt;) {</div><div>        chomp;</div><div>        next if(/^$/ || /^\#/);</div><div>        my ($mRNA_ver,$chr,$start,$pos,$type,$len,$mRNA,$chr_use,$start_use)=split/\s+/,$_;</div><div>        $mRNA=~s/\.\d+$//;</div><div>        if ($chr_use=~m/NC_00*(\d+)\.\d+$/) {</div><div>            $chr_use=&quot;chr$1&quot;;</div><div>            $chr_use=&quot;chrX&quot; if($chr_use eq &quot;chr23&quot;);</div><div>            $chr_use=&quot;chrY&quot; if($chr_use eq &quot;chr24&quot;);</div><div>        }</div><div>        #$INDEL=~m/(\d+)([DELINS]+)(\d+)/;#46918974INS1</div><div>        $refSeq{&quot;$mRNA#$chr_use#$start_use&quot;}{$pos}{$type}=$len;</div><div>        #print &quot;$mRNA#$chr_use#$start_use\n&quot; if($mRNA=~m/NM_000278/);</div><div>    }</div><div>    close IN;</div><div>}</div><div>#print Dumper %refSeq;die;</div><div>print &quot;NOTICE: Done with $numuse(wrong orf $wrong_num) sequences(total $orf correct orf, $orfwarning sequences will be ignored due to lack of correct ORF annotation).\n&quot;;</div><div>print &quot;NOTICE: Reading variant from $varfile...\n&quot;;</div><div>#print &quot;WARNING: A total of $orfwarning sequences will be ignored due to lack of correct ORF annotation\n&quot;;</div><div>#print &quot;total &quot;,$orfwarning+$orf,&quot; transcript sequences, $orf sequences is correct orf($orfwarning wrong).\n&quot;;</div><div>my $onGeneVar=0;my $errornum=0;</div><div>open OUT,&quot;&gt;$out&quot; || die $!;</div><div>open NOG,&quot;&gt;$out.not_on_gene&quot; || die $!;</div><div>open ERROR,&quot;&gt;$out.error&quot; || die $!;</div><div>my %var; my $varnum=0;</div><div>if ($format eq &quot;vcf&quot;) {</div><div>    open IN,$varfile || die $!;</div><div>        while (&lt;IN&gt;) {</div><div>        chomp;</div><div>        next if(/^$/||/^\#/);</div><div>        my ($chr,$pos,$rs,$ref,$var,$qual,$pass,$info,$info2)=split/\s+/,$_;</div><div>        my ($start,$end)=($pos,$pos);</div><div>        if ($chr=~m/NC_000/) {</div><div>            $chr=~s/NC_00*(\d+)\.\d+/chr$1/;</div><div>            $chr=&quot;chrX&quot; if($chr=~m/23/);</div><div>            $chr=&quot;chrY&quot; if($chr=~m/24/);</div><div>        }elsif ($chr=~/^\d+$/ || $chr=~/^[XY]$/ ) {</div><div>            $chr=&quot;chr$chr&quot;;</div><div>        }</div><div>        if (length$ref ==1 and length$var==1) {</div><div>            $var{$chr}{$start}{$end}{&quot;$ref\t$var&quot;}++;</div><div>            &amp;anno2gene($chr,$start,$end,&quot;$ref\t$var&quot;,$rs);</div><div>            $varnum++;</div><div>        }else{</div><div>            my @var=split/,/,$var;</div><div>            for (my $i=0;$i&lt;@var ;$i++) {</div><div>                ($start,$end)=($pos,$pos);</div><div>                if (length$ref==1 and length$var[$i]==1) {#snp</div><div>                    $var{$chr}{$start}{$end}{&quot;$ref\t$var[$i]&quot;}++;</div><div>                    &amp;anno2gene($chr,$start,$end,&quot;$ref\t$var[$i]&quot;,$rs);</div><div>                }elsif (length$ref==1 and length$var[$i]&gt;1) {#insertion</div><div>                    $var[$i]=~s/^$ref//;</div><div>                    $end=$pos+1;</div><div>                    #$var{$chr}{$start}{$end}{&quot;-\t$var[$i]&quot;}++;</div><div>                    &amp;anno2gene($chr,$start,$end,&quot;-\t$var[$i]&quot;,$rs);</div><div>                }elsif (length$ref&gt;1 and length$var[$i]==1) {#deletion</div><div>                    $ref=~s/^$var[$i]//;</div><div>                    $start=$pos+1;</div><div>                    $end=$pos+length($ref);</div><div>                    #$var{$chr}{$start}{$end}{&quot;$ref\t-&quot;}++;</div><div>                    &amp;anno2gene($chr,$start,$end,&quot;$ref\t-&quot;,$rs);</div><div>                }elsif (length$ref&gt;1 and length$var[$i]&gt;1) {</div><div>                    if ($var[$i]=~m/^$ref/) {</div><div>                        $var[$i]=~s/^$ref//;</div><div>                        $start=$pos+length($ref)-1;</div><div>                        $end=$pos+length($ref);</div><div>                        #$var{$chr}{$start}{$end}{&quot;-\t$var[$i]&quot;}++;</div><div>                        &amp;anno2gene($chr,$start,$end,&quot;-\t$var[$i]&quot;,$rs);</div><div>                    }elsif ($ref=~/^$var[$i]/) {</div><div>                        $end=$pos+length($ref)-1;</div><div>                        $ref=~s/^$var[$i]//;</div><div>                        $start=$pos+length($var[$i]);</div><div>                        #$var{$chr}{$start}{$end}{&quot;$ref\t-&quot;}++;</div><div>                        &amp;anno2gene($chr,$start,$end,&quot;$ref\t-&quot;,$rs);</div><div>                    }else {</div><div>                        $end=$pos+length($ref)-1;</div><div>                        ($ref,$var[$i],$start,$end)=&amp;trim($ref,$var[$i],$pos,$end);</div><div>                        #$start=$pos;</div><div>                        #$var{$chr}{$start}{$end}{&quot;$ref\t$var[$i]&quot;}++;</div><div>                        &amp;anno2gene($chr,$start,$end,&quot;$ref\t$var[$i]&quot;,$rs);</div><div>                    }</div><div>                }</div><div>                $varnum++;</div><div>            }</div><div>        }</div><div>    }</div><div>    close IN;</div><div>}else{</div><div>    open IN,$varfile || die $!;</div><div>        while (&lt;IN&gt;) {</div><div>        chomp;</div><div>        next if(/^$/ || /^\#/);</div><div>        my ($chr,$start,$end,$ref,$var,$rs)=split/\s+/,$_;</div><div>        if ($chr=~m/NC_000/) {</div><div>            $chr=~s/NC_00*(\d+)\.\d+/chr$1/;</div><div>            $chr=&quot;chrX&quot; if($chr=~m/23/);</div><div>            $chr=&quot;chrY&quot; if($chr=~m/24/);</div><div>        }</div><div>        $end++ if ($start==$end &amp;&amp; $ref eq &quot;-&quot;);</div><div>        &amp;anno2gene($chr,$start,$end,&quot;$ref\t$var&quot;,$rs);</div><div>        #$var{$chr}{$start}{$end}{&quot;$ref\t$var&quot;}++;</div><div>        $varnum++;</div><div>    }</div><div>    close IN;</div><div>}</div><div>print &quot;NOTICE: Done with $varnum variants.\n&quot;;</div><div>print &quot;NOTICE: Done with $onGeneVar varaints on gene,other $errornum varaints bases maybe error.\n&quot;;</div><div>close OUT;</div><div>close NOG;</div><div>close ERROR;</div><div>sub trim{</div><div>    my ($ref,$alt,$pos1,$pos2)=@_;</div><div>    my @refbase=split//,$ref;</div><div>    my @altbase=split//,$alt;</div><div>    for (my $i=0;$i&lt;@refbase ;$i++) {</div><div>        if ($refbase[$i] eq $altbase[$i]){</div><div>            $pos1++;</div><div>            $ref=~s/^$refbase[$i]//;</div><div>            $alt=~s/^$refbase[$i]//;</div><div>            next;</div><div>        }</div><div>        last;</div><div>    }</div><div>    $ref=&quot;-&quot; if(!$ref);</div><div>    $alt=&quot;-&quot; if(!$alt);</div><div>    $pos2=$pos1+1 if($ref eq &quot;-&quot;);</div><div>    return $ref,$alt,$pos1,$pos2 if($ref eq &quot;-&quot; || $alt eq &quot;-&quot;);</div><div>    @refbase=split//,$ref;</div><div>    @altbase=split//,$alt;</div><div>    my $n=0;</div><div>    for (my $i=$#refbase;$i&gt;=0;$i--) {</div><div>        if ($refbase[$i] eq $altbase[$#altbase-$n]){</div><div>            $pos2--;</div><div>            $ref=~s/$refbase[$i]$//;</div><div>            $alt=~s/$refbase[$i]$//;</div><div>            $n++;</div><div>            last if($n&gt;$#altbase);</div><div>            next;</div><div>        }</div><div>        last;</div><div>    }</div><div>    $ref=&quot;-&quot; if(!$ref);</div><div>    $alt=&quot;-&quot; if(!$alt);</div><div>    $pos2=$pos1+1 if($ref eq &quot;-&quot;);</div><div>    return $ref,$alt,$pos1,$pos2;</div><div>}</div><div>sub anno2gene{</div><div>    my ($chr,$start,$end,$mut,$rs)=@_;</div><div>    $rs=&quot;.&quot; if(!$rs);</div><div>    my $test_on_Gene=0;</div><div>    my ($ref,$var)=split/\s+/,$mut;</div><div>    foreach my $gstart (sort{$a&lt;=&gt;$b} keys %{$mRNA{$chr}}) {</div><div>        last if($gstart-$edge&gt;$end);</div><div>        foreach my $gend (sort{$a&lt;=&gt;$b} keys %{$mRNA{$chr}{$gstart}}) {</div><div>            next if($gend+$edge&lt;$start);</div><div>            my @mRNAinfo=@{$mRNA{$chr}{$gstart}{$gend}};</div><div>            if (($start&gt;=$gstart-$edge &amp;&amp; $start&lt;=$gend+$edge) || ($end&gt;=$gstart-$edge &amp;&amp; $end&lt;=$gend+$edge)) {</div><div>                my $tagerror=0;</div><div>                for (my $i=0;$i&lt;@mRNAinfo ;$i+=2) {</div><div>                    my $corr_mRNA=&quot;$mRNAinfo[$i]#$chr#$gstart&quot;;</div><div>                    my ($strand,$pvar,$region,$note,$varinfo,$cdsstart,$cdslength)=($exonpos{&quot;$mRNAinfo[$i]#$chr#$gstart&quot;}{strand},&quot;.&quot;,&quot;unknown&quot;);</div><div>                    #######mutation equal mRNA's INDEL</div><div>=h</div><div>                    my $error_tag=0;</div><div>                    foreach my $error_pos (sort{$a&lt;=&gt;$b} keys %{$refSeq{$corr_mRNA}}) {</div><div>                        foreach my $type (sort keys %{$refSeq{$corr_mRNA}{$error_pos}}) {</div><div>                            my $len=$refSeq{$corr_mRNA}{$error_pos}{$type};</div><div>                            if ($start==$error_pos &amp;&amp; $type eq &quot;INS&quot; &amp;&amp; $ref eq &quot;-&quot; &amp;&amp; $len==length$mut) {</div><div>                                $error_tag=1;</div><div>                            }elsif ($start==$error_pos+1 &amp;&amp; $type eq &quot;DEL&quot; &amp;&amp; $var eq &quot;-&quot; &amp;&amp; $len==$end-$start+1) {</div><div>                                $error_tag=1;</div><div>                            }</div><div>                            last if($error_tag==1);</div><div>                        }</div><div>                        last if($error_tag==1);</div><div>                    }</div><div>                    if ($error_tag==1) {</div><div>                        print OUT &quot;$chr\t$start\t$end\t$mut\t$mRNAinfo[$i+1]\t$strand\t$mRNAinfo[$i]#$chr#$gstart\tunknown\tNormal\t.\n&quot;;</div><div>                        next;</div><div>                    }</div><div>=cut</div><div>                    </div><div>                    my ($corr1,$corr2)=(0,0);</div><div>                    if ($strand eq &quot;+&quot;) {</div><div>                        ($note,$region,$cdsstart,$cdslength,$corr1,$corr2)=&amp;forward(&quot;$mRNAinfo[$i]#$chr#$gstart&quot;,$gstart,$gend,$start,$end);</div><div>                        $varinfo=&amp;varchange($ref,$var,$strand);</div><div>                    }else{</div><div>                        ($note,$region,$cdsstart,$cdslength,$corr1,$corr2)=&amp;negative(&quot;$mRNAinfo[$i]#$chr#$gstart&quot;,$gstart,$gend,$start,$end);</div><div>                        $varinfo=&amp;varchange($ref,$var,$strand);</div><div>                    }</div><div>                    my $exonnum=scalar @{$exonpos{&quot;$mRNAinfo[$i]#$chr#$gstart&quot;}{start}};</div><div>                    </div><div>                    if ($cdslength&gt;=3) {</div><div>                        my $tmp_tag;</div><div>                        $pvar=&amp;annotationAA($cdsstart,$cdslength,&quot;$note$varinfo&quot;,&quot;$mRNAinfo[$i]#$chr#$gstart&quot;,$exonnum,$corr1,$corr2);#my ($cdsstart,$cdslen,$var,$seq)</div><div>                        $tmp_tag=&quot;no_correct_cds;&quot; if($cdslength%3!=0 );#&amp;&amp; !exists $refSeq{$corr_mRNA}</div><div>                        $tmp_tag.=&quot;no_correct_orf;&quot; if(exists $badorf{&quot;$mRNAinfo[$i]#$chr#$gstart&quot;} );#&amp;&amp; !exists $refSeq{$corr_mRNA}</div><div>                        $pvar=&quot;$tmp_tag$pvar&quot; if($tmp_tag);</div><div>                    }else{</div><div>                        $pvar=$exonpos{&quot;$mRNAinfo[$i]#$chr#$gstart&quot;}{type};</div><div>                        my $pvar1=&amp;annotationAA($cdsstart,$cdslength,&quot;$note$varinfo&quot;,&quot;$mRNAinfo[$i]#$chr#$gstart&quot;,$exonnum,$corr1,$corr2);#my ($cdsstart,$cdslen,$var,$seq)</div><div>                        $pvar.=&quot;;&quot;.$pvar1 if($pvar1);</div><div>                    }</div><div>                    if ($varinfo=~/wrong/ || $pvar=~/wrong/) {</div><div>                        print ERROR &quot;$chr\t$start\t$end\t$mut\t$mRNAinfo[$i+1]\t$strand\t$mRNAinfo[$i]#$chr#$gstart\t$region\t$note$varinfo\t$pvar\n&quot;;#\t$rs</div><div>                        $tagerror=1;</div><div>                    }else{</div><div>                        print OUT &quot;$chr\t$start\t$end\t$mut\t$mRNAinfo[$i+1]\t$strand\t$mRNAinfo[$i]#$chr#$gstart\t$region\t$note$varinfo\t$pvar\n&quot;;#\t$rs</div><div>                    }</div><div>                }</div><div>                $test_on_Gene=1 if($tagerror==0);</div><div>                $test_on_Gene=2 if($tagerror==1);</div><div>            }</div><div>        }</div><div>    }</div><div>    $onGeneVar++ if($test_on_Gene==1);</div><div>    $errornum++ if($test_on_Gene==2);</div><div>    print NOG &quot;$chr\t$start\t$end\t$mut\n&quot; if($test_on_Gene==0);</div><div>}</div><div>sub PosCorr{</div><div>    my ($mRNA,$cdsstart,$cdsend,$posx,$strand)=@_;</div><div>    #print &quot;1  $mRNA\n&quot;;</div><div>    #$mRNA=$change{$mRNA} if(exists $change{$mRNA});</div><div>    my ($corr_len,$corr_utr5)=0;</div><div>    #print &quot;2  $mRNA\n&quot;;</div><div>    foreach my $pos (sort{$a&lt;=&gt;$b} keys %{$refSeq{$mRNA}}) {</div><div>        #print &quot;$pos\n&quot;;</div><div>        last if($pos&gt;$posx &amp;&amp; $strand eq &quot;+&quot;);</div><div>        foreach my $type (sort keys %{$refSeq{$mRNA}{$pos}}) {</div><div>            my $len=$refSeq{$mRNA}{$pos}{$type};</div><div>            if ($strand eq &quot;+&quot;) {</div><div>                if ($pos &gt;= $cdsstart &amp;&amp; $pos&lt;=$cdsend &amp;&amp; $posx&gt;$pos) {</div><div>                    $corr_len-=$len if($type eq &quot;DEL&quot;);</div><div>                    $corr_len+=$len if($type eq &quot;INS&quot;);</div><div>                    #print &quot;$posx\txx1\n&quot;;</div><div>                }elsif ($pos&lt;$cdsstart) {</div><div>                    #print &quot;$posx\txx2\n&quot;;</div><div>                    $corr_utr5-=$len if($type eq &quot;DEL&quot;);</div><div>                    $corr_utr5+=$len if($type eq &quot;INS&quot;);</div><div>                }</div><div>            }else{</div><div>                if ($pos&gt;$cdsend &amp;&amp; $pos&lt;$cdsstart &amp;&amp; $posx&lt;$pos) {</div><div>                    $corr_len-=$len if($type eq &quot;DEL&quot;);</div><div>                    $corr_len+=$len if($type eq &quot;INS&quot;);</div><div>                    #print &quot;$mRNA\t$posx\t$pos\t$corr_len\txx3\n&quot;;</div><div>                }elsif ($pos&gt;$cdsend) {</div><div>                    #print &quot;$posx\txx4\n&quot;;</div><div>                    $corr_utr5-=$len if($type eq &quot;DEL&quot;);</div><div>                    $corr_utr5+=$len if($type eq &quot;INS&quot;);</div><div>                }</div><div>            }</div><div>        }</div><div>    }</div><div>    #print &quot;$corr_len\n&quot; if($corr_len&gt;0);</div><div>    return $corr_len;</div><div>}</div><div>sub forward{</div><div>    my ($mRNA,$gstart,$gend,$start,$end)=@_;</div><div>    my @exonstart=@{$exonpos{$mRNA}{start}};</div><div>    my @exonend=@{$exonpos{$mRNA}{end}};</div><div>    my $cdsstart=$exonpos{$mRNA}{cdsstart};</div><div>    my $cdsend=$exonpos{$mRNA}{cdsend};</div><div>    my ($cdsstartlen,$cdslength)=(0,0);###cds start exon length and cds length</div><div>    my ($corr1,$corr2)=(0,0);</div><div>    if ($start==$end) {</div><div>        $corr1=&amp;PosCorr($mRNA,$cdsstart,$cdsend,$start,&quot;+&quot;);</div><div>        $corr2=$corr1;</div><div>    }else{</div><div>        $corr1=&amp;PosCorr($mRNA,$cdsstart,$cdsend,$start,&quot;+&quot;);</div><div>        $corr2=&amp;PosCorr($mRNA,$cdsstart,$cdsend,$end,&quot;+&quot;);</div><div>    }</div><div>    for (my $i=0;$i&lt;@exonstart ;$i++) {</div><div>        next if(!$exonstart[$i]);</div><div>        if ($cdsstart&gt;=$exonstart[$i] &amp;&amp; $cdsstart&lt;=$exonend[$i]) {</div><div>            $cdsstartlen+=$cdsstart-$exonstart[$i]+1;</div><div>            if ($cdsend&lt;=$exonend[$i]) {#cdsstart and end on one exon</div><div>                $cdslength=$cdsend-$cdsstart+1;</div><div>                last;</div><div>            }else{</div><div>                $cdslength=$exonend[$i]-$cdsstart+1;</div><div>            }</div><div>        }elsif ($exonend[$i]&lt;$cdsstart) {</div><div>            $cdsstartlen+=$exonend[$i]-$exonstart[$i]+1;</div><div>        }elsif ($exonstart[$i]&gt;$cdsstart &amp;&amp; $exonend[$i]&lt;$cdsend) {</div><div>            $cdslength+=$exonend[$i]-$exonstart[$i]+1;</div><div>        }elsif ($cdsend&gt;=$exonstart[$i] &amp;&amp; $cdsend&lt;=$exonend[$i]) {</div><div>            $cdslength+=$cdsend-$exonstart[$i]+1;</div><div>            last;</div><div>        }</div><div>#        die &quot;$mRNA\n@exonstart\n@exonend\n&quot; if(!$exonend[$i] || !$exonstart[$i]);</div><div>        </div><div>    }</div><div>#    print &quot;$cdsstartlen\n&quot;;</div><div>    my ($exonlen5,$cdslen,$exonlen3,$intronlen3)=(0,0,0,0,0);</div><div>    my ($tag1,$tag2,$note1,$note2,$region1,$region2)=(0,0);</div><div>#    print Dumper @exonstart;die;</div><div>    for (my $i=0;$i&lt;@exonstart ;$i++) {</div><div>#        print &quot;$exonstart[$i]\n&quot;;</div><div>        next if(!$exonstart[$i]);</div><div><br/></div><div>        $exonlen5+=$exonend[$i]-$exonstart[$i]+1 if ($exonend[$i]&lt;$cdsstart || $cdslength&lt;3);</div><div>        if ($cdsstart&gt;=$exonstart[$i] &amp;&amp; $cdsstart&lt;=$exonend[$i] &amp;&amp; $cdslength&gt;=3) {</div><div>            $exonlen5+=$cdsstart-$exonstart[$i];</div><div>            if ($cdsend&lt;=$exonend[$i]) {##only one exon</div><div>                $cdslen+=$cdsend-$cdsstart+1;</div><div>            }else{</div><div>                $cdslen+=$exonend[$i]-$cdsstart+1;</div><div>            }</div><div>        }elsif ($exonstart[$i]&gt;=$cdsstart &amp;&amp; $exonstart[$i]&lt;=$cdsend) {</div><div>            $cdslen+=$exonend[$i]-$exonstart[$i]+1;</div><div>        }</div><div>        if ($cdsend&gt;=$exonstart[$i] &amp;&amp; $cdsend&lt;=$exonend[$i]) {</div><div>            $exonlen3+=$exonend[$i]-$cdsend;</div><div>        }elsif ($exonstart[$i]&gt;$cdsend) {</div><div>            $exonlen3+=$exonend[$i]-$exonstart[$i]+1;</div><div>        }</div><div>#        print &quot;$exonstart[$i]\n&quot; if($mRNA=~m/NM_001289863/);</div><div>        if ($start&lt;$exonstart[$i] &amp;&amp; ($i==0 || $start&gt;$exonend[$i-1])) {</div><div>            #--------*-&lt;---&gt;------&lt;---&gt;-----</div><div>            $region1=&quot;intronic&quot;;</div><div>            $note1.=&quot;;&quot; if($note1);</div><div>            if ($i==0) {#upstream intergenic</div><div>                $note1.=&quot;upstream-&quot;.($gstart-$start);</div><div>                $region1=&quot;intergenic&quot;;</div><div>            }elsif ( $cdslength&lt;3) {</div><div>                $note1.=&quot;IVS&quot;.$i.&quot;:n.&quot;.($exonlen5-($exonend[$i]-$exonstart[$i])).($start-$exonstart[$i]);</div><div>            }elsif ($start&lt;$cdsstart ) {#5utr</div><div>                my $tmp_len=$exonlen5-($exonend[$i]-$exonstart[$i]+1);#cdsstart not on this exon</div><div>                if ($cdsstart==$exonstart[$i]) {</div><div>                    $note1.=&quot;IVS&quot;.$i.&quot;:c.1&quot;.($start-$exonstart[$i]);</div><div>                }elsif($cdsstart&gt;$exonstart[$i] &amp;&amp; $cdsstart&lt;=$exonend[$i]){</div><div>                    $tmp_len=$exonlen5-($cdsstart-$exonstart[$i]) ;#cdsstart  on this exon</div><div>                    $note1.=&quot;IVS&quot;.$i.&quot;:c.-&quot;.($cdsstartlen-$tmp_len-1).($start-$exonstart[$i]);</div><div>                }else{</div><div>                    $note1.=&quot;IVS&quot;.$i.&quot;:c.-&quot;.($cdsstartlen-$tmp_len-1).($start-$exonstart[$i]);</div><div>                }</div><div>            }elsif ($start&gt;$cdsstart &amp;&amp; $start&lt;$cdsend ) {#cds</div><div>                $note1.=&quot;IVS&quot;.$i.&quot;:c.&quot;.($cdslen-($exonend[$i]-$exonstart[$i]+1)+1+$corr1).($start-$exonstart[$i]);</div><div>            }elsif ($start&gt;$cdsend) {#3utr</div><div>                $note1.=&quot;IVS&quot;.$i.&quot;:c.*&quot;.($exonlen3-($exonend[$i]-$exonstart[$i]+1)+1).($start-$exonstart[$i]);</div><div>            }else{</div><div>                print &quot;start++ $start\n&quot;;</div><div>            }</div><div>            $tag1++;</div><div>        }elsif ($start&gt;=$exonstart[$i] &amp;&amp; $start&lt;=$exonend[$i]) {</div><div>            #---------&lt;-*-&gt;--------</div><div>            $region1=&quot;p-splicing;&quot; if ((abs($start-$exonstart[$i])&lt;=3 &amp;&amp; $i!=0)|| ($i!=$#exonend &amp;&amp; abs($start-$exonend[$i])&lt;=3));</div><div>            if ($cdslength&lt;3) {</div><div>                $region1.=&quot;exonic&quot;;</div><div>                $note1=&quot;exon&quot;.($i+1).&quot;:n.&quot;.($exonlen5-($exonend[$i]-$start));</div><div>            }elsif ($start&lt;$cdsstart) {#5utr,</div><div>                $region1.=&quot;utr5&quot;;</div><div>#                print &quot;$cdsstartlen-$exonlen5+$exonend[$i]-$start\n&quot;;</div><div>                $note1=&quot;exon&quot;.($i+1).&quot;:c.-&quot;.($cdsstartlen-$exonlen5+$exonend[$i]-$start);#cdsstart not on this exon</div><div>                $note1=&quot;exon&quot;.($i+1).&quot;:c.-&quot;.($cdsstart-$start) if($cdsstart&gt;$exonstart[$i] &amp;&amp; $cdsstart&lt;=$exonend[$i]);#cdsstart on this exon</div><div>            }elsif ($start&gt;=$cdsstart &amp;&amp; $start&lt;=$cdsend) {#cds</div><div>                $region1.=&quot;cds&quot;;</div><div>                if ($cdsstart&gt;=$exonstart[$i] &amp;&amp; $cdsend&lt;=$exonend[$i]) {</div><div>                    $note1=&quot;exon&quot;.($i+1).&quot;:c.&quot;.($start-$cdsstart+1+$corr1);</div><div>                }else{</div><div>                    $note1=&quot;exon&quot;.($i+1).&quot;:c.&quot;.($cdslen-($exonend[$i]-$start)+$corr1);</div><div>                }</div><div>            }elsif ($start&gt;$cdsend) {#3utr</div><div>                $region1.=&quot;utr3&quot;;</div><div>                $note1=&quot;exon&quot;.($i+1).&quot;:c.*&quot;.($exonlen3-($exonend[$i]-$start));</div><div>#                $note1=&quot;exon&quot;.($i+1).&quot;:c.*&quot;.($exonlen3-($exonend[$i]-$start)) if($exonstart[$i]&gt;$cdsend);#cdsend not on this exon</div><div>            }else{</div><div>                print &quot;exon++++$start\n&quot;;</div><div>            }</div><div>            $tag1=2;</div><div>        }</div><div>        if ($start&gt;$exonend[$i] &amp;&amp; (!$exonstart[$i+1] || $start&lt;$exonstart[$i+1])) {</div><div>            #---------&lt;---&gt;-*-----&lt;---&gt;-----</div><div>            $region1=&quot;intronic&quot;;</div><div>            $note1.=&quot;;&quot; if($note1);</div><div>            if ($i==$#exonstart) {#downstream and intergenic</div><div>                $note1.=&quot;downstream+&quot;.($start-$gend);</div><div>                $region1=&quot;intergenic&quot;;</div><div>            }elsif ($cdslength&lt;3) {</div><div>                $region1.=&quot;exonic&quot;;</div><div>                $note1.=&quot;IVS&quot;.($i+1).&quot;:n.&quot;.$exonlen5.&quot;+&quot;.($start-$exonend[$i]);</div><div>            }elsif ($start&lt;$cdsstart) {#5utr</div><div>#                print &quot;$cdsstartlen\t$exonlen5\n&quot;;</div><div>                $note1.=&quot;IVS&quot;.($i+1).&quot;:c.-&quot;.($cdsstartlen-$exonlen5).&quot;+&quot;.($start-$exonend[$i]);</div><div>            }elsif ($start&gt;$cdsstart &amp;&amp; $start&lt;$cdsend) {#cds</div><div>                $note1.=&quot;IVS&quot;.($i+1).&quot;:c.&quot;.($cdslen+$corr1).&quot;+&quot;.($start-$exonend[$i]);</div><div>            }elsif ($start&gt;$cdsend) {#3utr</div><div>                if ($cdsend==$exonend[$i]) {</div><div>                    $note1.=&quot;IVS&quot;.($i+1).&quot;:c.&quot;.($cdslen+$corr1).&quot;+&quot;.($start-$exonend[$i]);</div><div>                }else{</div><div>                    $note1.=&quot;IVS&quot;.($i+1).&quot;:c.*&quot;.($exonlen3).&quot;+&quot;.($start-$exonend[$i]);</div><div>                }</div><div>            }else{</div><div>                print &quot;start----$start\n&quot;;</div><div>            }</div><div>            $tag1++;</div><div>        }</div><div>        if($start==$end &amp;&amp; ($tag1==2 || ($note1 &amp;&amp; $note1=~m/stream/))){</div><div>            #print &quot;$note1\n&quot;;</div><div>            if ($note1=~/(\d+);.+?(\d+)$/) {</div><div>                my $abs1=$1;my $abs2=$2;</div><div>                if ($abs1&gt;$abs2) {</div><div>                    $note1=~s/.*;//;</div><div>                }else{</div><div>                    $note1=~s/;.*//;</div><div>                }</div><div>            }</div><div>            return $note1,$region1,$cdsstartlen,$cdslength,$corr1,$corr2;</div><div>        }</div><div><br/></div><div>        if ($start!=$end &amp;&amp; $end&lt;$exonstart[$i] &amp;&amp; ($i==0 || $end&gt;$exonend[$i-1])) {</div><div>            #--------*-&lt;---&gt;------&lt;---&gt;-----</div><div>            $region2=&quot;intronic&quot;;</div><div>            $note2.=&quot;;&quot; if($note2);</div><div>            if ($i==0) {#��������</div><div>                $note2.=&quot;upstream-&quot;.($gstart-$end);</div><div>                $region2=&quot;intergenic&quot;;</div><div>            }elsif ( $cdslength&lt;3) {</div><div>                $note2.=&quot;IVS&quot;.$i.&quot;:n.&quot;.($exonlen5-($exonend[$i]-$exonstart[$i])).($end-$exonstart[$i]);</div><div>            }elsif ($end&lt;$cdsstart) {#5utr</div><div>                my $tmp_len=$exonlen5-($exonend[$i]-$exonstart[$i]+1);#cdsstart not on this exon</div><div>                if ($cdsstart==$exonstart[$i]){</div><div>                    $note2.=&quot;IVS&quot;.$i.&quot;:c.1&quot;.($end-$exonstart[$i]);</div><div>                }elsif($cdsstart&gt;$exonstart[$i] &amp;&amp; $cdsstart&lt;=$exonend[$i]){</div><div>                    $tmp_len=$exonlen5-($cdsstart-$exonstart[$i]) ;#cdsstart  on this exon</div><div>                    $note2.=&quot;IVS&quot;.$i.&quot;:c.-&quot;.($cdsstartlen-$tmp_len-1).($end-$exonstart[$i]);</div><div>                }else{</div><div>                    $note2.=&quot;IVS&quot;.$i.&quot;:c.-&quot;.($cdsstartlen-$tmp_len-1).($end-$exonstart[$i]);</div><div>                }</div><div>            }elsif ($end&gt;$cdsstart &amp;&amp; $end&lt;$cdsend) {#cds</div><div>                $note2.=&quot;IVS&quot;.$i.&quot;:c.&quot;.($cdslen-($exonend[$i]-$exonstart[$i]+1)+1+$corr2).($end-$exonstart[$i]);</div><div>            }elsif ($end&gt;$cdsend) {#3utr</div><div>                $note2.=&quot;IVS&quot;.$i.&quot;:c.*&quot;.($exonlen3-($exonend[$i]-$exonstart[$i]+1)+1).($end-$exonstart[$i]);</div><div>            }else{</div><div>                print &quot;end++ $end\n&quot;;</div><div>            }</div><div>            $tag2++;</div><div>        }elsif ($start!=$end &amp;&amp; $end&gt;=$exonstart[$i] &amp;&amp; $end&lt;=$exonend[$i]) {</div><div>            #---------&lt;-*-&gt;--------</div><div>            $region2=&quot;p-splicing;&quot; if (($i!=0 &amp;&amp; abs($end-$exonstart[$i])&lt;=3) || (abs($end-$exonend[$i])&lt;=3 &amp;&amp; $i!=$#exonend));</div><div>            if ($cdslength&lt;3) {</div><div>                $region2.=&quot;exonic&quot;;</div><div>                $note2=&quot;exon&quot;.($i+1).&quot;:n.&quot;.($exonlen5-($exonend[$i]-$end));</div><div>            }elsif ($end&lt;$cdsstart) {#5utr,</div><div>                $region2.=&quot;utr5&quot;;</div><div>#                print &quot;$cdsstartlen-$exonlen5+$exonend[$i]-$end\n&quot;;</div><div>                $note2=&quot;exon&quot;.($i+1).&quot;:c.-&quot;.($cdsstartlen-$exonlen5+$exonend[$i]-$end);#cdsstart not on this exon</div><div>                $note2=&quot;exon&quot;.($i+1).&quot;:c.-&quot;.($cdsstart-$end) if($cdsstart&gt;$exonstart[$i] &amp;&amp; $cdsstart&lt;=$exonend[$i]);#cdsstart on this exon</div><div>            }elsif ($end&gt;=$cdsstart &amp;&amp; $end&lt;=$cdsend) {#cds</div><div>                if ($cdsstart&gt;=$exonstart[$i] &amp;&amp; $cdsend&lt;=$exonend[$i]) {</div><div>                    $note2=&quot;exon&quot;.($i+1).&quot;:c.&quot;.($end-$cdsstart+1+$corr2);</div><div>                }else{</div><div>                    $note2=&quot;exon&quot;.($i+1).&quot;:c.&quot;.($cdslen-($exonend[$i]-$end)+$corr2);</div><div>                }</div><div>                $region2.=&quot;cds&quot;;</div><div>            }elsif ($end&gt;$cdsend) {#3utr</div><div>                $note2=&quot;exon&quot;.($i+1).&quot;:c.*&quot;.($exonlen3-($exonend[$i]-$end));</div><div>                $region2.=&quot;utr3&quot;;</div><div>#                $note1=&quot;exon&quot;.($i+1).&quot;:c.*&quot;.($exonlen3-($exonend[$i]-$end)) if($exonstart[$i]&gt;$cdsend);#cdsend not on this exon</div><div>            }else{</div><div>                print &quot;exon++++$end\n&quot;;</div><div>            }</div><div>            $tag2=2;</div><div>        }</div><div>        if ($start!=$end &amp;&amp; $end&gt;$exonend[$i] &amp;&amp; (!$exonstart[$i+1] || $end&lt;$exonstart[$i+1])) {#</div><div>            #---------&lt;---&gt;-*-----&lt;---&gt;-----</div><div>            $region2=&quot;intronic&quot;;</div><div>            $note2.=&quot;;&quot; if($note2);</div><div>            if ($i==$#exonstart) {#��������</div><div>                $note2.=&quot;downstream+&quot;.($end-$gend);</div><div>                $region2=&quot;intergenic&quot;;</div><div>            }elsif ($cdslength&lt;3) {</div><div>                $note2.=&quot;IVS&quot;.($i+1).&quot;:n.&quot;.$exonlen5.&quot;+&quot;.($end-$exonend[$i]);</div><div>            }elsif ($end&lt;$cdsstart) {#5utr</div><div>#                print &quot;$cdsstartlen\t$exonlen5\n&quot;;</div><div>                $note2.=&quot;IVS&quot;.($i+1).&quot;:c.-&quot;.($cdsstartlen-$exonlen5).&quot;+&quot;.($end-$exonend[$i]);</div><div>            }elsif ($end&gt;$cdsstart &amp;&amp; $end&lt;$cdsend) {#cds</div><div>                $note2.=&quot;IVS&quot;.($i+1).&quot;:c.&quot;.($cdslen+$corr2).&quot;+&quot;.($end-$exonend[$i]);</div><div>            }elsif ($end&gt;$cdsend) {#3utr</div><div>                if ($cdsend==$exonend[$i]) {</div><div>                    $note2.=&quot;IVS&quot;.($i+1).&quot;:c.&quot;.($cdslen+$corr2).&quot;+&quot;.($end-$exonend[$i]);</div><div>                }else{</div><div>                    $note2.=&quot;IVS&quot;.($i+1).&quot;:c.*&quot;.($exonlen3).&quot;+&quot;.($end-$exonend[$i]);</div><div>                }</div><div>            }else{</div><div>                print &quot;end----$end\n&quot;;</div><div>            }</div><div>            $tag2++;</div><div>        }</div><div>        if($start!=$end &amp;&amp; ((($tag1==2 || ($note1 &amp;&amp; $note1=~m/stream/)) &amp;&amp; $tag2==2) || (($tag2==2 || ($note2 &amp;&amp; $note2=~m/stream/)) &amp;&amp; $tag1==2) || ($note1 &amp;&amp; $note2 &amp;&amp; $note1=~/stream/ &amp;&amp; $note2=~/stream/))){</div><div>            if ($note1=~/(\d+);.+?(\d+)$/) {</div><div>                my $abs1=$1;my $abs2=$2;</div><div>                if ($abs1&gt;$abs2) {</div><div>                    $note1=~s/.*;//;</div><div>                }else{</div><div>                    $note1=~s/;.*//;</div><div>                }</div><div>            }</div><div>            if ($note2=~/(\d+);.+?(\d+)$/) {</div><div>                my $abs1=$1;my $abs2=$2;</div><div>                if ($abs1&gt;$abs2) {</div><div>                    $note2=~s/.*;//;</div><div>                }else{</div><div>                    $note2=~s/;.*//;</div><div>                }</div><div>            }</div><div>            if ($note2=~m/[cn]\.\d+$/ &amp;&amp; $note1=~m/[cn]\.\d+$/) {#for same mutation(INDEL) on genome error</div><div>                $note2=~m/[cn]\.(\d+)$/;my $tmp1x=$1;</div><div>                $note1=~m/[cn]\.(\d+)$/;my $tmp2x=$1;</div><div>                if($tmp2x &gt;$tmp1x){</div><div>                    ($note1,$note2)=($note2,$note1) ;</div><div>                    ($region2,$region1)=($region1,$region2);</div><div>                }</div><div>            }</div><div>            my $tmpregion=&quot;$region1;$region2&quot;;</div><div>            $tmpregion=$region1 if($region1 eq $region2);</div><div>            $tmpregion.=&quot;;cds&quot; if ($note1=~m/c\.-/ &amp;&amp; $note2=~m/c\.(\d+)/ &amp;&amp; $1&gt;1 &amp;&amp; $tmpregion!~/cds/) ;</div><div>            return &quot;$note1\_$note2&quot;,$tmpregion,$cdsstartlen,$cdslength,$corr1,$corr2;</div><div>        }</div><div>    }</div><div>}</div><div><br/></div><div>sub negative{</div><div>    my ($mRNA,$gstart,$gend,$start,$end)=@_;</div><div>    my @exonstart=@{$exonpos{$mRNA}{start}};</div><div>    my @exonend=@{$exonpos{$mRNA}{end}};</div><div>        my $cdsstart;</div><div>        if(exists $exonpos{$mRNA}{cdsend}){</div><div>                $cdsstart=$exonpos{$mRNA}{cdsend};##negative strand}else</div><div>        }else{</div><div>                print STDERR &quot;error: no NM $mRNA  in database !\n&quot;;</div><div>        };</div><div>        my $cdsend;</div><div>        if(exists $exonpos{$mRNA}{cdsstart}){</div><div>                $cdsend=$exonpos{$mRNA}{cdsstart};</div><div>        }else{</div><div>                print STDERR &quot;error: no NM $mRNA  in database !\n&quot;;</div><div>        };</div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div>    my ($cdsstartlen,$cdslength)=(0,0);</div><div>    my ($corr1,$corr2)=(0,0);</div><div>    if ($start==$end) {</div><div>        $corr1=&amp;PosCorr($mRNA,$cdsstart,$cdsend,$start,&quot;-&quot;);</div><div>        $corr2=$corr1;</div><div>    }else{</div><div>        $corr1=&amp;PosCorr($mRNA,$cdsstart,$cdsend,$start,&quot;-&quot;);</div><div>        $corr2=&amp;PosCorr($mRNA,$cdsstart,$cdsend,$end,&quot;-&quot;);</div><div>    }</div><div>#    die Dumper @exonstart if($mRNA=~m/NM_001282585/);s</div><div>    for (my $i=$#exonstart;$i&gt;=0 ;$i--) {</div><div>        next if(!$exonstart[$i]);</div><div>        if ($cdsstart&gt;=$exonstart[$i] &amp;&amp; $cdsstart&lt;=$exonend[$i]) {</div><div>            $cdsstartlen+=$exonend[$i]-$cdsstart+1;</div><div>            if ($cdsend&gt;=$exonstart[$i]) {</div><div>                $cdslength=$cdsstart-$cdsend+1;</div><div>                last;</div><div>            }else{</div><div>                $cdslength+=$cdsstart-$exonstart[$i]+1;</div><div>            }</div><div>        }elsif ($exonstart[$i]&gt;$cdsstart) {</div><div>            $cdsstartlen+=$exonend[$i]-$exonstart[$i]+1;</div><div>        }elsif ($exonstart[$i]&gt;$cdsend &amp;&amp; $exonend[$i]&lt;$cdsstart) {</div><div>            $cdslength+=$exonend[$i]-$exonstart[$i]+1;</div><div>        }elsif ($cdsend&gt;=$exonstart[$i] &amp;&amp; $cdsend&lt;=$exonend[$i]) {</div><div>            $cdslength+=$exonend[$i]-$cdsend+1;</div><div>            last;</div><div>        }</div><div>#        print &quot;$cdslength\n&quot;;</div><div>    }</div><div>#    print Dumper @exonstart;</div><div>    my ($exonlen5,$intronlen5,$cdslen,$exonlen3,$intronlen3)=(0,0,0,0,0);</div><div>    my ($tag1,$tag2,$note1,$note2,$region1,$region2)=(0,0);</div><div>    for (my $i=$#exonstart;$i&gt;=0 ;$i--) {</div><div>        next if(!$exonstart[$i]);</div><div><br/></div><div>        $exonlen5+=$exonend[$i]-$exonstart[$i]+1 if ($cdsstart &lt; $exonstart[$i] || $cdslength&lt;3);</div><div>        $intronlen5+=$exonstart[$i]-$exonend[$i-1]-1 if ($i&lt;$#exonstart);</div><div>        if ($cdsstart&gt;=$exonstart[$i] &amp;&amp; $cdsstart&lt;=$exonend[$i] &amp;&amp; $cdslength&gt;=3) {</div><div>            $exonlen5+=$exonend[$i]-$cdsstart;</div><div>            if ($cdsend&gt;=$exonstart[$i]) {</div><div>                $cdslen+=$cdsstart-$cdsend+1;</div><div>            }else{</div><div>                $cdslen+=$cdsstart-$exonstart[$i]+1;</div><div>            }</div><div>        }elsif ($exonend[$i]&gt;=$cdsend &amp;&amp; $exonend[$i]&lt;=$cdsstart) {</div><div>            $cdslen+=$exonend[$i]-$exonstart[$i]+1;</div><div>        }</div><div>        if ($cdsend&gt;=$exonstart[$i] &amp;&amp; $cdsend&lt;=$exonend[$i]) {</div><div>            $exonlen3+=$cdsend-$exonstart[$i];</div><div>        }elsif ($exonend[$i]&lt;$cdsend) {</div><div>            $exonlen3+=$exonend[$i]-$exonstart[$i]+1;</div><div>        }</div><div>        if ($start&gt;$exonend[$i] &amp;&amp; ($i==$#exonend || $start&lt;$exonstart[$i+1])) {</div><div>            #---------&lt;---&gt;-*-----&lt;---&gt;-----</div><div>#            print &quot;xx\n&quot;;</div><div>            $region1=&quot;intronic&quot;;</div><div>            $note1.=&quot;;&quot; if($note1);</div><div>            if ($i==$#exonend) {#��������</div><div>                $note1.=&quot;upstream-&quot;.($start-$gend);</div><div>                $region1=&quot;intergenic&quot;;</div><div>            }elsif($cdslength&lt;3){</div><div>                $note1.=&quot;IVS&quot;.($#exonstart-$i).&quot;:n.&quot;.($exonlen5-($exonend[$i]-$exonstart[$i])).&quot;-&quot;.($start-$exonend[$i]);</div><div>            }elsif ($start&gt;$cdsstart) {#5utr</div><div>#                print &quot;$cdsstartlen\t$exonlen5\n&quot;;</div><div>                my $tmp_len=$exonlen5-($exonend[$i]-$exonstart[$i]+1);#cdsstart not on this exon</div><div>                if ($cdsstart==$exonend[$i]) {</div><div>                    $note1.=&quot;IVS&quot;.($#exonstart-$i).&quot;:c.1-&quot;.($start-$exonend[$i]);</div><div>                }elsif($cdsstart&gt;=$exonstart[$i] &amp;&amp; $cdsstart&lt;$exonend[$i]){</div><div>                    $tmp_len=$exonlen5-($exonend[$i]-$cdsstart) ;#cdsstart  on this exon</div><div>                    $note1.=&quot;IVS&quot;.($#exonstart-$i).&quot;:c.-&quot;.($cdsstartlen-$tmp_len-1).&quot;-&quot;.($start-$exonend[$i]);</div><div>                }else{</div><div>#                print &quot;$cdsstartlen-$exonlen5-1\n&quot;;</div><div>                    $note1.=&quot;IVS&quot;.($#exonstart-$i).&quot;:c.-&quot;.($cdsstartlen-$tmp_len-1).&quot;-&quot;.($start-$exonend[$i]);</div><div>                }</div><div>            }elsif ($start&gt;$cdsend &amp;&amp; $start&lt;$cdsstart &amp;&amp; $cdslength&gt;=3) {#cds</div><div>                $note1.=&quot;IVS&quot;.($#exonstart-$i).&quot;:c.&quot;.($cdslen-($exonend[$i]-$exonstart[$i]+1)+1+$corr1).&quot;-&quot;.($start-$exonend[$i]);</div><div>            }elsif ($start&lt;$cdsend  &amp;&amp; $cdslength&gt;=3) {#3utr</div><div>                $note1.=&quot;IVS&quot;.($#exonstart-$i).&quot;:c.*&quot;.($exonlen3-($exonend[$i]-$exonstart[$i]+1)+1+$corr1).&quot;-&quot;.($start-$exonend[$i]);</div><div>            }else{</div><div>                print &quot;start----$start\n&quot;;</div><div>            }</div><div>            $tag1++;</div><div>        }</div><div>        if ($start&lt;$exonstart[$i] &amp;&amp; ($i==0 || $start&gt;$exonend[$i-1])) {</div><div>            #--------*-&lt;---&gt;------&lt;---&gt;-----</div><div>#            print &quot;xx\n&quot;;</div><div>            $note1.=&quot;;&quot; if($note1);</div><div>            $region1=&quot;intronic&quot;;</div><div>            if ($i==0) {#��������</div><div>                $note1.=&quot;downstream+&quot;.($gstart-$start);</div><div>                $region1=&quot;intergenic&quot;;</div><div>            }elsif ($cdslength&lt;3) {</div><div>                $note1.=&quot;IVS&quot;.($#exonstart-$i+1).&quot;:n.&quot;.($exonlen5).&quot;+&quot;.($exonstart[$i]-$start);</div><div>            }elsif ($start&gt;$cdsstart) {#5utr</div><div>                $note1.=&quot;IVS&quot;.($#exonstart-$i+1).&quot;:c.-&quot;.($cdsstartlen-$exonlen5).&quot;+&quot;.($exonstart[$i]-$start);</div><div>            }elsif ($start&gt;$cdsend &amp;&amp; $start&lt;$cdsstart) {#cds</div><div>                $note1.=&quot;IVS&quot;.($#exonstart-$i+1).&quot;:c.&quot;.($cdslen+$corr1).&quot;+&quot;.($exonstart[$i]-$start);</div><div>            }elsif ($start&lt;$cdsend) {#3utr</div><div>                if ($cdsend==$exonstart[$i]) {</div><div>                    $note1.=&quot;IVS&quot;.($#exonstart-$i+1).&quot;:c.&quot;.($cdslen+$corr1).&quot;+&quot;.($exonstart[$i]-$start);</div><div>                }else{</div><div>                    $note1.=&quot;IVS&quot;.($#exonstart-$i+1).&quot;:c.*&quot;.($exonlen3).&quot;+&quot;.($exonstart[$i]-$start);</div><div>                }</div><div>            }else{</div><div>                print &quot;start++ $start\n&quot;;</div><div>            }</div><div>            $tag1++;</div><div>        }elsif ($start&gt;=$exonstart[$i] &amp;&amp; $start&lt;=$exonend[$i]) {</div><div>            #---------&lt;-*-&gt;--------</div><div>            $region1=&quot;p-splicing;&quot; if ((abs($start-$exonstart[$i])&lt;=3 &amp;&amp; $i!=0)|| ($i!=$#exonend &amp;&amp; abs($start-$exonend[$i])&lt;=3));</div><div>            if ($cdslength&lt;3) {</div><div>                $region1.=&quot;exonic&quot;;</div><div>                $note1=&quot;exon&quot;.($#exonstart-$i+1).&quot;:n.&quot;.($exonlen5-($start-$exonstart[$i]));</div><div>            }elsif ($start&gt;$cdsstart) {#5utr,</div><div>#                print &quot;$cdsstartlen-$exonlen5+$exonend[$i]-$start\n&quot;;</div><div>                $region1.=&quot;utr5&quot;;</div><div>                $note1=&quot;exon&quot;.($#exonstart-$i+1).&quot;:c.-&quot;.($cdsstartlen-$exonlen5+$start-$exonstart[$i]);#cdsstart not on this exon</div><div>                $note1=&quot;exon&quot;.($#exonstart-$i+1).&quot;:c.-&quot;.($start-$cdsstart) if($cdsstart&gt;=$exonstart[$i] &amp;&amp; $cdsstart&lt;$exonend[$i]);#cdsstart on this exon</div><div>            }elsif ($start&gt;=$cdsend &amp;&amp; $start&lt;=$cdsstart) {#cds</div><div>                $region1.=&quot;cds&quot;;</div><div>                if ($cdsend&gt;=$exonstart[$i] &amp;&amp; $cdsstart&lt;=$exonend[$i]) {</div><div>                    $note1=&quot;exon&quot;.($#exonstart-$i+1).&quot;:c.&quot;.($cdsstart-$start+1+$corr1);</div><div>                }else{</div><div>                    $note1=&quot;exon&quot;.($#exonstart-$i+1).&quot;:c.&quot;.($cdslen-($start-$exonstart[$i])+$corr1);</div><div>                }</div><div>            }elsif ($start&lt;$cdsend) {#3utr</div><div>                $region1.=&quot;utr3&quot;;</div><div>                $note1=&quot;exon&quot;.($#exonstart-$i+1).&quot;:c.*&quot;.($exonlen3-($start-$exonstart[$i]));</div><div>#                $note1=&quot;exon&quot;.($i).&quot;:c.*&quot;.($exonlen3-($exonend[$i]-$start)) if($exonstart[$i]&gt;$cdsend);#cdsend not on this exon</div><div>            }else{</div><div>                print &quot;exon++++$start\n&quot;;</div><div>            }</div><div>            $tag1=2;</div><div>        }</div><div><br/></div><div>        if($start==$end &amp;&amp; ($tag1==2 || ($note1 &amp;&amp; $note1=~m/stream/))){</div><div>            #print &quot;$note1\n&quot;;</div><div>            if ($note1=~/(\d+);.+?(\d+)$/) {</div><div>                my $abs1=$1;my $abs2=$2;</div><div>                if ($abs1&gt;$abs2) {</div><div>                    $note1=~s/.*;//;</div><div>                }else{</div><div>                    $note1=~s/;.*//;</div><div>                }</div><div>            }</div><div>            return $note1,$region1,$cdsstartlen,$cdslength,$corr1,$corr2;</div><div>        }</div><div><br/></div><div>        if ($start!=$end &amp;&amp; $end&gt;$exonend[$i] &amp;&amp; ($i==$#exonstart || $end&lt;$exonstart[$i+1])) {</div><div>            #---------&lt;---&gt;-*-----&lt;---&gt;-----</div><div>            $region2=&quot;intronic&quot;;</div><div>            $note2.=&quot;;&quot; if($note2);</div><div>            if ($i==$#exonstart) {#��������</div><div>                $note2.=&quot;upstream-&quot;.($end-$gend);</div><div>                $region2=&quot;intergenic&quot;;</div><div>            }elsif($cdslength&lt;3){</div><div>                $note2.=&quot;IVS&quot;.($#exonstart-$i).&quot;:n.&quot;.($exonlen5-($exonend[$i]-$exonstart[$i])).&quot;-&quot;.($end-$exonend[$i]);</div><div>            }elsif ($end&gt;$cdsstart) {#5utr</div><div>#                print &quot;$cdsstartlen\t$exonlen5\n&quot;;</div><div>                my $tmp_len=$exonlen5-($exonend[$i]-$exonstart[$i]+1);#cdsstart not on this exon</div><div>                if ($cdsstart==$exonend[$i]){</div><div>                    $note2.=&quot;IVS&quot;.($#exonstart-$i).&quot;:c.1-&quot;.($end-$exonend[$i]);</div><div>                }elsif($cdsstart&gt;=$exonstart[$i] &amp;&amp; $cdsstart&lt;$exonend[$i]){</div><div>                    $tmp_len=$exonlen5-($exonend[$i]-$cdsstart) ;#cdsstart  on this exon</div><div>                    $note2.=&quot;IVS&quot;.($#exonstart-$i).&quot;:c.-&quot;.($cdsstartlen-$tmp_len-1).&quot;-&quot;.($end-$exonend[$i]);</div><div>                }else{</div><div>                    $note2.=&quot;IVS&quot;.($#exonstart-$i).&quot;:c.-&quot;.($cdsstartlen-$tmp_len-1).&quot;-&quot;.($end-$exonend[$i]);</div><div>                }</div><div>            }elsif ($end&gt;$cdsend &amp;&amp; $end&lt;$cdsstart) {#cds</div><div>                $note2.=&quot;IVS&quot;.($#exonstart-$i).&quot;:c.&quot;.($cdslen-($exonend[$i]-$exonstart[$i]+1)+1+$corr2).&quot;-&quot;.($end-$exonend[$i]);</div><div>            }elsif ($end&lt;$cdsstart) {#3utr</div><div>                $note2.=&quot;IVS&quot;.($#exonstart-$i).&quot;:c.*&quot;.($exonlen3-($exonend[$i]-$exonstart[$i]+1)+1).&quot;-&quot;.($end-$exonend[$i]);</div><div>            }else{</div><div>                print &quot;end----$end\n&quot;;</div><div>            }</div><div>            $tag2++;</div><div>        }</div><div>#        print &quot;$i\n&quot;;</div><div>        if ($start!=$end &amp;&amp; $end&lt;$exonstart[$i] &amp;&amp; ($i==0 || $end&gt;$exonend[$i-1])) {</div><div>            #--------*-&lt;---&gt;------&lt;---&gt;-----</div><div>            $region2=&quot;intronic&quot;;</div><div>            $note2.=&quot;;&quot; if($note2);</div><div>            if ($i==0) {#��������</div><div>                $note2.=&quot;downstream+&quot;.($gstart-$end);</div><div>                $region2=&quot;intergenic&quot;;</div><div>            }elsif ($cdslength&lt;3) {</div><div>                $note2.=&quot;IVS&quot;.($#exonstart-$i+1).&quot;:n.&quot;.($exonlen5).&quot;+&quot;.($exonstart[$i]-$end);</div><div>            }elsif ($end&gt;$cdsstart) {#5utr</div><div>                $note2.=&quot;IVS&quot;.($#exonstart-$i+1).&quot;:c.-&quot;.($cdsstartlen-$exonlen5).&quot;+&quot;.($exonstart[$i]-$end);</div><div>            }elsif ($end&gt;$cdsend &amp;&amp; $end&lt;$cdsstart) {#cds</div><div>                $note2.=&quot;IVS&quot;.($#exonstart-$i+1).&quot;:c.&quot;.($cdslen+$corr2).&quot;+&quot;.($exonstart[$i]-$end);</div><div>            }elsif ($end&lt;$cdsend) {#3utr</div><div>                if ($cdsend==$exonstart[$i]) {</div><div>                    $note2.=&quot;IVS&quot;.($#exonstart-$i+1).&quot;:c.&quot;.($cdslen+$corr2).&quot;+&quot;.($exonstart[$i]-$end);</div><div>                }else{</div><div>                    $note2.=&quot;IVS&quot;.($#exonstart-$i+1).&quot;:c.*&quot;.($exonlen3).&quot;+&quot;.($exonstart[$i]-$end);</div><div>                }</div><div>            }else{</div><div>                print &quot;end++ $end\n&quot;;</div><div>            }</div><div>            $tag2++;</div><div>        }elsif ($start!=$end &amp;&amp; $end&gt;=$exonstart[$i] &amp;&amp; $end&lt;=$exonend[$i]) {</div><div>            #---------&lt;-*-&gt;--------</div><div>            $region2=&quot;p-splicing;&quot; if (($i!=0 &amp;&amp; abs($end-$exonstart[$i])&lt;=3) || ($i!=$#exonend &amp;&amp; abs($end-$exonend[$i])&lt;=3));</div><div>            if ($cdslength&lt;3) {</div><div>                $region2.=&quot;exonic&quot;;</div><div>                $note2=&quot;exon&quot;.($#exonstart-$i+1).&quot;:n.&quot;.($exonlen5-($end-$exonstart[$i]));</div><div>            }elsif ($end&gt;$cdsstart) {#5utr,</div><div>                $region2.=&quot;utr5&quot;;</div><div>#                print &quot;$cdsstartlen-$exonlen5+$exonend[$i]-$start\n&quot;;</div><div>                $note2=&quot;exon&quot;.($#exonstart-$i+1).&quot;:c.-&quot;.($cdsstartlen-$exonlen5+$end-$exonstart[$i]);#cdsstart not on this exon</div><div>                $note2=&quot;exon&quot;.($#exonstart-$i+1).&quot;:c.-&quot;.($end-$cdsstart) if($cdsstart&gt;=$exonstart[$i] &amp;&amp; $cdsstart&lt;$exonend[$i]);#cdsstart on this exon</div><div>            }elsif ($end&gt;=$cdsend &amp;&amp; $end&lt;=$cdsstart) {#cds</div><div>                $region2.=&quot;cds&quot;;</div><div>                if ($cdsend&gt;=$exonstart[$i] &amp;&amp; $cdsstart&lt;=$exonend[$i]) {</div><div>                    $note2=&quot;exon&quot;.($#exonstart-$i+1).&quot;:c.&quot;.($cdsstart-$end+1+$corr2);</div><div>                }else{</div><div>#                    print &quot;$i\t$mRNA($#exonstart-$i+1  $cdslen-($end-$exonstart[$i]))\n&quot;;</div><div>                    $note2=&quot;exon&quot;.($#exonstart-$i+1).&quot;:c.&quot;.($cdslen-($end-$exonstart[$i])+$corr2);</div><div>                }</div><div>            }elsif ($end&lt;$cdsstart) {#3utr</div><div>                $region2.=&quot;utr3&quot;;</div><div>                $note2=&quot;exon&quot;.($#exonstart-$i+1).&quot;:c.*&quot;.($exonlen3-($end-$exonstart[$i]));</div><div>#                $note1=&quot;exon&quot;.($i).&quot;:c.*&quot;.($exonlen3-($exonend[$i]-$start)) if($exonstart[$i]&gt;$cdsend);#cdsend not on this exon</div><div>            }else{</div><div>                print &quot;exon++++$end\n&quot;;</div><div>            }</div><div>            $tag2=2;</div><div>        }</div><div>        if((($tag1==2 || ($note1 &amp;&amp; $note1=~m/stream/)) &amp;&amp; $tag2==2) || (($tag2==2 || ($note2 &amp;&amp; $note2=~m/stream/)) &amp;&amp; $tag1==2) || ($note1 &amp;&amp; $note2 &amp;&amp; $note1=~/stream/ &amp;&amp; $note2=~/stream/)){</div><div>            #print &quot;$mRNA\t$start\t$note1\t$note2\n&quot;;</div><div>            if ($note1=~/(\d+);.+?(\d+)$/) {</div><div>                my $abs1=$1;my $abs2=$2;</div><div>#                print &quot;$abs1\t$abs2\n&quot;;</div><div>                if ($abs1&gt;$abs2) {</div><div>                    $note1=~s/.*;//;</div><div>                }else{</div><div>                    $note1=~s/;.*//;</div><div>                }</div><div>            }</div><div>            #print &quot;$end\t$note2\n&quot;;</div><div>            if ($note2=~/(\d+);.+?(\d+)$/) {</div><div>                my $abs1=$1;my $abs2=$2;</div><div>#                print &quot;$abs1\t$abs2\n&quot;;</div><div>                if ($abs1&gt;$abs2) {</div><div>                    $note2=~s/.*;//;</div><div>                }else{</div><div>                    $note2=~s/;.*//;</div><div>                }</div><div>            }</div><div>            if ($note2=~m/[cn]\.\d+$/ &amp;&amp; $note1=~m/[cn]\.\d+$/) {##for same mutation(INDEL) on genome error</div><div>                $note2=~m/[cn]\.(\d+)$/;my $tmp1x=$1;</div><div>                $note1=~m/[cn]\.(\d+)$/;my $tmp2x=$1;</div><div>                if($tmp1x &gt;$tmp2x){</div><div>                    ($note1,$note2)=($note2,$note1) ;</div><div>                    ($region2,$region1)=($region1,$region2);</div><div>                }</div><div>            }</div><div>            my $tmpregion=&quot;$region1;$region2&quot;;</div><div>            $tmpregion=$region1 if($region1 eq $region2);</div><div>            $tmpregion.=&quot;;cds&quot; if ($note1=~m/c\.-/ &amp;&amp; $note2=~m/c\.(\d+)/ &amp;&amp; $1&gt;1 &amp;&amp; $tmpregion!~/cds/) ;</div><div>            return &quot;$note2\_$note1&quot;,&quot;$tmpregion&quot;,$cdsstartlen,$cdslength,$corr2,$corr1;</div><div>        }</div><div>    }</div><div>}</div><div><br/></div><div>sub varchange{</div><div>    my ($ref,$var,$strand)=@_;</div><div>    $ref=uc$ref;</div><div>    $var=uc$var;</div><div>    if ($strand eq &quot;-&quot;) {</div><div>        $ref=~tr/AGCT/TCGA/;</div><div>        $var=~tr/AGCT/TCGA/;</div><div>        $ref=reverse$ref;</div><div>        $var=reverse$var;</div><div>    }</div><div>    if ($ref eq &quot;-&quot;) {</div><div>        return &quot;ins$var&quot;;</div><div>    }elsif ($var eq &quot;-&quot;) {</div><div>        return &quot;del$ref&quot;;</div><div>    }elsif (length$ref &gt; 1 || length$var &gt; 1 ) {</div><div>        return &quot;del$ref&quot;.&quot;ins$var&quot;;</div><div>    }else{</div><div>        return &quot;$ref&gt;$var&quot;;</div><div>    }</div><div>}</div><div><br/></div><div><br/></div><div>sub annotationAA{</div><div>    my ($cdsstart,$cdslen,$var,$mRNA,$exonnum,$corr1,$corr2)=@_;</div><div>    my $seq;</div><div>    $seq=$orf{$mRNA} if (exists $orf{$mRNA});</div><div>#    print &quot;$mRNA\n&quot; if($mRNA=~m/NM_015658/);</div><div>#    print &quot;$var\t$region\n&quot;;</div><div>    my ( $codestart1,$codestart2,$inseq,$endlen,$return,$strand53);</div><div>    if ($seq &amp;&amp; $var =~ m/c\.(\d+)([AGCT])&gt;([AGCT])/) {##snp</div><div>        my ($codestart,$ref,$var)=($1,$2,$3);</div><div>        $return=&amp;SNP($cdsstart,$cdslen,$codestart,$ref,$var,$seq,$corr1);#$cdsstart,$cdslen,$codestart,$ref,$var,$seq</div><div>    }elsif($seq &amp;&amp; $var=~m/exon\d+:c\.(\d+)_IVS\d+:c\.(\d+)([\+-])\d*ins(\w+)/){##insertion</div><div>        #xxx -----*&lt;-----&gt;----</div><div>        #xxx -----&lt;-----&gt;*----</div><div>        #-----&lt;--*---&gt;----</div><div>        #print &quot;xxxx-2\t$var\n&quot;;</div><div>        ($codestart1,$codestart2,$strand53,$inseq)=($1,$2,$3,$4);</div><div>        $codestart1-- if ($codestart1 eq $codestart2 &amp;&amp; $strand53 eq &quot;-&quot;);</div><div>        $return=&quot;splicing;&quot;;  ##17/9/20</div><div>        $return.=&amp;INS($cdsstart,$cdslen,$codestart1,$inseq,$seq,$corr1,$corr2);#my ($cdsstart,$cdslen,$codestart1,$varseq,$seq)=@_;</div><div>    }elsif($seq &amp;&amp; $var=~m/exon\d+:c\.(\d+)_exon\d+:c\.(\d+)ins(\w+)/){##insertion</div><div>        #xxx -----*&lt;-----&gt;----</div><div>        #xxx -----&lt;-----&gt;*----</div><div>        #-----&lt;--*---&gt;----</div><div>        #print &quot;xxxx-2\t$var\n&quot;;</div><div>        ($codestart1,$codestart2,$inseq)=($1,$2,$3);</div><div>        $return=&amp;INS($cdsstart,$cdslen,$codestart1,$inseq,$seq,$corr1,$corr2);#my ($cdsstart,$cdslen,$codestart1,$varseq,$seq)=@_;</div><div>    }elsif($seq &amp;&amp; $var=~m/IVS\d+:c\.(\d+)([+-])\d*_exon\d+:c\.(\d+)ins(\w+)/){##insertion</div><div>        #xxx -----*&lt;-----&gt;----</div><div>        #xxx -----&lt;-----&gt;*----</div><div>        #-----&lt;--*---&gt;----</div><div>        #print &quot;xxxx-2\t$var\n&quot;;</div><div>        ($codestart1,$strand53,$codestart2,$inseq)=($1,$2,$3,$4);</div><div>        $codestart1-- if ($codestart1 eq $codestart2 &amp;&amp; $strand53 eq &quot;-&quot;);</div><div>        $return=&quot;splicing;&quot;;</div><div>        $return.=&amp;INS($cdsstart,$cdslen,$codestart1,$inseq,$seq,$corr1,$corr2);#my ($cdsstart,$cdslen,$codestart1,$varseq,$seq)=@_;</div><div>    }elsif ($seq &amp;&amp; $var=~m/^exon\d+:c\.(\d+)del(\w+)/) {#deletion or delins 1bp</div><div>        #-----&lt;--*-&gt;----</div><div>        #print &quot;xxxx-1\t$var\n&quot;;</div><div>        ($codestart1,$codestart2,$inseq)=($1,$1,$2);</div><div>        $return.=&amp;DEL($cdsstart,$cdslen,$codestart1,$codestart2,$seq,$inseq,&quot;&quot;,$corr1,$corr2);</div><div>    }elsif ($seq &amp;&amp; $var=~m/exon\d+:c\.(\d+)\_exon\d+:c\.(\**\d+)del(\w+)/) {#deletion or delins,start and end on cds</div><div>        #xxx ---**&lt;----&gt;----</div><div>        #xxx -----&lt;----&gt;**----</div><div>        #-----&lt;--**-&gt;----</div><div>        #print &quot;xxxx0\t$var\n&quot;;</div><div>        ($codestart1,$codestart2,$inseq)=($1,$2,$3);</div><div>        if($codestart2=~/\*/){</div><div>            $endlen=$codestart2;</div><div>            $endlen=~s/\*//;</div><div>            $codestart2=$cdslen; #####????</div><div>        }</div><div>        if ($var=~m/exon(\d+).*exon(\d+)/ &amp;&amp; $1!=$2) {</div><div>            $return=&quot;exondeletion;&quot; if(abs($1-$2)&gt;1);</div><div>            $return.=&quot;splicing;&quot;;</div><div>        }</div><div>        $return.=&amp;DEL($cdsstart,$cdslen,$codestart1,$codestart2,$seq,$inseq,$endlen,$corr1,$corr2);</div><div>    }elsif ($seq &amp;&amp; $var=~m/(exon|IVS)\d+:c\.(-*\d+)-*\d*_exon\d+:c\.(\d+)del(\w+)/ ) {#deletion or delins,start and end on cds,intron or utr5</div><div>        #----&lt;----&gt;---- to  ----***---&gt;----</div><div>        #print &quot;xxxx1\t$var\n&quot;;</div><div>        my ($codestart1,$codestart2,$inseq)=($2,$3,$4);</div><div>        $codestart1=1 if($codestart1&lt;0);#utr5---cds----</div><div>        if ($var=~m/(IVS|exon)(\d+).*exon(\d+)/ &amp;&amp; $2!=$3) {</div><div>            $return=&quot;exondeletion;&quot; if(abs($2-$3)&gt;1);</div><div>            $return.=&quot;splicing;&quot;;</div><div>        }elsif ($var=~m/(exon|IVS)\d+:c\.-*\d+[-\+](\d+)/ &amp;&amp; $2&gt;=2) {</div><div>            $return=&quot;splicing;&quot;;</div><div>        }</div><div>        $return.=&amp;DEL($cdsstart,$cdslen,$codestart1,$codestart2,$seq,$inseq,&quot;&quot;,$corr1,$corr2);</div><div>    }elsif ($seq &amp;&amp; $var=~m/upstream-\d+_exon\d+:c\.(\d+)del(\w+)/) {#deletion or delins,upstream---cds---</div><div>        #----&lt;----&gt;---- to  ----***---&gt;----</div><div>        #print &quot;xxxx2\t$var\n&quot;;</div><div>        ($codestart1,$codestart2,$inseq)=(1,$1,$2);</div><div>        if ($var=~m/exon(\d+)/ &amp;&amp; $1!=1) {</div><div>            $return=&quot;exondeletion;splicing;&quot;;</div><div>        }</div><div>        $return.=&amp;DEL($cdsstart,$cdslen,$codestart1,$codestart2,$seq,$inseq,&quot;&quot;,$corr1,$corr2);</div><div>    }elsif ($seq &amp;&amp; $var=~m/exon\d+:c\.(\d+)_downstream\+\d+del(\w+)/) {#deletion or delins,upstream---cds---</div><div>        #----&lt;----&gt;---- to  ----***---&gt;----</div><div>        #print &quot;xxxx3\t$var\n&quot;;</div><div>        ($codestart1,$codestart2,$inseq)=($1,$cdslen,$2);</div><div>        if ($var=~m/exon(\d+)/ &amp;&amp; $1!=$exonnum) {</div><div>            $return=&quot;exondeletion;&quot; if($exonnum-$1&gt;1);</div><div>            $return.=&quot;splicing;&quot;;</div><div>        }</div><div>        $endlen=&quot;all&quot;;</div><div>        $return.=&amp;DEL($cdsstart,$cdslen,$codestart1,$codestart2,$seq,$inseq,$endlen,$corr1,$corr2);</div><div>    }elsif ($seq &amp;&amp; $var=~m/exon\d+:c\.(\d+)_IVS\d+:c\.(\**\d+)\+\d+del(\w+)/) {#deletion or delins,cds---intron(utr3)</div><div>        #           exon19 :c.2942  _IVS19 :c.2980+15del</div><div>        #----&lt;----&gt;---- to  ----&lt;----**----</div><div>        #print &quot;xxxx4\t$var\n&quot;;</div><div>        ($codestart1,$codestart2,$inseq)=($1,$2,$3);</div><div>        if($codestart2=~/\*/){</div><div>            $endlen=$codestart2;</div><div>            $endlen=~s/\*//;</div><div>            $codestart2=$cdslen ;#####????</div><div>        }</div><div>        $return=&quot;splicing;&quot;;</div><div>        if ($var=~m/exon(\d+).*(exon|IVS)(\d+)/ &amp;&amp; abs($1-$3)&gt;=1) {</div><div>            $return.=&quot;exondeletion;&quot;</div><div>        }</div><div>        $return.=&amp;DEL($cdsstart,$cdslen,$codestart1,$codestart2,$seq,$inseq,$endlen,$corr1,$corr2);</div><div>    }elsif ($seq &amp;&amp; $var=~m/exon\d+:c\.-(\d+)_IVS\d+:c\.(\**\d+)\+\d+del(\w+)/) {#deletion or delins,cds---intron(utr3)</div><div>        #           exon19 :c.2942  _IVS19 :c.2980+15del</div><div>        #----&lt;----&gt;---- to  ----&lt;----**----</div><div>        #print &quot;xxxx4\t$var\n&quot;;</div><div>        ($codestart1,$codestart2,$inseq)=($1,$2,$3);</div><div>        if($codestart2=~/\*/){</div><div>            $endlen=$codestart2;</div><div>            $endlen=~s/\*//;</div><div>            $codestart2=$cdslen ;#####????</div><div>        }</div><div>        $return=&quot;splicing;&quot;;</div><div>        if ($var=~m/exon(\d+).*(exon|IVS)(\d+)/ &amp;&amp; abs($1-$3)&gt;=1) {</div><div>            $return.=&quot;exondeletion;&quot;</div><div>        }</div><div>        $return.=&amp;DEL($cdsstart,$cdslen,1,$codestart2,$seq,$inseq,$endlen,$corr1,$corr2);</div><div>    }elsif ($seq &amp;&amp; $var=~m/exon\d+:c\.(\d+)_IVS\d+:c\.(\**\d+)-\d+del(\w+)/) {#deletion or delins,cds---intron(utr3)</div><div>        #----&lt;----&gt;-----&lt;---&gt;---</div><div>        #----&lt;---******-&lt;---&gt;---</div><div>        #print &quot;xxxx5\t$var\n&quot;;</div><div>        my ($codestart1,$codestart2,$inseq)=($1,$2,$3);</div><div>        if($codestart2=~/\*/){</div><div>            $endlen=$codestart2;</div><div>            $endlen=~s/\*//;</div><div>            $endlen--;</div><div>            $codestart2=$cdslen;</div><div>        }else{</div><div>            $codestart2--;</div><div>        }</div><div>        if ($var=~m/exon(\d+).*(exon|IVS)(\d+)/) {</div><div>            $return=&quot;exondeletion;&quot; if(abs($1-$3)&gt;1);</div><div>            $return.=&quot;splicing;&quot;;</div><div>        }</div><div>        $return.=&amp;DEL($cdsstart,$cdslen,$codestart1,$codestart2,$seq,$inseq,$endlen,$corr1,$corr2);</div><div>    }elsif ($seq &amp;&amp; $var=~m/IVS\d+:c\.(-*\d+)\+\d+_exon\d+:c\.(\d+)del(\w+)/) {#deletion or delins,cds---intron(utr3)</div><div>        #----&lt;----&gt;---&lt;---&gt;-</div><div>        #----&lt;----&gt;*****--&gt;---</div><div>        #print &quot;xxxx6\t$var\n&quot;;</div><div>        ($codestart1,$codestart2,$inseq)=($1,$2,$3);</div><div>        if($codestart1&lt;0){</div><div>            $codestart1=1;</div><div>        }else{</div><div>            $codestart1++;</div><div>        }</div><div>        if ($var=~m/(exon|IVS)(\d+).*exon(\d+)/) {</div><div>            $return=&quot;exondeletion;&quot; if(abs($2-$3)&gt;1);</div><div>            $return.=&quot;splicing;&quot;;</div><div>        }</div><div>        $return.=&amp;DEL($cdsstart,$cdslen,$codestart1,$codestart2,$seq,$inseq,&quot;&quot;,$corr1,$corr2);#my ($cdsstart,$cdslen,$codestart1,$codestart2,$seq,$insseq)</div><div>    }elsif ($seq &amp;&amp; $var=~m/IVS(\d+):c\.(-*\d+[\+-])\d+_IVS(\d+):c\.(\**\d+[\+-])\d+del(\w+)/ &amp;&amp; $1 ne $3 ) {#deletion or delins,cds---intron(utr3),bug for deletion from utr5 to utr3</div><div>        #----&lt;----&gt;---&lt;---&gt;---&lt;---&gt;--</div><div>        #----&lt;----&gt;--*******--&lt;---&gt;---</div><div>        #print &quot;xxxx7\t$var\n&quot;;</div><div>        </div><div>        my $exon1=$1;my $exon2=$3;</div><div>        ($codestart1,$codestart2,$inseq)=($2,$4,$5);</div><div>        if ($exon1==$exon2) {</div><div>            if ($var=~m/\d+([\+-])(\d+).*([\+-])(\d+)del/ &amp;&amp; $1 eq $3 ) {</div><div>                #exon8:c.1385-14_exon8:c.1385-13delCT</div><div>                return &quot;splicing&quot; if($2 &lt;=2 || $4 &lt;=2 || ($var=~m/exon/ &amp;&amp; $var=~m/IVS/));</div><div>                return &quot;non-coding&quot; ;</div><div>            }</div><div>        }elsif ($exon1+1==$exon2) {</div><div>            if ($var=~m/\d+([\+-])(\d+).*([\+-])(\d+)del/ &amp;&amp; $1 eq &quot;+&quot; &amp;&amp; $3 eq &quot;-&quot;) {</div><div>                #exon8:c.1385-14_exon8:c.1385-13delCT</div><div>                return &quot;splicing&quot; if($2 &lt;=2 || $4 &lt;=2 || ($var=~m/exon/ &amp;&amp; $var=~m/IVS/));</div><div>                return &quot;non-coding&quot;;</div><div>            }</div><div>        }</div><div>        </div><div>        if($codestart1=~m/-$/){</div><div>            $codestart1=~s/-$//;</div><div>        }elsif($codestart1!~/^-/){</div><div>            $codestart1=~s/\+$//;</div><div>            $codestart1++;</div><div>        }</div><div>        $codestart1=1 if($codestart1&lt;0);</div><div>        if($codestart2=~m/-/ &amp;&amp; $codestart2!~/^\*/){</div><div>            $codestart2=~s/-$//;</div><div>            $codestart2--;</div><div>        }elsif($codestart2!~/^\*/){</div><div>            $codestart2=~s/\+$//;</div><div>        }elsif($codestart2=~m/^\*/){</div><div>            $endlen=$codestart2;</div><div>            $endlen=~s/^\*//;</div><div>            if ($endlen=~/\+$/) {</div><div>                $endlen=~s/\+$//;</div><div>            }else{</div><div>                $endlen=~s/\-$//;</div><div>                $endlen--;</div><div>            }</div><div>            $codestart2=$cdslen;</div><div>        }</div><div>        if ($var=~m/(IVS|exon)(\d+).*(IVS|exon)(\d+)/) {</div><div>            $return=&quot;exondeletion;&quot; if(abs($2-$4)&gt;1);</div><div>            $return.=&quot;splicing;&quot;;</div><div>        }</div><div>        $return.=&amp;DEL($cdsstart,$cdslen,$codestart1,$codestart2,$seq,$inseq,$endlen,$corr1,$corr2);#my ($cdsstart,$cdslen,$codestart1,$codestart2,$seq,$insseq)</div><div>    }elsif($var=~m/[exonIVS]+(\d+):[nc].-.*[exonIVS]+(\d+):[nc]\./ &amp;&amp; abs($1-$2)&gt;1){</div><div>        $return=&quot;exondeletion;splicing&quot;;</div><div>    }elsif ($var=~m/[exonIVS]+(\d+):[cn].\*.*[exonIVS]+(\d+):[nc].\*/ &amp;&amp; abs($1-$2)&gt;1) {</div><div>        $return=&quot;exondeletion;splicing&quot;;</div><div>    }elsif ($var=~m/\d+([\+-])(\d+)_.*\d+([\+-])(\d+)/) {</div><div>        $return=&quot;non-coding;&quot; if($var!~/n\./);</div><div>        if ($var=~m/\d+([\+-])(\d+)_.*\d+([\+-])(\d+)ins/ &amp;&amp; ($2==2 || $4==2 ) &amp;&amp; ($2==3 || $4==3)) {</div><div>        }elsif($var=~m/\d+([\+-])(\d+)_.*\d+([\+-])(\d+)/ &amp;&amp; ($2&lt;=2 || $4&lt;=2)  ){</div><div>            $return.=&quot;splicing&quot; ;</div><div>        }</div><div>    }elsif ($var=~m/exon/ &amp;&amp; $var=~m/IVS/ &amp;&amp; $var!~/\d+ins/) {</div><div>        $return=&quot;splicing&quot;;</div><div>    }elsif ($var=~m/^IVS\d+:[nc].[\*-]*\d+[\+-](\d+)[dAGCTN]/ &amp;&amp; $1&lt;=2) {##snp or del</div><div>        $return=&quot;splicing&quot;;#IVS9:c.997+2T&gt;G</div><div>    #}elsif ($var=~m/_.*\d+[\+-](\d+)/ &amp;&amp; $1&lt;=2 &amp;&amp; $var!~/\d+ins/) {</div><div>        #$return=&quot;splicing&quot;;</div><div>    }elsif ($var=~m/upstream*_[exonIVS]+(\d+)/ ) {</div><div>        $return=&quot;non-coding&quot; if($var!~/n\./);</div><div>        $return=&quot;exondeletion;splicing&quot; if(($var=~m/upstream*_[exonIVS]+(\d+)/ &amp;&amp; $1&gt;1) || $var=~m/IVS/ );</div><div>    }elsif ($var=~m/[exonIVS]+(\d+).*downstream/ ) {</div><div>        $return=&quot;non-coding&quot; if($var!~/n\./);</div><div>        $return=&quot;exondeletion;splicing&quot; if(($var=~m/[exonIVS]+(\d+).*downstream/  &amp;&amp; $1&gt;$exonnum) || $var=~m/IVS/);</div><div>    }elsif($var=~m/c\.\d+[^\+-]/ &amp;&amp; !$seq){</div><div>        $return=&quot;no_correct_orf&quot;;</div><div>    }elsif($var!~/n\./){</div><div>        #print &quot;xxxx11\t$var\n&quot;;</div><div>        $return=&quot;non-coding&quot;;</div><div>        $return.=&quot;;no_correct_orf&quot; if (!$seq);</div><div>    }</div><div>    return $return;</div><div>}</div><div><br/></div><div>sub SNP{##stop change ???</div><div>    my ($cdsstart,$cdslen,$codestart,$ref,$var,$seq,$corr)=@_;</div><div>    my $AA=&quot;?&quot;;my $varAA=&quot;?&quot;;</div><div>    my $ppos=int(($codestart+2)/3);</div><div>    my ($code,$varcode);</div><div>    if($corr&gt;0){</div><div>        $corr=&quot;-$corr&quot; ;</div><div>    }else{</div><div>        $corr=abs$corr;</div><div>    }</div><div>    if ($codestart%3==1){</div><div>        $code=substr($seq,$cdsstart-1+$codestart-1+$corr,3) ;</div><div>        $varcode=$code;</div><div>        $varcode=~s/^$ref/$var/;</div><div>    }elsif ($codestart%3==2) {</div><div>        $code=substr($seq,$cdsstart-1+$codestart-1-1+$corr,3) ;</div><div>#        print &quot;$cdsstart-1+$codestart-1-1\n&quot;;</div><div>        $varcode=$code;</div><div>        $varcode=~s/([AGCT])$ref([AGCT])/$1$var$2/;</div><div>    }else{</div><div>        #print &quot;$codestart\t&quot;,$codestart%3,&quot;\n&quot;;</div><div>        $code=substr($seq,$cdsstart-1+$codestart-1-2+$corr,3) ;</div><div>        $varcode=$code;</div><div>        #print &quot;$codestart\t$varcode\n&quot;;</div><div>        $varcode=~s/$ref$/$var/;</div><div>    }</div><div>    return &quot;no_correct_orf&quot; if($code=~/N/);</div><div>    return &quot;wrongcodon:$code-$varcode&quot; if($code eq $varcode);</div><div>    my ($type,$elength)=(&quot;synonymous&quot;,0);</div><div>    $type=&quot;unknown&quot; if(length$code!=3 || $code=~/N/ || length$varcode!=3);</div><div>    $AA=$codon{$code} if(length$code==3 &amp;&amp; $code!~/N/);</div><div>    $varAA=$codon{$varcode} if(length$varcode==3 &amp;&amp; $varcode!~/N/);</div><div>    $AA=&quot;U&quot; if($codestart+3+$corr&lt;=$cdslen &amp;&amp; $AA eq &quot;X&quot; );</div><div>    if ($AA ne $varAA) {</div><div>        $type=&quot;nonsynonymous&quot;;</div><div>        if ($varAA eq &quot;X&quot; ) {##stopgain and loss length</div><div>            $elength=int($cdslen/3)-$ppos;</div><div>            $type=&quot;nonsynonymous;stopgain&quot;;</div><div>        }elsif ($AA eq &quot;X&quot;) {##stop loss and gain length</div><div>            for (my $i=$cdsstart+$cdslen-1;$i&lt;length$seq;$i+=3) {</div><div>                if ($i+3&gt;length$seq) {</div><div>                    $elength=&quot;?&quot;;</div><div>                    last;</div><div>                }</div><div>                my $code1=substr($seq,$i,3);</div><div>                if(exists $codon{$code1} &amp;&amp; $codon{$code1} ne &quot;X&quot; &amp;&amp; $i+3==length$seq){##urt3 use end</div><div>                    $elength=&quot;$elength?&quot; ;</div><div>                    last;</div><div>                }</div><div>                $elength++;</div><div>                last if($codon{$code1} &amp;&amp; $codon{$code1} eq &quot;X&quot;);</div><div>            }</div><div>            $type=&quot;nonsynonymous;stoploss&quot;;</div><div>        }</div><div>    }</div><div>    $type.=&quot;;initiation&quot; if($ppos==1 &amp;&amp; $AA=~m/^M/ &amp;&amp; $type ne &quot;synonymous&quot;);</div><div>    return &quot;$type\tp.$AA$ppos$varAA,$elength\t$code-$varcode&quot; if($elength ne &quot;0&quot;);</div><div>    return &quot;$type\tp.$AA$ppos$varAA\t$code-$varcode&quot;;</div><div>}</div><div><br/></div><div>sub INS{</div><div>    my ($cdsstart,$cdslen,$codestart1,$varseq,$seq,$corr1,$corr2)=@_;</div><div>#    die &quot;$var\t$region\n&quot; if(!$ref||!$var);</div><div>    if($corr1&gt;0){</div><div>        $corr1=&quot;-$corr1&quot; ;</div><div>    }else{</div><div>        $corr1=abs$corr1;</div><div>    }</div><div>    if($corr2&gt;0){</div><div>        $corr2=&quot;-$corr2&quot; ;</div><div>    }else{</div><div>        $corr2=abs$corr2;</div><div>    }</div><div>    my $ppos1=int(($codestart1+2)/3);</div><div>    my ($code,$var,$pvarinfo,$protein);</div><div>    my $AA=&quot;?&quot;;</div><div>    if (length($varseq)%3==0) {</div><div>        if ($codestart1%3==1){</div><div>            $code=substr($seq,$cdsstart-1+$codestart1-1+$corr1,3);</div><div>            $var=$code;</div><div>            $var=~s/^([AGCTN])/$1$varseq/;</div><div>            $AA=$codon{$code} if($code!~/N/ &amp;&amp; exists $codon{$code});</div><div>            $AA=&quot;U&quot; if($AA eq &quot;X&quot; &amp;&amp; $codestart1+3+$corr1&lt;=$cdslen);</div><div>            $pvarinfo=&quot;p.$AA$ppos1&quot;.&quot;delins&quot;;</div><div>        }elsif ($codestart1%3==2) {</div><div>            $code=substr($seq,$cdsstart-1+$codestart1-2+$corr1,3) ;</div><div>            $var=$code;</div><div>            $var=~s/([AGCTN])$/$varseq$1/;</div><div>            $AA=$codon{$code} if($code!~/N/ &amp;&amp; exists $codon{$code});</div><div>            $AA=&quot;U&quot; if($AA eq &quot;X&quot; &amp;&amp; $codestart1+3+$corr1&lt;=$cdslen);</div><div>            $pvarinfo=&quot;p.$AA$ppos1&quot;.&quot;delins&quot;;</div><div>        }else{</div><div>            $code=substr($seq,$cdsstart-1+$codestart1-3+$corr1,3) ;</div><div>            $AA=$codon{$code} if($code!~/N/ &amp;&amp; exists $codon{$code});</div><div>            $AA=&quot;U&quot; if($AA eq &quot;X&quot; &amp;&amp; $codestart1+3+$corr1&lt;$cdslen);</div><div>            $pvarinfo=&quot;p.$AA$ppos1&quot;;</div><div>            $code=substr($seq,$cdsstart-1+$codestart1+$corr1,3) ;</div><div>            $AA=&quot;?&quot;;</div><div>            $AA=$codon{$code} if($code!~/N/ &amp;&amp; exists $codon{$code});</div><div>            $AA=&quot;U&quot; if($AA eq &quot;X&quot; &amp;&amp; $codestart1+3+$corr1&lt;$cdslen);</div><div>            $pvarinfo.=&quot;_$AA&quot;.($ppos1+1).&quot;ins&quot;;</div><div>            $var=$varseq;</div><div>        }</div><div>        my $elength=0;</div><div>        for (my $i=0;$i&lt;length$var ;$i+=3) {</div><div>            my $varcode=substr($var,$i,3);</div><div>            if ($varcode=~m/N/) {</div><div>                $protein.=&quot;?&quot;;</div><div>            }else{</div><div>                $protein.=&quot;$codon{$varcode}&quot;;</div><div>            }</div><div>            $elength++;</div><div>            last if ($varcode!~/N/ &amp;&amp; $codon{$varcode} eq &quot;X&quot;);</div><div>        }</div><div>        if ($protein=~m/X/ &amp;&amp; $pvarinfo =~/X/) {</div><div>            return &quot;non-frameshift;stop\t$pvarinfo$protein&quot; if(&quot;$pvarinfo$protein&quot;=~/X\d+insX/);</div><div>            return &quot;non-frameshift;initiation\t$pvarinfo$protein&quot; if($codestart1&lt;3 &amp;&amp; $protein!~/^M/);</div><div>            return &quot;non-frameshift\t$pvarinfo$protein&quot;;</div><div>        }elsif ($protein=~m/X/ &amp;&amp; $pvarinfo !~ /X/) {#stop gain and gain length</div><div>            $elength=(int($cdslen/3)-$ppos1+1)-length$protein;</div><div>            #print &quot;int(($cdslen-$cdsstart)/3)-$ppos1\n&quot;;</div><div>            return &quot;non-frameshift;stopgain;initiation\t$pvarinfo$protein,$elength&quot; if($codestart1&lt;3 &amp;&amp; $protein!~/^M/);</div><div>            return &quot;non-frameshift;stopgain\t$pvarinfo$protein,$elength&quot;;</div><div>        }elsif ($protein!~/X/ &amp;&amp; $pvarinfo =~ /X/ &amp;&amp; $var ne $varseq) {##stop postion and loss length?</div><div>            for (my $i=$cdsstart+$cdslen-1;$i&lt;length$seq;$i+=3) {</div><div>                if ($i+3&gt;length$seq ) {</div><div>                    $elength=&quot;$elength?&quot;;</div><div>                    last;</div><div>                }</div><div>                my $code1=substr($seq,$i,3);</div><div>                if($code1!~/N/ &amp;&amp; $codon{$code1} ne &quot;X&quot; &amp;&amp; $i+3==length$seq){##urt3 use end</div><div>                    $elength=&quot;$elength?&quot; ;</div><div>                    last;</div><div>                }</div><div>                $elength++;</div><div>                last if($code1!~/N/ &amp;&amp; $codon{$code1} eq &quot;X&quot;);</div><div>            }</div><div>            return &quot;non-frameshift;stoploss\t$pvarinfo$protein,$elength&quot;;</div><div>        }else{</div><div>            return &quot;non-frameshift;initiation\t$pvarinfo$protein&quot; if($codestart1&lt;3 &amp;&amp; $protein!~/^M/);</div><div>            return &quot;non-frameshift\t$pvarinfo$protein&quot;;</div><div>        }</div><div>    }else{</div><div>        my $AA=&quot;?&quot;;</div><div>        if ($codestart1%3==1){</div><div>            $code=substr($seq,$cdsstart-1+$codestart1-1+$corr1,3);</div><div>            $var=$code;</div><div>            $var=~s/^([AGCTN])/$1$varseq/;</div><div>            substr($seq,0,$cdsstart-1+$codestart1-1+$corr1+3,&quot;&quot;);</div><div>            $AA=$codon{$code} if($code!~/N/ &amp;&amp; length($code) == 3 );</div><div>            $AA=&quot;U&quot; if($AA eq &quot;X&quot; &amp;&amp; $codestart1+3+$corr1&lt;=$cdslen);</div><div>            $pvarinfo=&quot;p.$AA$ppos1&quot;;</div><div>        }elsif ($codestart1%3==2) {</div><div>            $code=substr($seq,$cdsstart-1+$codestart1-2+$corr1,3) ;</div><div>            $var=$code;</div><div>            $var=~s/([AGCTN])$/$varseq$1/;</div><div>            substr($seq,0,$cdsstart-1+$codestart1-2+3+$corr1,&quot;&quot;);</div><div>            $AA=$codon{$code} if($code!~/N/ &amp;&amp; length($code) == 3 );</div><div>            $AA=&quot;U&quot; if($AA eq &quot;X&quot; &amp;&amp; $codestart1+3+$corr1&lt;=$cdslen);</div><div>            $pvarinfo=&quot;p.$AA$ppos1&quot;;</div><div>        }else{</div><div>            $code=substr($seq,$cdsstart-1+$codestart1+$corr1,3) ;</div><div>            #print &quot;$cdsstart-1+$codestart1+$corr1,3\n&quot;,length$seq,&quot;\n&quot;;</div><div>            $var=$varseq;</div><div>            substr($seq,0,$cdsstart-1+$codestart1+$corr1,&quot;&quot;);</div><div>            $AA=$codon{$code} if($code!~/N/ &amp;&amp; length($code) == 3 );</div><div>            #die &quot;$code\n&quot; if(!$AA);</div><div>            $AA=&quot;U&quot; if($AA eq &quot;X&quot; &amp;&amp; $codestart1+3+$corr1&lt;$cdslen);</div><div>            $pvarinfo=&quot;p.$AA&quot;.($ppos1+1);</div><div>        }</div><div>        $var.=$seq;</div><div>        my $varcode1=substr($var,0,3);</div><div>        my $len=0;my $stopgain=0;</div><div>        for (my $i=0;$i&lt;length$var ;$i+=3) {</div><div>            if ($i+3&gt;length$var) {</div><div>                $len=&quot;?&quot;;</div><div>                last;</div><div>            }</div><div>            my $varcode=substr($var,$i,3);</div><div>            if ($varcode=~m/N/ or length($varcode) != 3 ) {</div><div>                $protein.=&quot;?&quot;;</div><div>            }else{</div><div>                $protein.=&quot;$codon{$varcode}&quot;;</div><div>            }</div><div>            $len++;</div><div>            if ($varcode!~/N/ &amp;&amp; $codon{$varcode} eq &quot;X&quot;){</div><div>                $stopgain=1 if ($protein=~m/X/ &amp;&amp; $varseq &amp;&amp; $i&lt;length$varseq);</div><div>                #print length$varseq,&quot;$stopgain\n&quot;;</div><div>                last ;</div><div>            }</div><div>        }</div><div>        my $AA2=&quot;?&quot;;</div><div>        $AA2=$codon{$varcode1} if($varcode1!~/N/ or length($varcode1) == 3 );</div><div>        my $return;</div><div>        $return=&quot;initiation;&quot; if($codestart1&lt;3 &amp;&amp; $AA2 ne &quot;M&quot;);</div><div>        if ($len eq &quot;1&quot; &amp;&amp; $AA eq &quot;X&quot;) {####X to X...</div><div>            $return.= &quot;frameshift;stop\t$pvarinfo$AA2&quot;.&quot;fs*1&quot;;</div><div>        }elsif ($AA eq &quot;X&quot; &amp;&amp; $AA2 eq &quot;X&quot;) {</div><div>            $return.= &quot;frameshift;stop\t$pvarinfo$AA2&quot;.&quot;fs*$len&quot;;</div><div>        }elsif ($AA eq &quot;X&quot;) {</div><div>            $return.= &quot;frameshift;stoploss\t$pvarinfo$AA2&quot;.&quot;fs*$len&quot;;</div><div>        }elsif ($stopgain==1 || $AA2 eq &quot;X&quot; ) {</div><div>            #print &quot;$stopgain=1 || ($len == 1 &amp;&amp; $AA2 eq\n&quot;;</div><div>            $return.= &quot;frameshift;stopgain\t$pvarinfo$AA2&quot;.&quot;fs*$len&quot;;</div><div>        }else{</div><div>            #return &quot;frameshift;initiation\t$pvarinfo$AA2&quot;.&quot;fs*$len&quot; if($codestart1&lt;3 &amp;&amp; $AA2 ne &quot;M&quot;);</div><div>            $return.= &quot;frameshift\t$pvarinfo$AA2&quot;.&quot;fs*$len&quot;;</div><div>        }</div><div>        return $return;</div><div>    }</div><div>}</div><div><br/></div><div><br/></div><div>sub DEL{</div><div>    my ($cdsstart,$cdslen,$codestart1,$codestart2,$seq,$insseq,$endlen,$corr1,$corr2)=@_;</div><div>#    die &quot;$var\t$region\n&quot; if(!$ref||!$var);</div><div>    if($corr1&gt;0){</div><div>        $corr1=&quot;-$corr1&quot; ;</div><div>    }else{</div><div>        $corr1=abs$corr1;</div><div>    }</div><div>    if($corr2&gt;0){</div><div>        $corr2=&quot;-$corr2&quot; ;</div><div>    }else{</div><div>        $corr2=abs$corr2;</div><div>    }</div><div>    die &quot;No insert sequence info: $insseq\t$codestart1,$codestart2,\n&quot; if(!$insseq);</div><div>    my $insseqlen=0;</div><div>    if ($insseq=~m/ins/) {</div><div>        $insseq=~s/.*ins//;</div><div>        $insseqlen=length$insseq;</div><div>    }else{</div><div>        undef $insseq;</div><div>    }</div><div>#    print &quot;$cdsstart\t$cdslen\t$codestart1\t$codestart2\n&quot;;</div><div>    my $ppos1=int(($codestart1+2)/3);</div><div>    my $ppos2=int(($codestart2+2)/3);</div><div>    my ($code,$var,$pvarinfo,$protein);</div><div>    if ($endlen &amp;&amp; $endlen eq &quot;all&quot;) {</div><div>        $seq=substr($seq,0,$cdsstart+$cdslen-1);</div><div>    }elsif ($endlen) {</div><div>        substr($seq,$cdsstart+$cdslen-1,$endlen,&quot;&quot;);</div><div>    }</div><div>    if (abs($codestart2-$codestart1+1-$insseqlen) % 3 == 0) {</div><div>        my ($code1,$code2,$del_start,$effect_left,$effect_right);</div><div>        my $dellen=$codestart2-$codestart1+1;</div><div>        if ($codestart1%3==1){</div><div>            $code1=substr($seq,$cdsstart-1+$codestart1-1+$corr1,3);</div><div>            $del_start=0;</div><div>            $effect_left=$codestart1+$corr1;</div><div>        }elsif ($codestart1%3==2) {</div><div>            $code1=substr($seq,$cdsstart-1+$codestart1-2+$corr1,3) ;</div><div>            $del_start=1;</div><div>            $effect_left=$codestart1-1+$corr1;</div><div>        }else{</div><div>            $del_start=2;</div><div>            $effect_left=$codestart1-2+$corr1;</div><div>            $code1=substr($seq,$cdsstart-1+$codestart1-3+$corr1,3) ;</div><div>        }</div><div>        if ($codestart2%3==1){</div><div>            $effect_right=$codestart2+2+$corr2;</div><div>            $code2=substr($seq,$cdsstart-1+$codestart2-1+$corr2,3);</div><div>        }elsif ($codestart2%3==2) {</div><div>            $effect_right=$codestart2+1+$corr2;</div><div>            $code2=substr($seq,$cdsstart-1+$codestart2-2+$corr2,3) ;</div><div>        }else{</div><div>            $code2=substr($seq,$cdsstart-1+$codestart2-3+$corr2,3) ;</div><div>            $effect_right=$codestart2+$corr2;</div><div>        }</div><div>        my $var=substr($seq,$cdsstart-1+$effect_left-1,$effect_right-$effect_left+1);</div><div>        my $raw_var=$var;</div><div>            $insseq=&quot;&quot; if(!$insseq);</div><div>            my $tmp_dellen=$dellen;</div><div>            $tmp_dellen=length($var)-$del_start if ($del_start+$dellen&gt;length$var);</div><div>            $tmp_dellen=0 if($tmp_dellen&lt;0);</div><div>            substr($var,$del_start,$tmp_dellen,$insseq) if($var);</div><div>        my ($AA,$AA2)=(&quot;?&quot;,&quot;?&quot;);</div><div>        $AA=$codon{$code1} if($code1!~/N/ &amp;&amp; length($code1)==3);</div><div>        $AA=&quot;U&quot; if($AA eq &quot;X&quot; &amp;&amp; $codestart1+3+$corr1&lt;=$cdslen);</div><div>        $AA2=$codon{$code2} if($code2 &amp;&amp; $code2!~/N/ &amp;&amp; length($code2)==3);</div><div>        $AA2=&quot;U&quot; if($AA eq &quot;X&quot; &amp;&amp; $codestart2+3+$corr2&lt;=$cdslen);</div><div>        if ($ppos1==$ppos2) {</div><div>            $pvarinfo=&quot;p.$AA$ppos1&quot;.&quot;delins&quot;;</div><div>        }else{</div><div>            $pvarinfo=&quot;p.$AA$ppos1&quot;.&quot;_$AA2$ppos2&quot;.&quot;delins&quot;;</div><div>        }</div><div><br/></div><div>        my $elength=0;my $raw_pro;</div><div>        #print &quot;$var\n&quot;;</div><div>        for (my $i=0;$var &amp;&amp; $i&lt;length$var ;$i+=3) {</div><div>            my $varcode=substr($var,$i,3);</div><div>            if (!exists $codon{$varcode} ) {</div><div>                $protein.=&quot;?&quot;;</div><div>            }else{</div><div>                $protein.=&quot;$codon{$varcode}&quot;;</div><div>            }</div><div>            $elength++;</div><div>            if ($insseq &amp;&amp; length$insseq ==  $dellen){</div><div>                my $raw_varcode=substr($raw_var,$i,3);</div><div>                if (!exists $codon{$raw_varcode} ) {</div><div>                    $raw_pro.=&quot;?&quot;;</div><div>                }else{</div><div>                    $raw_pro.=&quot;$codon{$raw_varcode}&quot;;</div><div>                }</div><div>            }</div><div>            last if ($varcode!~/N/ &amp;&amp; (!exists $codon{$varcode} || $codon{$varcode} eq &quot;X&quot;));</div><div>        }</div><div>        my $return;</div><div>        if (!$var &amp;&amp; $pvarinfo!~/X/) {#if stop,gain length?</div><div>            $pvarinfo=~s/ins$//;</div><div>            $return=&quot;non-frameshift\t$pvarinfo&quot;;</div><div>            $return=&quot;non-frameshift;initiation\t$pvarinfo&quot; if($ppos1==1);</div><div>        }elsif ((!$var || $protein=~m/X/) &amp;&amp; $pvarinfo !~ /X/) {#stop gain and gain length?</div><div>            $elength=(int(($cdslen-$cdsstart)/3)-$ppos1+1)-$elength;</div><div>            $return=&quot;non-frameshift;stopgain\t$pvarinfo$protein,$elength&quot;;</div><div>            $return=&quot;non-frameshift;initiation;stopgain\t$pvarinfo$protein,$elength&quot; if($ppos1==1  &amp;&amp; $protein!~/^M/);</div><div>        }elsif ((!$var || $protein !~ /X/) &amp;&amp; $pvarinfo =~ /X/) {#stop loss and stop postion</div><div>            for (my $i=$cdsstart+$ppos1*3-4+$corr1;$i&lt;length$seq;$i+=3) {</div><div>                if ($i+3&gt;length$seq ) {</div><div>                    $elength=&quot;$elength?&quot;;</div><div>                    last;</div><div>                }</div><div>                my $code1=substr($seq,$i,3);</div><div>                if($code1!~/N/ &amp;&amp; $codon{$code1} ne &quot;X&quot; &amp;&amp; $i+3==length$seq){##urt3 use end</div><div>                    $elength=&quot;$elength?&quot; ;</div><div>                    last;</div><div>                }</div><div>                $elength++;</div><div>                last if($code1!~/N/ &amp;&amp; $codon{$code1} eq &quot;X&quot;);</div><div>            }</div><div>            #print &quot;$elength\t$ppos1\n&quot;;</div><div>            $elength=($elength+$ppos1-1)-$ppos2 if($pvarinfo=~m/_X\d+/ &amp;&amp; $elength ne &quot;?&quot;);</div><div>            if(!$var){</div><div>                $pvarinfo=~s/ins$// ;</div><div>                $return=&quot;non-frameshift;stoploss\t$pvarinfo,$elength&quot;;</div><div>                $return=&quot;non-frameshift;initiation;stoploss\t$pvarinfo,$elength&quot; if($ppos1==1);</div><div>            }else{</div><div>                $return=&quot;non-frameshift;stoploss\t$pvarinfo$protein,$elength&quot;;</div><div>                $return=&quot;non-frameshift;initiation;stoploss\t$pvarinfo$protein,$elength&quot; if($ppos1==1  &amp;&amp; $protein!~/^M/);</div><div>            }</div><div>        }else{</div><div>            $return=&quot;non-frameshift\t$pvarinfo$protein&quot;;</div><div>            $return=&quot;non-frameshift;initiation\t$pvarinfo$protein&quot; if($ppos1==1  &amp;&amp; $protein!~/^M/);</div><div>        }</div><div>        if ($insseq &amp;&amp; length$insseq ==  $dellen ) {</div><div>            my $sys_tag=&quot;nonsynonymous&quot;;</div><div>            $sys_tag=&quot;synonymous&quot; if($raw_pro eq $protein);</div><div>            $return=&quot;$sys_tag;$return&quot;;</div><div>        }</div><div>        #print &quot;$return\n&quot;;</div><div>        return $return;</div><div>    }else{##framesift</div><div>        $var=$seq;</div><div>        my ($AA,$AA2,$code1,$code2)=(&quot;?&quot;,&quot;?&quot;);</div><div>        $insseq=&quot;&quot; if(!$insseq);</div><div>        substr($var,$cdsstart-1+$codestart1-1+$corr1,($codestart2+$corr1)-($codestart1+$corr1)+1,$insseq);</div><div>        if ($codestart1%3==1){</div><div>            $code1=substr($seq,$cdsstart-1+$codestart1-1+$corr1,3);</div><div>            $AA=$codon{$code1} if($code1!~/N/ &amp;&amp; length($code1)==3);</div><div>#            print &quot;$codestart1\n&quot; if(!$AA);</div><div>            $AA=&quot;U&quot; if($AA eq &quot;X&quot; &amp;&amp; $codestart1+3+$corr1&lt;=$cdslen);</div><div>            $pvarinfo=&quot;p.$AA$ppos1&quot;;</div><div>            substr($var,0,$cdsstart-1+$codestart1-1+$corr1,&quot;&quot;);</div><div>        }elsif ($codestart1%3==2) {</div><div>            $code1=substr($seq,$cdsstart-1+$codestart1-2+$corr1,3) ;</div><div>            $AA=$codon{$code1} if($code1!~/N/ &amp;&amp; length($code1) == 3 );</div><div>            $AA=&quot;U&quot; if($AA eq &quot;X&quot; &amp;&amp; $codestart1+3+$corr1&lt;=$cdslen);</div><div>            $pvarinfo=&quot;p.$AA$ppos1&quot;;</div><div>            substr($var,0,$cdsstart-1+$codestart1-2+$corr1,&quot;&quot;);</div><div>        }else{</div><div>            $code1=substr($seq,$cdsstart-1+$codestart1-3+$corr1,3) ;</div><div>            $AA=$codon{$code1} if($code1!~/N/&amp;&amp; length($code1) == 3 );</div><div>            $AA=&quot;U&quot; if($AA eq &quot;X&quot; &amp;&amp; $codestart1+3+$corr1&lt;=$cdslen);</div><div>            substr($var,0,$cdsstart-1+$codestart1-3+$corr1,&quot;&quot;);</div><div>        }</div><div>#        print &quot;$var\n&quot;;die;</div><div>        my $len=0;my $var_protein=&quot;?&quot;;my $stopgain=0;</div><div>        for (my $i=0;$var &amp;&amp; $i&lt;length$var ;$i+=3) {</div><div>            if ($i+3&gt;length$var) {</div><div>                $len=&quot;?&quot;;</div><div>                $var_protein=&quot;?&quot; if($i==0);</div><div>                last;</div><div>            }</div><div>            my $varcode=substr($var,$i,3);</div><div>            if($i==0){</div><div>                if($varcode!~/N/ &amp;&amp; length($varcode) == 3 ){</div><div>                    $var_protein=$codon{$varcode} ;</div><div>                }else{</div><div>                    $var_protein=&quot;?&quot;;</div><div>                }</div><div>            }</div><div>            $len++;</div><div>            if ($varcode!~/N/ &amp;&amp; $codon{$varcode} eq &quot;X&quot;){</div><div>                $stopgain=1 if ( $insseq &amp;&amp; $i&lt;length$insseq);</div><div>                last ;</div><div>            }</div><div>        }</div><div>        my $return;</div><div>        $return=&quot;initiation;&quot; if($ppos1==1 &amp;&amp; $var_protein!~/^M/);</div><div>        if ($len eq &quot;1&quot; &amp;&amp; $AA eq &quot;X&quot;) {####X to X...</div><div>            $return.= &quot;non-frameshift;stop\tp.$AA$ppos1$var_protein&quot;.&quot;fs*1&quot;;</div><div>        }elsif($AA eq &quot;X&quot;){#not sure is frameshift</div><div>            $return.= &quot;frameshift;stoploss\tp.$AA$ppos1$var_protein&quot;.&quot;fs*$len&quot;;</div><div>        }elsif($stopgain ==1 || $var_protein eq &quot;X&quot;){#not sure is frameshift</div><div>            $return.= &quot;frameshift;stopgain\tp.$AA$ppos1$var_protein&quot;.&quot;fs*$len&quot;;</div><div>        }else{</div><div>            #$return.= &quot;frameshift;initiation\tp.$AA$ppos1$var_protein&quot;.&quot;fs*$len&quot; if($ppos1==1 &amp;&amp; $var_protein!~/^M/);</div><div>            $return.= &quot;frameshift\tp.$AA$ppos1$var_protein&quot;.&quot;fs*$len&quot;;</div><div>        }</div><div>        return $return;</div><div>    }</div><div>}</div><div><br/></div><div>###############Time</div><div>my $Time_End;</div><div>$Time_End = sub_format_datetime(localtime(time()));</div><div>print &quot;\nEnd Time :[$Time_End]\n\n&quot;;</div><div><br/></div><div>###############Subs</div><div>sub sub_format_datetime{#Time calculation subroutine</div><div>    my($sec, $min, $hour, $day, $mon, $year, $wday, $yday, $isdst) = @_;</div><div>    $wday = $yday = $isdst = 0;</div><div>    sprintf(&quot;%4d-%02d-%02d %02d:%02d:%02d&quot;, $year+1900, $mon+1, $day, $hour, $min, $sec);</div><div>}</div><div><br/></div><div>sub ABSOLUTE_DIR{ #$pavfile=&amp;ABSOLUTE_DIR($pavfile);</div><div>    my $cur_dir=`pwd`;chomp($cur_dir);</div><div>    my ($in)=@_;</div><div>    my $return=&quot;&quot;;</div><div><br/></div><div>    if(-f $in){</div><div>        my $dir=dirname($in);</div><div>        my $file=basename($in);</div><div>        chdir $dir;$dir=`pwd`;chomp $dir;</div><div>        $return=&quot;$dir/$file&quot;;</div><div>    }elsif(-d $in){</div><div>        chdir $in;$return=`pwd`;chomp $return;</div><div>    }else{</div><div>        warn &quot;Warning just for file and dir\n&quot;;</div><div>        exit;</div><div>    }</div><div>    chdir $cur_dir;</div><div>    return $return;</div><div>};</div><div><br/></div><div>sub initialize{</div><div>    my ($file,$hash)=@_;</div><div>    open K,&quot;$file&quot; or die; #######   0.�������������</div><div>    while (&lt;K&gt;){</div><div>        chomp;</div><div>        next if (/^$/ || /^\#/);</div><div>        my @arr=split /\t/,$_;</div><div>        if (!defined $arr[2]){</div><div>            $hash-&gt;{$arr[0]}=$arr[1];</div><div>        }else{</div><div>            $arr[2]=~s/\#//g;</div><div>            $hash-&gt;{$arr[0]}=&quot;$arr[1] $arr[2]&quot;;</div><div>        };</div><div>    };</div><div>    close K;</div><div>};</div><div><br/></div></span>
</div></body></html> 