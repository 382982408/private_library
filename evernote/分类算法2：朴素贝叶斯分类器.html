<html>
<head>
  <title>分类算法2：朴素贝叶斯分类器</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/600753 (zh-CN, DDL); Windows/10.0.0 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="474"/>
<h1>分类算法2：朴素贝叶斯分类器</h1>

<div>
<span><div>分类算法2：朴素贝叶斯分类器</div><div><br/></div><div>#!/usr/bin/env python</div><div># encoding: utf-8</div><div>import sys,os,re,operator,random,pprint</div><div><br/></div><div>datasets = {'banala':{'long':400,'not_long':100,'sweet':350,'not_sweet':150,'yellow':450,'not_yellow':50},</div><div>            'orange':{'long':0,'not_long':300,'sweet':150,'not_sweet':150,'yellow':300,'not_yellow':0},</div><div>            'other_fruit':{'long':100,'not_long':100,'sweet':150,'not_sweet':50,'yellow':50,'not_yellow':150}</div><div>}</div><div>def count_total(data):</div><div>    '''</div><div>    function:计算各种水果的总数, return {‘banala’:500 ...}</div><div>    '''</div><div>    count = {}</div><div>    total = 0</div><div>    for fruit in data:</div><div>        '''因为水果要么甜要么不甜，可以用 这两种特征来统计总数'''</div><div>        count[fruit] = data[fruit]['sweet'] + data[fruit]['not_sweet']</div><div>        total += count[fruit]</div><div>    return count,total</div><div>#categories,simpleTotal = count_total(datasets)</div><div>#print(categories,simpleTotal)</div><div>###########################################################</div><div>def cal_base_rates(data):</div><div>    '''</div><div>    function:计算各种水果的先验概率 ,return {‘banala’:0.5 ...}</div><div>    '''</div><div>    categories,total = count_total(data)</div><div>    cal_base_rates = {}</div><div>    for label in categories:</div><div>        priori_prob = categories[label]/total</div><div>        cal_base_rates[label] = priori_prob</div><div>    return cal_base_rates</div><div>#Prio = cal_base_rates(datasets)</div><div>#print(Prio)</div><div>############################################################</div><div>def likelihold_prob(data):</div><div>    '''</div><div>    function:计算已知水果下各特征的概率分布（likelihood probabilities） {'banala':{'long':0.8}...}</div><div>    '''</div><div>    count,_ = count_total(data)</div><div>    likelihold = {}</div><div>    for fruit in data:</div><div>        '''创建一个临时的字典，临时存储各个特征值的概率'''</div><div>        attr_prob = {}</div><div>        for attr in data[fruit]:</div><div>            #计算各个特征值在已知水果下的概率</div><div>            attr_prob[attr] = data[fruit][attr]/count[fruit]</div><div>        likelihold[fruit] = attr_prob</div><div>    return likelihold</div><div>#LikeHold = likelihold_prob(datasets)</div><div>#print(LikeHold)</div><div>############################################################</div><div><br/></div><div>def evidence_prob(data):</div><div>    '''</div><div>    function:计算各种特征的分布,return {'long':50%...}</div><div>    '''</div><div>    attrs = list(data['banala'].keys())</div><div>    count,total  = count_total(data)</div><div>    evidence_prob = {}</div><div>    #计算各种特征的概率</div><div>    for attr in attrs:</div><div>        attr_total = 0</div><div>        for fruit in data:</div><div>            attr_total += data[fruit][attr]</div><div>        evidence_prob[attr] = attr_total/total</div><div>    return evidence_prob</div><div><br/></div><div><br/></div><div>def evidence_prob_lzw(data):</div><div>    '''</div><div>    function:计算各种特征下各水果的分布,return {'long':50%...}</div><div>    '''</div><div>    attrs = list(data['banala'].keys())</div><div>    count,total  = count_total(data)</div><div>    evidence_prob = {}</div><div>    #计算各种特征的概率</div><div>    for attr in attrs:</div><div>        attr_total = 0</div><div>        for fruit in data:</div><div>            attr_total += data[fruit][attr]</div><div>        fruit_prob={}</div><div>        for fruit in data:</div><div>            fruit_prob[fruit] = data[fruit][attr]/attr_total</div><div>        evidence_prob[attr] = fruit_prob</div><div>    return evidence_prob</div><div>#Evidence_prob = evidence_prob(datasets)</div><div>#print(Evidence_prob)</div><div>##########################################################</div><div>#以上是训练数据用到的函数，即将数据转化为代码计算概率</div><div>##########################################################</div><div>class navie_bayes_classifier:</div><div>    '''</div><div>    初始化贝叶斯分类器,实例化时会调用__init__函数</div><div>    '''</div><div>    def __init__(self,data=datasets):</div><div>        self._data = datasets</div><div>        self._labels = list(self._data.keys())</div><div>        self._priori_prob = cal_base_rates(self._data)</div><div>        self._likelihold_prob = likelihold_prob(self._data)</div><div>        self._evidence_prob = evidence_prob(self._data)</div><div>        self._evidence_prob_lzw = evidence_prob_lzw(self._data)</div><div>    #下面的函数可以直接调用上面类中定义的变量</div><div>    def get_label(self,length,sweetness,color):</div><div>        '''获取某一组特征值的类别'''</div><div>        self._attrs = [length,sweetness,color]</div><div>        res = {}</div><div>        for label in self._labels:</div><div>            prob = self._priori_prob[label]#取某水果占比率</div><div>            #print(&quot;各个水果的占比率：&quot;,prob)</div><div>            test_char=str(f&quot;P({label})&quot;)</div><div>            for attr in self._attrs:</div><div>                #单个水果的某个特征概率除以总的某个特征概率 再乘以某水果占比率</div><div>                prob*=self._likelihold_prob[label][attr]/self._evidence_prob[attr]</div><div>                test_char+=str(f&quot;*P({attr}|{label})/P({attr})&quot;)</div><div>            #print(prob)</div><div>            res[label] = prob</div><div>          #  print (test_char)</div><div>        #print(res)</div><div>        return res</div><div><br/></div><div>    def get_label_lzw(self,length,sweetness,color):</div><div>        '''获取某一组特征值的类别'''</div><div>        self._attrs = [length,sweetness,color]</div><div>        res = {}</div><div>        for label in self._labels:</div><div>            prob = self._priori_prob[label]#取某水果占比率</div><div>            #print(&quot;各个水果的占比率：&quot;,prob)</div><div>            test_char=str(f&quot;P({label})&quot;)</div><div>            for attr in self._attrs:</div><div>                #单个水果的某个特征概率除以总的某个特征概率 再乘以某水果占比率</div><div>                prob*=self._likelihold_prob[label][attr]</div><div>                test_char+=str(f&quot;*P({attr}|{label})&quot;)</div><div>            #print(prob)</div><div>            res[label] = prob</div><div>         #   print (test_char)</div><div>        #print(res)</div><div>        return res</div><div><br/></div><div><br/></div><div>########生成测试数据</div><div>def random_attr(pair):</div><div>    &quot;&quot;&quot;</div><div>    function:生成0-1之间的随机数</div><div>    &quot;&quot;&quot;</div><div>    return pair[random.randint(0,1)]</div><div>def getTestData():</div><div>    &quot;&quot;&quot;</div><div>    function:生成测试数据集</div><div>    &quot;&quot;&quot;</div><div>    sets = [('long','not_long'),('sweet','not_sweet'),('yellow','not_yellow')]</div><div>    test_datasets = []</div><div>    for a in sets[0]:</div><div>        for b in sets[1]:</div><div>            for c in sets[2]:</div><div>                test_datasets.append([a,b,c])</div><div>    return test_datasets</div><div><br/></div><div>def main():</div><div>    test_datasets = getTestData()</div><div>#   test_datasets=[['not_long','not_sweet','yellow']]</div><div>    classfier = navie_bayes_classifier()</div><div>    for data in test_datasets:</div><div>        print(f&quot;特征值：\t{data}&quot;)</div><div><br/></div><div>        res=classfier.get_label(*data)#*表示多参传入</div><div>        print(f&quot;预测结果：\t{res}&quot;)#预测属于哪种水果的概率</div><div>        #对后验概率排序，输出概率最大的标签</div><div>        fruit_type=sorted(res.items(),key=lambda x:x[1],reverse=True)[0][0]</div><div>        print('水果类别：',end='\t')</div><div>        print (fruit_type)</div><div><br/></div><div>        res=classfier.get_label_lzw(*data)#*表示多参传入</div><div>        print(f&quot;预测结果：\t{res}&quot;)#预测属于哪种水果的概率</div><div>        fruit_type=sorted(res.items(),key=lambda x:x[1],reverse=True)[0][0]</div><div>        print('水果类别：',end='\t')</div><div>        print (fruit_type)</div><div><br/></div><div>if __name__ == '__main__':</div><div>    main()</div><div><br/></div></span>
</div></body></html> 