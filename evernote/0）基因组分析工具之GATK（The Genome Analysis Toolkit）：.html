<html>
<head>
  <title>0）基因组分析工具之GATK（The Genome Analysis Toolkit）：</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/600753 (zh-CN, DDL); Windows/10.0.0 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="982"/>
<h1>0）基因组分析工具之GATK（The Genome Analysis Toolkit）：</h1>

<div>
<span><div><span style="font-size: 16pt; color: rgb(255, 0, 0);">0）基因组分析工具之GATK（The Genome Analysis Toolkit）：</span></div><div><br/></div><div>官网： <a href="http://www.broadinstitute.org/gatk/">http://www.broadinstitute.org/gatk/</a></div><div>下载地址：<a href="https://software.broadinstitute.org/gatk/download/">https://software.broadinstitute.org/gatk/download/</a> （解压即可用，conda安装失败）</div><div> 教程地址：<a href="https://software.broadinstitute.org/gatk/documentation/topic?name=tutorials">https://software.broadinstitute.org/gatk/documentation/topic?name=tutorials</a></div><div><br/></div><div><img src="0）基因组分析工具之GATK（The Genome Analysis Toolkit）：_files/Image.png" type="image/png" data-filename="Image.png" width="589"/></div><div><span style="font-size: 14pt;">1)GATK4 的最佳实践给出了5套pipeline：</span></div><div><span style="font-size: 14pt;"><a href="https://software.broadinstitute.org/gatk/best-practices/" style="font-size: 14pt;">https://software.broadinstitute.org/gatk/best-practices/</a></span></div><div>    1）Germline SNPs + Indels</div><div>    2）Somatic SNVs + Indels</div><div>    3）RNAseq SNPs + Indels</div><div>    4）Germline CNVs</div><div>    5）Somatic CNVs</div><div><br/></div><div><br/></div><div><span style="font-size: 14pt;">GATK的功能虽然超级多，但主要可以归为以下几个方面：</span></div><div>1）诊断和质量控制工具(Diagnostics and Quality Control Tools)</div><div>2）序列数据处理工具(Sequence Data Processing Tools)</div><div>3）变异位点探索工具(Variant Discovery Tools)</div><div>4）变异位点评估工具(Variant Evaluation Tools)</div><div>5）变异位点操作工具(Variant Manipulation Tools)</div><div><span style="color: rgb(255, 0, 0);">6）注释模块</span></div><div>7）读段（reads）过滤</div><div>8）资源文件解码工具</div><div>9）参考序列实用工具</div><div><br/></div><div><br/></div><div><span style="font-size: 14pt; color: rgb(227, 0, 0);">1）诊断和质量控制工具(Diagnostics and Quality Control Tools) (变异分析数据处理第一步)</span></div><div>    <span style="font-size: 12pt;">1.1）BQSR：Base quality score recalibration</span></div><div>            (Tools involved: <span style="color: rgb(255, 0, 0);">BaseRecalibrator, Apply Recalibration,</span> AnalyzeCovariates (optional))</div><div>            <a href="https://software.broadinstitute.org/gatk/documentation/article?id=11081">https://software.broadinstitute.org/gatk/documentation/article?id=11081</a></div><div>           <span style="color: rgb(77, 206, 29);">1.1.1） BaseRecalibrator</span></div><div>            java -jar GenomeAnalysisTK.jar</div><div>                -T BaseRecalibrator</div><div>                -R hg19.fa</div><div>                -I ChrALL.100.sam.dedup.realn.07.bam</div><div>                -knownSites dbsnp_137.hg19.vcf</div><div>                -knownSites Mills_and_1000G_gold_standard.indels.hg19.vcf</div><div>                -knownSites 1000G_phase1.indels.hg19.vcf</div><div>                -o ChrALL.100.sam.recal.08-1.grp</div><div>      <span style="color: rgb(77, 206, 29);">      1.1.2）BaseRecalibrator</span></div><div>            java -jar GenomeAnalysisTK.jar</div><div>                -T BaseRecalibrator</div><div>                -R hg19.fa</div><div>                -I ChrALL.100.sam.dedup.realn.07.bam</div><div>                -BQSR ChrALL.100.sam.recal.08-1.grp</div><div>                -o GATK/hg19.recal.08-2.grp</div><div>                -knownSites dbsnp_137.hg19.vcf</div><div>                -knownSites Mills_and_1000G_gold_standard.indels.hg19.vcf</div><div>                -knownSites 1000G_phase1.indels.hg19.vcf                </div><div><span style="color: rgb(77, 206, 29);">            1.1.3) PrintReads</span></div><div><span style="font-size: 10pt;">            </span><span style="letter-spacing: normal; orphans: 2; text-indent: 32px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; color: rgb(68, 68, 68); font-family: &quot;Microsoft YaHei&quot;, Helvetica, Arial, &quot;Lucida Grande&quot;, Tahoma, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">利用工具PrintReads将经过质量值校正的数据输出到新的bam文件中，用于后续的变异检测。</span></div><div>            java -jar GenomeAnalysisTK.jar</div><div>                -T PrintReads</div><div>                -R hg19.fa</div><div>                -I ChrALL.100.sam.dedup.realn.07.bam</div><div>                -BQSR ChrALL.100.sam.recal.08-1.grp</div><div>                -o ChrALL.100.sam.recal.08-3.grp.bam</div><div>            主要参数说明：</div><div>            -bqsrBAQGOP：BQSR BAQ gap open 罚值，默认值是40，如果是对全基因组数据进行BQSR分析，设置为30会更好。</div><div>            -lqt： 在计算过程中，该算法所能考虑的reads两端的最小质量值。如果质量值小于该值，计算过程中将不予考虑，默认值是2。</div><div><span style="color: rgb(77, 206, 29);">       1.2） AnalyzeCovariates（ 分析和评估BQSR结果）</span></div><div>               java -jar GenomeAnalysisTK.jar</div><div>                    -T AnalyzeCovariates</div><div>                    -R hg19.fa</div><div>                    -before ChrALL.100.sam.recal.08-1.grp</div><div>                    -after ChrALL.100.sam.recal.08-2.grp</div><div>                   -csv ChrALL.100.sam.recal.grp.09.csv</div><div>                   -plots ChrALL.100.sam.recal.grp.09.pdf</div><div><span style="color: rgb(77, 206, 29);">       1.3） ReduceReads </span></div><div><font style="font-size: 10pt;"><span style="letter-spacing: normal; orphans: 2; text-indent: 32px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; color: rgb(68, 68, 68); font-family: &quot;Microsoft YaHei&quot;, Helvetica, Arial, &quot;Lucida Grande&quot;, Tahoma, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">                </span><span style="font-size: 10pt; color: rgb(68, 68, 68); font-family: &quot;Microsoft YaHei&quot;;">这一步是使用ReduceReads这个工具将bam文件进行压缩，生成新的bam文件，新的bam文件仍然保持bam文件的格式和所有进行变异检测所需要的信息。这样不仅能够节省存储空间，也方便后续变异检测过程中对数据的处理。</span></font></div><div>                java -jar GenomeAnalysisTK.jar</div><div>                    -T ReduceReads</div><div>                    -R hg19.fa</div><div>                    -I ChrALL.100.sam.recal.08-3.grp.bam</div><div>                    -o ChrALL.100.sam.recal.08-3.grp.reduce.bam</div><div><br/></div><div><span style="font-size: 14pt; color: rgb(227, 0, 0);">2）序列数据处理工具(Sequence Data Processing Tools)</span></div><div><br/></div><div><span style="font-size: 14pt; color: rgb(227, 0, 0);">3）变异位点探索工具(Variant Discovery Tools)</span></div><div><span style="color: rgb(77, 206, 29);">       3.1） HaplotypeCaller </span></div><div>        HaplotypeCaller不支持Reduce之后的bam文件，因此，当选择使用HaplotypeCaller进行变异检测时，不需要进行Reduce reads。</div><div> <span style="color: rgb(77, 206, 29);">      3.2）UnifiedGenotyper</span></div><div>    </div><div><span style="font-size: 14pt; color: rgb(227, 0, 0);">4）变异位点评估工具(Variant Evaluation Tools)</span></div><div><span style="color: rgb(77, 206, 29);">        4.1）VariantEval</span></div><div>               主要参数解释：</div><div>               --eval                       输入要进行summary的文件，也就是hg19.snp.filter.t97.Q10_13.both.vcf。</div><div>              -EV                          选择模块计算相应的分析内容，。</div><div>               --list                       列出可供选择的计算模块。</div><div>               -noEV                        不是用默认的模块，只计算用-EV选定的模块。</div><div><span style="font-size: 14pt; color: rgb(227, 0, 0);">5）变异位点操作工具(Variant Manipulation Tools)</span></div><div><span style="color: rgb(77, 206, 29);">        5.1）VariantFiltration</span></div><div>      <span style="color: rgb(77, 206, 29);">  5.2）</span><span style="color: rgb(77, 206, 29);">VQSR </span></div><div>            GATK是推荐使用VQSR的，但使用VQSR数据量一定要达到要求，数据量太小无法使用高斯模型。还有，在使用VAQR时，indel和snp要分别进行。</div><div>            VQSR原理介绍：</div><div>            这个模型是根据已有的真实变异位点（人类基因组一般使用HapMap3中的位点，以及这些位点在Omni 2.5M SNP芯片中出现的多态位点）来训练，最后得到一个训练好的能够很好的评估真伪的错误评估模型，可以叫他适应性错误评估模型。这个适应性的错误评估模型可以应用到call出来的原始变异集合中已知的变异位点和新发现的变异位点，进而去评估每一个变异位点发生错误的概率，最终会给出一个得分。这个得分最后会被写入vcf文件的INFO信息里，叫做VQSLOD，就是在训练好的混合高斯模型下，一个位点是真实的概率比上这个位点可能是假阳性的概率的log odds ratio（对数差异比），因此，可以定性的认为，这个值越大就越好。</div><div>            VQSR主要分两个步骤，这两个步骤会使用两个不同的工具：VariantRecalibrator和ApplyRecalibration。</div><div>            VariantRecalibrator：通过大量的高质量的已知变异集合的各个注释（包括很多种，后面介绍）的值来创建一个高斯混合模型，然后用于评估所有的变异位点。这个文件最后将生成一个recalibration文件。</div><div>            原理简单介绍：这个模型首先要拿到真实变异数据集和上一步骤中得到的原始变异数据集的交集，然后对这些SNP值相对于具体注释信息的分布情况进行模拟，将这些变异位点进行聚类，最后根据聚类结果赋予所有变异位点相应的VQSLOD值。越接近聚类核心的变异位点得到的VQSLOD值越高。</div><div>             ApplyRecalibration：这一步将模型的各个参数应用于原始vcf文件中的每一个变异位点，这时，每一个变异位点的注释信息列中都会出现一个VQSLOD值，然后模型会根据这个值对变异位点进行过滤，过滤后的信息会写在vcf文件的filter一列中。</div><div>             原理简单介绍：在VariantRecalibrator这一步中，每个变异位点已经得到了一个VQSLOD值了，同时，这些LOD值在训练集里也进行了排序。当你在这一步中设置一个tranche sensitivity 的阈值（这个阈值一般是一个百分数，如设置成99%），那么，如果LOD值从大到小排序的话，这个程序就会认为在这个训练集中，LOD值在前99%的是可信的，当这个值低于这个阈值，就认为是错误的。最后，程序就会用这个标准来过滤上一步call出来的原始变异集合。如果LOD值超过这个阈值，在filter那一列就会显示PASS，如果低于这个值就会被过滤掉，但是这些位点仍然会显示在结果里面，只不过会在filter那一列标示出他所属于的tranche sensitivity 的名称。在设置tranche sensitivity 的阈值时，要兼顾敏感度和质量值。</div><div>    </div><div>    </div><div><span style="color: rgb(77, 206, 29);">       5.2.1） VariantRecalibrator</span></div><div>        -badLodCutoff                  当LOD得分低于这个值的时候，就用于构建高斯混合模型的bad variants。默认值是-5。</div><div>        -maxNumTrainingData              构建高斯模型过程中，用于训练的最大位点数目。如果超过这个数目，将被随机删除。默认值是2500000。</div><div>        -minNumBad                     构建高斯模型的bad variants时的最少低质量值得位点数。</div><div>        -recalFile                     用于ApplyRecalibration的输出文件。</div><div>        -resource                      已知的变异信息。</div><div>        -rscriptFile                   结果中生成图片的脚本。</div><div>        -tranchesFile                  用于ApplyRecalibration的tranche结果输出文件。</div><div>        -tranche                       设置tranche阈值。</div><div>        -an                            选择填加注释信息。</div><div>         </div><div><span style="color: rgb(77, 206, 29);">        5.2.3）ApplyRecalibration</span></div><div>        -ef                             输出结果中不显示被过滤掉的位点。</div><div>        -lodCutoff                    VQSLOD值低于这个值就过滤掉。</div><div>        -recalFile                    上一步生成的recalFile。</div><div>        -tranchesFile                 上一步生成的tranchesFile。</div><div>        -ts_filter_level              上一步中确定的tranche值。</div><div>        </div><div>        </div><div><span style="color: rgb(77, 206, 29);">       5.3） CombineVariants</span></div><div><br/></div></span>
</div></body></html> 